\documentclass{uetgraduation}

\usepackage[hidelinks]{hyperref}
\setlength{\parindent}{2em}
\usepackage{array}      % mở rộng tùy chọn cột
\usepackage{tabularx}   % cột tự co giãn X
\usepackage{adjustbox}  % thu-phóng bảng theo bề rộng
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsfonts}   % hoặc
\usepackage{amssymb}

% Nếu cần định nghĩa thêm các kiểu đính kèm (ví dụ cho code, sơ đồ), bạn có thể đặt ở đây
% \makeattachmenttype{...}{...}{...}{...}{...}{...}{...}{...}

\begin{document}

% ===========================
% THÔNG TIN TRANG BÌA
% ===========================
\studentname{Trần Hồng Quân}
\title{NHẬN DIỆN THIẾT BỊ TRÊN MẠNG ĐIỆN PHỨC TẠP SỬ DỤNG THUẬT TOÁN PHÁT HIỆN SỰ KIỆN ĐƯỢC TỐI ƯU
}
\documenttype{Khóa luận tốt nghiệp đại học hệ chính quy}
\major{Kỹ thuật máy tính}
\year{2025}
\supervisor{TS. Nguyễn Ngọc An}
\title{NHẬN DIỆN THIẾT BỊ TRÊN MẠNG ĐIỆN PHỨC TẠP SỬ DỤNG THUẬT TOÁN PHÁT HIỆN SỰ KIỆN ĐƯỢC TỐI ƯU
}
\major{Kỹ thuật máy tính}
\supervisor{TS. Nguyễn Ngọc An}
\makecovers

% ===========================
% TÓM TẮT, CAM ĐOAN, CẢM ƠN
% ===========================
\begin{preamble}{Tóm tắt}
\textbf{Tóm tắt:} 
Trong bối cảnh nhu cầu quản lý năng lượng thông minh ngày càng gia tăng, việc giám sát và nhận dạng mức tiêu thụ điện của từng thiết bị trở thành yếu tố quan trọng để tối ưu hóa sử dụng điện và giảm lãng phí năng lượng. Mặc dù NILM (Non-Intrusive Load Monitoring) đã được nghiên cứu trong nhiều năm, các hệ thống hiện tại vẫn gặp phải nhiều hạn chế thực tế. Phần lớn các mô hình nghiên cứu giả định rằng tại một thời điểm chỉ có một thiết bị thay đổi trạng thái, điều này giúp việc huấn luyện và phân loại tín hiệu trở nên đơn giản, nhưng không phản ánh đúng môi trường thực tế, nơi nhiều thiết bị có thể bật/tắt gần như đồng thời, gây chồng lấn tín hiệu, bỏ sót sự kiện hoặc nhận dạng sai thiết bị. Bên cạnh đó, các thuật toán phát hiện sự kiện thường nhạy cảm với nhiễu hoặc biến đổi nhỏ trong tín hiệu, dẫn đến hệ thống thiếu ổn định khi triển khai thực tế.  

Trước những hạn chế này, đề tài tập trung xây dựng và kiểm chứng một hệ thống NILM hướng sự kiện có khả năng hoạt động ổn định trong môi trường phức tạp, phát hiện chính xác các sự kiện bật/tắt của nhiều thiết bị hoạt động đồng thời và duy trì độ chính xác nhận dạng thiết bị. Dữ liệu điện áp và dòng điện được thu thập từ nhiều thiết bị trong các sự kiện bật/tắt thực tế và xử lý ngoại tuyến trong môi trường Python. Hệ thống thực hiện các bước chính: phát hiện sự kiện bật/tắt, tiền xử lý và trích xuất đặc trưng (bao gồm công suất tức thời và đặc trưng ảnh dạng sóng I–V), và nhận dạng thiết bị bằng mô hình học máy MLP kết hợp giữa các đặc trưng công suất và hình ảnh tín hiệu.  

Đề tài cũng xây dựng một bộ dữ liệu thực nghiệm mới, ghi nhận các sự kiện bật/tắt của nhiều thiết bị trong điều kiện thực tế tại Việt Nam, làm cơ sở kiểm thử trực tiếp cho hệ thống NILM hướng sự kiện, tương tự PLAID dataset nhưng phản ánh điều kiện địa phương một cách chân thực hơn. Các thuật toán phát hiện sự kiện như lọc trung bình, WAMMA, bộ lọc Kalman và thuật toán Hybrid của Mengqi Lu – Zuyi Li được triển khai và đánh giá nhằm giảm bỏ sót sự kiện và nâng cao độ chính xác nhận dạng.  

Kết quả thực nghiệm cho thấy hệ thống đề xuất có khả năng phát hiện sự kiện bật/tắt và nhận dạng thiết bị với độ tin cậy cao trong môi trường nhiều tải hoạt động đồng thời. Đề tài đóng góp hai kết quả chính: (1) xây dựng thành công hệ thống NILM hướng sự kiện, (2) phát triển bộ dữ liệu thực nghiệm phục vụ kiểm thử và nghiên cứu NILM, đồng thời tạo nền tảng cho các ứng dụng thực tế trong nhà thông minh, quản lý năng lượng và giám sát tiêu thụ điện trong công nghiệp.


\end{preamble}

\begin{preamble}{Lời cam đoan}
Tôi xin cam kết rằng đồ án tốt nghiệp với đề tài “NHẬN DIỆN THIẾT BỊ TRÊN MẠNG ĐIỆN PHỨC TẠP SỬ DỤNG THUẬT TOÁN PHÁT HIỆN SỰ KIỆN ĐƯỢC TỐI ƯU” là kết quả nghiên cứu do chính tôi thực hiện. Toàn bộ nội dung và kết
quả trình bày trong đồ án là trung thực, phản ánh đúng quá trình thực nghiệm và phân tích của
bản thân tôi, không sao chép hoặc sử dụng từ bất kỳ công trình nào đã được công bố hoặc bảo
vệ tại các cơ sở giáo dục khác.
Tôi hoàn toàn chịu trách nhiệm về tính trung thực và nguyên bản của đồ án này trước Hội đồng
chấm đồ án và các quy định liên quan của nhà trường.

\vspace{1.5cm}
\begin{flushright}
    Hà Nội, ngày \hspace{0.5cm} tháng \hspace{0.5cm} năm 2025\\
\end{flushright}
\begin{tabular}{p{0.5\linewidth} p{0.5\linewidth}}
    \hspace{1cm}\textbf{} & \hspace{2cm}\textbf{Sinh viên thực hiện} \\
    \\[2cm] % khoảng trống để ký
    \hspace{1cm}\textbf{} & \hspace{2.1cm}\textbf{Trần Hồng Quân} \\
\end{tabular}

\end{preamble}

\begin{preamble}{Lời cảm ơn}
Để hoàn thành được đồ án này, trước hết tôi xin bày tỏ lòng biết ơn đến thầy TS. Nguyễn Ngọc
An, người đã tận tình hướng dẫn, đồng hành và dành nhiều thời gian quý báu để định hướng, hỗ
trợ tôi trong suốt quá trình thực hiện đồ án.
Tôi cũng xin gửi lời cảm ơn chân thành đến Ban Giám hiệu Nhà trường cùng các thầy, cô giáo
ngành Kỹ thuật máy tính đã không ngừng tạo điều kiện học tập thuận lợi và truyền đạt những
kiến thức nền tảng quý giá trong suốt quá trình học tập tại trường.
Dù đã cố gắng hoàn thiện đồ án với tinh thần nghiêm túc và nỗ lực cao nhất, nhưng chắc chắn
không tránh khỏi những thiếu sót. Tôi mong nhận được những góp ý chân thành từ các thầy cô
để đồ án được hoàn thiện hơn.
Cuối cùng, tôi xin gửi lời cảm ơn đến nhóm nghiên cứu myLab của thầy Nguyễn Ngọc An đã
tiếp thêm động lực để tôi có thể kiên trì theo đuổi và hoàn thành đồ án này.
\end{preamble}

% ===========================
% MỤC LỤC, DANH SÁCH HÌNH, BẢNG
% ===========================
\begin{contentlisting}
\tableofcontents
\listoffigures
\listoftables
\end{contentlisting}

% ===========================
% CÁC CHƯƠNG NỘI DUNG
% ===========================
\chapter{Giới thiệu}

\section{Giới thiệu Hệ thống NILM}

Hệ thống NILM (Non-Intrusive Load Monitoring), hay còn gọi là giám sát tải điện không xâm lấn, là một phương pháp tiên tiến trong lĩnh vực quản lý năng lượng, giúp xác định mức tiêu thụ và nhận dạng từng thiết bị điện riêng lẻ trong một hệ thống điện chỉ dựa trên dữ liệu tổng hợp về dòng điện và điện áp tại một điểm duy nhất, thường là tại công tơ điện tổng của hộ gia đình hoặc tòa nhà.  

Khác với phương pháp ILM (Intrusive Load Monitoring), trong đó mỗi thiết bị cần được gắn cảm biến riêng biệt để đo công suất tiêu thụ, NILM chỉ yêu cầu một bộ cảm biến duy nhất tại đầu nguồn. Nhờ đó, hệ thống NILM mang lại nhiều lợi ích nổi bật: giảm chi phí triển khai, hạn chế sự xâm lấn vào thiết bị hiện hữu, dễ dàng mở rộng và áp dụng cho các môi trường khác nhau từ hộ gia đình, văn phòng đến các khu công nghiệp lớn.  

Nguyên lý hoạt động của NILM thường được chia thành ba bước chính: đầu tiên là thu thập tín hiệu tổng hợp, dữ liệu dòng điện và điện áp được ghi lại tại đầu nguồn với tần số mẫu cao để đảm bảo ghi nhận được các biến đổi nhanh của tải. Tiếp theo là phát hiện sự kiện bật/tắt thiết bị, các thay đổi đột ngột hoặc mẫu dao động đặc trưng trong tín hiệu tổng được phân tích để xác định thời điểm một thiết bị được bật hoặc tắt. Cuối cùng là nhận dạng thiết bị, thông qua việc trích xuất các đặc trưng tín hiệu như mức công suất, dạng sóng dòng, pha, hoặc các đặc trưng Fourier, sau đó so sánh với cơ sở dữ liệu mẫu đã biết hoặc áp dụng các mô hình học máy để xác định loại thiết bị đang hoạt động.  

Hệ thống NILM có nhiều ứng dụng thực tiễn. Trong nhà thông minh, nó giúp giám sát mức tiêu thụ của từng thiết bị và cảnh báo khi có tiêu thụ điện bất thường. Trong quản lý năng lượng, NILM giúp người dùng tối ưu hóa việc sử dụng điện, từ đó giảm chi phí hóa đơn và lượng phát thải carbon. Trong giám sát công nghiệp, nó cho phép theo dõi hiệu suất và trạng thái thiết bị trong dây chuyền sản xuất mà không cần gắn cảm biến rời cho từng máy. Ngoài ra, NILM còn hỗ trợ nghiên cứu và phân tích dữ liệu tiêu thụ, giúp lập kế hoạch quản lý tải điện hiệu quả.  

Tuy nhiên, hệ thống này vẫn tồn tại một số hạn chế kỹ thuật. Việc phân biệt các thiết bị có đặc trưng tín hiệu tương tự nhau vẫn còn khó khăn, ví dụ như nhiều loại bóng đèn hoặc thiết bị điện tử có mô hình bật/tắt gần giống nhau. Khi nhiều thiết bị bật/tắt cùng lúc, độ chính xác giảm do tín hiệu nhiễu và chồng lấn. NILM cũng phụ thuộc vào dữ liệu huấn luyện; nếu mô hình chưa được huấn luyện với các thiết bị cụ thể trong thực tế, độ chính xác nhận dạng sẽ giảm. Bên cạnh đó, NILM vẫn chưa thể hoàn toàn thay thế các cảm biến vật lý, đặc biệt đối với những thiết bị có đặc tính điện phức tạp hoặc hệ thống yêu cầu giám sát thời gian thực cực cao.  

Do đó, các hướng nghiên cứu hiện nay tập trung vào nâng cao khả năng phát hiện sự kiện và giảm bỏ sót các thay đổi nhỏ trong tín hiệu, tăng độ chính xác nhận dạng bằng cách áp dụng các mô hình học máy tiên tiến, kết hợp dữ liệu thời gian thực và dữ liệu lịch sử. Ngoài ra, việc thử nghiệm trên các nền tảng mô phỏng như Python hoặc MATLAB trước khi triển khai thực tế cũng là bước quan trọng giúp đánh giá hiệu năng và tối ưu thuật toán.  

Hệ thống NILM hiện đang được xem là một giải pháp hứa hẹn trong quản lý năng lượng thông minh, đồng thời mở ra nhiều hướng nghiên cứu về xử lý tín hiệu, học máy và IoT trong môi trường năng lượng.


\section{Phân loại hệ thống NILM}

Hiện nay, các hệ thống NILM (Non-Intrusive Load Monitoring) được phát triển theo hai hướng tiếp cận chính là hướng liên tục (Continuous-based NILM) và hướng theo sự kiện (Event-based NILM). Mỗi hướng tiếp cận có triết lý xử lý tín hiệu và ưu, nhược điểm riêng, tùy thuộc vào mục tiêu và điều kiện triển khai của hệ thống

Mỗi hướng có triết lý khác nhau về cách xử lý tín hiệu:

\begin{itemize}
    \item Continuous: “Theo dõi suốt quá trình tiêu thụ”
    \item Event: “Chỉ chú ý khi có thay đổi rõ ràng”
\end{itemize}

\subsection{Hướng tiếp cận liên tục (Continuous-based)}

\textbf{Nguyên lý hoạt động:}

Hệ thống theo hướng này sẽ phân tích toàn bộ chuỗi tín hiệu tổng (dòng điện, điện áp, công suất tức thời, v.v.) trong suốt thời gian hoạt động. Dữ liệu được thu thập liên tục và đưa vào mô hình xử lý để dự đoán trạng thái bật/tắt của từng thiết bị tại mỗi thời điểm. Quá trình này đòi hỏi mô hình có khả năng học và theo dõi sự biến đổi liên tục của tín hiệu trong thời gian thực.

\textbf{Đặc điểm nổi bật:}

\begin{itemize}
    \item Cho phép dự đoán chi tiết và liên tục trạng thái của từng thiết bị.
    \item Có thể học được hành vi tiêu thụ dài hạn hoặc các dạng sóng phức tạp của thiết bị.
\end{itemize}

\textbf{Nhược điểm:}

\begin{itemize}
    \item Cần dữ liệu huấn luyện có gán nhãn chi tiết theo thời gian, điều này khiến việc thu thập dữ liệu trở nên khó khăn và tốn công.
    \item Khối lượng tính toán lớn, khó triển khai trên thiết bị nhúng hoặc trong hệ thống cần giám sát nhiều thiết bị cùng lúc.
    \item Mô hình cần học tất cả các tổ hợp bật/tắt khả dĩ giữa các thiết bị, khiến chi phí huấn luyện tăng theo cấp số nhân khi số thiết bị tăng.
\end{itemize}

\textbf{Ví dụ:}
Nếu hệ thống có 3 thiết bị gồm đèn (500W), máy lạnh (1000W) và bơm nước (1500W), 
tổng số tổ hợp trạng thái bật/tắt có thể xảy ra là \( 2^3 = 8 \).
Khi thêm thiết bị thứ tư, số tổ hợp tăng lên \( 2^4 = 16 \).
Điều này cho thấy việc mở rộng hệ thống sẽ khiến mô hình huấn luyện ngày càng 
phức tạp và khó khả thi trong thực tế.

\subsection{Hướng tiếp cận theo sự kiện (Event-based)}

\textbf{Nguyên lý hoạt động:}

\begin{itemize}
    \item Phát hiện sự kiện:
\end{itemize}

Xác định các thời điểm xảy ra sự thay đổi trạng thái của thiết bị dựa trên biến động công suất tức thời (thường sử dụng ngưỡng ∆P). Các điểm có mức thay đổi lớn được xem là ứng viên sự kiện bật hoặc tắt.

\begin{itemize}
    \item Trích xuất đặc trưng quanh sự kiện:
\end{itemize}

Từ mỗi sự kiện được phát hiện, tiến hành lấy một đoạn tín hiệu ngắn trước và sau thời điểm xảy ra sự kiện để xây dựng đặc trưng. Các đặc trưng có thể bao gồm: độ biến thiên công suất, gradient, dạng sóng tín hiệu (waveform), hoặc các biến đổi liên quan.

\begin{itemize}
    \item Phân loại sự kiện:
\end{itemize}
Mô hình máy học sẽ nhận các đặc trưng này và dự đoán thiết bị tương ứng gây ra sự kiện bật/tắt.

\textbf{Ưu điểm của phương pháp}

\begin{itemize}
    \item Không yêu cầu gán nhãn toàn bộ chuỗi tín hiệu, chỉ cần gán nhãn tại thời điểm bật/tắt, giúp giảm đáng kể chi phí thu thập và xử lý dữ liệu.
    \item Tập trung vào thông tin quan trọng nhất, cụ thể là thời điểm có thay đổi trạng thái, từ đó nâng cao hiệu quả của mô hình phân loại.
\end{itemize}

\subsection{So sánh hai hướng tiếp cận trong NILM}

\begin{table}[h]{So sánh giữa Continuous-based NILM và Event-based NILM}
    \centering
    \begin{tabularx}{\linewidth}{|X|X|X|}
        \hline
        \textbf{Tiêu chí} & \textbf{Continuous-based NILM} & \textbf{Event-based NILM} \\ \hline

        Cách tiếp cận 
        & Phân tích toàn bộ chuỗi tín hiệu theo thời gian 
        & Chỉ phân tích các sự kiện bật/tắt thiết bị \\ \hline

        Tín hiệu đầu vào 
        & Chuỗi tín hiệu liên tục: $P(t)$, $I(t)$, ... 
        & Đoạn tín hiệu ngắn quanh thời điểm sự kiện \\ \hline

        Yêu cầu dữ liệu gán nhãn 
        & Cần gán nhãn từng thời điểm 
        & Chỉ cần gán nhãn tại thời điểm bật/tắt \\ \hline

        Khả năng mở rộng 
        & Khó mở rộng nếu số lượng thiết bị lớn 
        & Dễ mở rộng vì chỉ xử lý các điểm quan trọng \\ \hline

        Phù hợp cho hệ thống thực tế 
        & Hạ tầng có số lượng thiết bị giới hạn 
        & Hạ tầng có nhiều thiết bị, ưu tiên thời điểm bật/tắt \\ \hline

        Hạn chế chính 
        & Khó huấn luyện và khó mở rộng mô hình 
        & Có thể bỏ sót sự kiện hoặc gặp sự kiện trùng lặp gây nhầm lẫn \\ \hline
    \end{tabularx}
\end{table}

\textbf{Hướng Continuous-based (phân tích liên tục)}

Ở hướng tiếp cận này, mô hình phải học và nhận diện toàn bộ các tổ hợp trạng thái có thể xảy ra của tất cả thiết bị trong hệ thống.

Ví dụ minh họa, giả sử có 3 thiết bị:

\begin{itemize}
    \item Đèn (500W)
    \item Máy lạnh (1000W)
    \item Bơm nước (1500W)
\end{itemize}

Khi đó sẽ có tổng cộng $2^3=8$ tổ hợp bật/tắt (chỉ đèn bật, đèn + máy lạnh bật, chỉ bơm bật, ...). Nếu thêm một thiết bị thứ tư, số tổ hợp tăng lên thành $2^4=16$

Điều này dẫn đến hệ quả:

\begin{itemize}
    \item Khi thêm thiết bị mới, mô hình cần được huấn luyện lại để học toàn bộ tổ hợp mới.
    \item Khi xuất hiện thiết bị lạ (chưa từng thấy trong quá trình huấn luyện), mô hình dễ bị sai lệch.
    \item Việc huấn luyện trở nên phức tạp khi số lượng thiết bị lớn, gây khó khăn khi triển khai trong các thiết bị nhúng hoặc hệ thống có tài nguyên hạn chế.
\end{itemize}

\textbf{Hướng Event-based (phân tích theo sự kiện)}

Trong hướng tiếp cận này, hệ thống chỉ phân tích tín hiệu trong khoảng thời gian xảy ra sự kiện bật hoặc tắt.

Các đặc điểm chính:

\begin{itemize}
    \item Mỗi thiết bị chỉ cần một mô hình phân loại tại thời điểm nó thay đổi trạng thái.
    \item  Không cần xét các tổ hợp thiết bị bật cùng lúc.
\end{itemize}

Ví dụ:

Khi đèn bật, hệ thống chỉ cần phân tích tín hiệu tại thời điểm xuất hiện sự kiện để xác định xem đó có phải là “đèn” hay không, mà không cần tính đến trạng thái của máy lạnh hay bơm nước.

Ưu điểm đáng chú ý:

\begin{itemize}
    \item Khi thêm thiết bị mới, chỉ cần huấn luyện mô hình cho thiết bị đó mà không ảnh hưởng đến các mô hình cũ.
    \item Nếu có thiết bị lạ xuất hiện, hệ thống có thể coi là sự kiện không hợp lệ hoặc sự kiện nhiễu mà không gây ảnh hưởng lớn.
\end{itemize}

\textbf{Lưu ý khi lựa chọn hướng tiếp cận}

Mặc dù phương pháp dựa trên sự kiện có ưu điểm về tính nhẹ và khả năng mở rộng, nó vẫn tồn tại rủi ro nếu bỏ sót sự kiện hoặc phân loại nhầm, dẫn đến tích lũy sai số theo thời gian.

Do đó, lựa chọn phương pháp phù hợp phụ thuộc vào mục tiêu ứng dụng:

\begin{itemize}
    \item Nếu hệ thống chỉ cần theo dõi một số thiết bị cố định, ít thay đổi: Phương pháp phân tích liên tục có thể phù hợp hơn vì theo dõi chi tiết và liên tục toàn bộ tín hiệu.
    \item Nếu hệ thống phải giám sát nhiều thiết bị, hoặc số lượng thiết bị có thể thay đổi linh hoạt: Phương pháp dựa trên sự kiện là lựa chọn tốt nhờ khả năng mở rộng, đơn giản hóa việc huấn luyện.
\end{itemize}


\section{Đặt vấn đề}

Mặc dù NILM đã được nghiên cứu trong nhiều năm, nhưng các hệ thống hiện tại vẫn gặp phải nhiều hạn chế thực tế. Đa phần các mô hình trong các công trình nghiên cứu giả định rằng tại một thời điểm chỉ có một thiết bị thay đổi trạng thái (bật hoặc tắt). Giả định này giúp việc huấn luyện và phân loại tín hiệu trở nên dễ dàng hơn, nhưng lại không phản ánh đúng môi trường thực tế — nơi có thể có nhiều thiết bị bật tắt gần như đồng thời, gây chồng lấn tín hiệu và dẫn đến bỏ sót sự kiện hoặc nhận dạng sai thiết bị. Ngoài ra, các thuật toán phát hiện sự kiện thường nhạy cảm với nhiễu hoặc thay đổi nhỏ trong tín hiệu, khiến hệ thống mất ổn định khi triển khai trong thực tế.

Trước những hạn chế đó, đề tài này tập trung vào việc xây dựng và kiểm chứng một hệ thống NILM có khả năng phát hiện chính xác các sự kiện bật/tắt của thiết bị ngay cả trong môi trường có nhiều tải hoạt động đồng thời. Hệ thống được thiết kế nhằm hạn chế việc bỏ lỡ sự kiện và duy trì độ chính xác nhận dạng thiết bị trong điều kiện phức tạp.

Trong nghiên cứu này, dữ liệu điện áp và dòng điện được thu thập từ hệ thống thực tế, sau đó được xử lý và phân tích ngoại tuyến trên môi trường máy tính bằng ngôn ngữ Python. Các thuật toán được áp dụng để xử lý tín hiệu điện tổng, trích xuất đặc trưng của từng sự kiện, xác định thời điểm bật/tắt và nhận dạng loại thiết bị tương ứng. Việc triển khai trên nền tảng phần mềm cho phép đánh giá hiệu quả của thuật toán một cách trực tiếp trên dữ liệu thực nghiệm mà không cần mô phỏng mô hình phần cứng.

Kết quả nghiên cứu hướng đến việc tăng độ tin cậy của hệ thống NILM trong môi trường thực tế, đồng thời mở ra khả năng ứng dụng vào các hệ thống nhà thông minh (Smart Home), quản lý năng lượng (Energy Management Systems) và giám sát tiêu thụ điện trong công nghiệp.


\section{Mục tiêu nghiên cứu}
Đề tài hướng đến việc xây dựng và đánh giá một hệ thống NILM hướng sự kiện có khả năng hoạt động ổn định trong môi trường phức tạp, dựa trên dữ liệu đo thực tế, với các mục tiêu cụ thể sau:
\begin{itemize}
    \item Phát hiện chính xác các sự kiện bật/tắt của thiết bị từ tín hiệu điện tổng thu thập từ hệ thống thực.
    \item Giảm thiểu tỉ lệ bỏ lỡ sự kiện (missed events) và giảm nhiễu trong quá trình phát hiện và nhận dạng.
    \item Nhận dạng thiết bị dựa trên các đặc trưng của tín hiệu như công suất tức thời, dòng điện và điện áp.
    \item Giới thiệu một bộ dữ liệu thực nghiệm mới, ghi nhận điện áp và dòng điện tức thời của nhiều thiết bị trong các sự kiện bật/tắt. Bộ dữ liệu này chưa từng tồn tại trước đây, cung cấp nền tảng kiểm thử trực tiếp cho hệ thống NILM hướng sự kiện, tương tự PLAID dataset nhưng phản ánh điều kiện thực tế một cách chân thực hơn và phù hợp trong môi trường điện áp Việt Nam.
    \item Triển khai và kiểm thử các thuật toán xử lý tín hiệu và phát hiện sự kiện trong môi trường phần mềm (Python) theo phương thức xử lý ngoại tuyến, đồng thời trực quan hóa và đánh giá hiệu quả thuật toán.
    \item Tạo nền tảng cho việc phát triển và triển khai hệ thống NILM trong thực tế, hướng tới các ứng dụng trong nhà thông minh và quản lý năng lượng.
\end{itemize}

\section{Phạm vi nghiên cứu}
Hệ thống được nghiên cứu và kiểm thử dựa trên dữ liệu đo thực tế, không triển khai trực tiếp trên phần cứng đo đạc trong thời gian thực.

Dữ liệu tín hiệu điện áp và dòng điện được thu thập từ nhiều thiết bị trong các sự kiện bật/tắt, sau đó được xử lý và phân tích ngoại tuyến trong môi trường Python.

Phạm vi nghiên cứu tập trung vào:
\begin{itemize}
    \item Phát hiện các sự kiện bật/tắt của thiết bị từ tín hiệu điện tổng.
    \item Nhận dạng thiết bị dựa trên các đặc trưng của tín hiệu.
    \item Đánh giá hiệu quả hệ thống trong môi trường có nhiều thiết bị hoạt động đồng thời.
\end{itemize}

Các yếu tố như ước lượng năng lượng tiêu thụ theo thời gian dài, tối ưu hóa nâng cao mô hình học máy, hay triển khai thời gian thực trên phần cứng không thuộc phạm vi của đề tài.

\section{Cấu trúc của khóa luận}

Khóa luận này được tổ chức thành 7 chương, mỗi chương trình bày một cách mạch lạc và chi tiết, giúp người đọc dễ dàng theo dõi quá trình nghiên cứu, từ lý thuyết cơ bản đến triển khai và đánh giá hệ thống NILM dựa trên dữ liệu đo thực tế.

Cấu trúc cụ thể của khóa luận như sau:

\begin{itemize}
    \item \textbf{Chương 1: Giới thiệu} – Trình bày bối cảnh nghiên cứu về NILM, các hướng tiếp cận phổ biến, đặt vấn đề, mục tiêu và phạm vi nghiên cứu. Đồng thời, chương này nêu tổng quan về đóng góp chính của đề tài, bao gồm xây dựng hệ thống NILM hướng sự kiện và bộ dữ liệu thực nghiệm mới.
    
    \item \textbf{Chương 2: Tổng quan hệ thống NILM đề xuất} – Mô tả kiến trúc và các thành phần chính của hệ thống, bao gồm khối thu thập dữ liệu, phát hiện sự kiện, tiền xử lý và trích xuất đặc trưng, nhận dạng thiết bị. Chương này cũng nêu ưu điểm nổi bật và các hạn chế cùng hướng khắc phục.
    
    \item \textbf{Chương 3: Thu thập dữ liệu} – Trình bày phương pháp thu thập dữ liệu thực nghiệm, bao gồm các sự kiện bật/tắt của nhiều thiết bị, phạm vi thực hiện và ghi chú về triển khai thực tế. Chương này cũng giới thiệu bộ dữ liệu mới được xây dựng, phục vụ trực tiếp cho kiểm thử hệ thống NILM hướng sự kiện.
    
    \item \textbf{Chương 4: Thuật toán phát hiện sự kiện} – Trình bày tổng quan thuật toán phát hiện sự kiện đề xuất được áp dụng, áp dụng nhiều phương pháp bao gồm lọc trung bình, WAMMA, bộ lọc Kalman, và thuật toán Hybrid của Mengqi Lu và Zuyi Li. Chương này cũng trình bày cách đánh giá hiệu quả các thuật toán.
    
    \item \textbf{Chương 5: Tiền xử lý dữ liệu và trích xuất đặc trưng} – Trình bày mục tiêu của giai đoạn tiền xử lý, phương pháp trích xuất đặc trưng công suất và đặc trưng ảnh, cơ sở lý thuyết, vấn đề thực tế, phương pháp tính toán và kết quả thu được.
    
    \item \textbf{Chương 6: Mô hình học máy} – Trình bày các mô hình học máy được áp dụng cho việc nhận dạng thiết bị dựa trên đặc trưng tín hiệu đã trích xuất, cũng như các bước huấn luyện, kiểm thử và tối ưu hóa mô hình.
    
    \item \textbf{Chương 7: Kết quả và đánh giá hệ thống} – Trình bày dữ liệu đánh giá, quy trình đánh giá, kết quả thực nghiệm của các thuật toán phát hiện sự kiện, nhận xét và phân tích hiệu quả hệ thống.
\end{itemize}

Cấu trúc này giúp làm rõ quá trình nghiên cứu từ lý thuyết đến triển khai thực nghiệm và đánh giá thuật toán, đồng thời nhấn mạnh đóng góp chính của đề tài trong việc phát triển hệ thống NILM hướng sự kiện và bộ dữ liệu thực nghiệm phục vụ quản lý năng lượng hiệu quả trong môi trường gia đình.

\chapter{Tổng quan hệ thống NILM đề xuất}
\section{Kiến trúc và các thành phần chính của hệ thống}
\begin{figure}[H]{Sơ đồ hệ thống NILM}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/LuongHeThongNILM.jpg}
\end{figure}

Hệ thống NILM đề xuất bao gồm các khối chức năng chính như sau

\subsection{Khối thu thập tín hiệu}

\begin{itemize}
    \item Thu thập dữ liệu dòng điện (I) và điện áp (U) từ công tơ tổng theo thời gian thực.
    \item Từ các tín hiệu này, tính toán công suất tiêu thụ (P) của toàn hệ thống.
    \item Đây là dữ liệu đầu vào cho toàn bộ quá trình xử lý tiếp theo.
\end{itemize}

\subsection{Khối phát hiện sự kiện bật/tắt thiết bị}
\begin{itemize}
    \item Mục tiêu của khối này là phát hiện chính xác thời điểm mà một thiết bị trong hệ thống thay đổi trạng thái (bật hoặc tắt).
    \item Đề tài đề xuất thuật toán phát hiện sự kiện kết hợp gồm: \begin{itemize}
        \item Bộ lọc trung bình + WAMMA: dùng để định biên (phát hiện ranh giới) sự kiện
        \item Bộ lọc Kalman kết hợp thuật toán MLZI cải tiến: giúp giảm nhiễu và tăng độ nhạy trong việc nhận biết biến động công suất.
    \end{itemize}
    \item Kết quả của khối này là danh sách các thời điểm được xác định là có sự kiện bật/tắt xảy ra
\end{itemize}

\subsection{Khối tiền xử lý và trích xuất đặc trưng}
\begin{itemize}
    \item Sau khi phát hiện sự kiện, hệ thống cắt đoạn tín hiệu quanh thời điểm xảy ra sự kiện để phân tích chi tiết.
    \item Tính toán delta P (ΔP) – độ chênh lệch công suất trước và sau sự kiện.
    \item Từ tín hiệu I–V, hệ thống xây dựng đặc trưng đồ thị và chuyển đổi thành dạng ảnh tín hiệu (signal image).
    \item Các đặc trưng này được dùng làm đầu vào cho mô hình học máy ở bước tiếp theo.
\end{itemize}

\subsection{Khối nhận diện thiết bị}
\begin{itemize}
    \item Ứng dụng mô hình học máy MLP (Multilayer Perceptron) để phân loại thiết bị dựa trên đặc trưng tín hiệu và hình ảnh được trích xuất.
    \item Mỗi sự kiện được gán nhãn là thiết bị tương ứng gây ra biến động công suất.
\end{itemize}

\section{Ưu điểm nổi bật của hệ thống đề xuất}
So với các nghiên cứu trước, hệ thống NILM đề xuất có nhiều ưu điểm đáng chú ý:

\textbf{Phát hiện sự kiện chính xác vượt trội}

Nhờ kết hợp nhiều thuật toán tối ưu (WAMMA, Kalman, MLZI cải tiến), hệ thống có khả năng phát hiện sự kiện gần như không bỏ sót, cho độ chính xác cao hơn hầu hết các phương pháp đã được công bố.

\textbf{Xử lý thiết bị lạ và loại bỏ sự kiện giả}

Hệ thống tự động nhận biết và loại bỏ các sự kiện bất thường hoặc đến từ thiết bị chưa được huấn luyện, thay vì giả định một tập thiết bị cố định như trong đa số các nghiên cứu truyền thống.

\textbf{Không giới hạn số lượng và trạng thái thiết bị}

Hệ thống hoạt động ổn định và hiệu quả ngay cả khi có nhiều thiết bị hoạt động đồng thời, với nhiều trạng thái bật/tắt khác nhau. Điều này giúp mô hình có khả năng mở rộng cao và phù hợp với môi trường sử dụng thực tế.

\section{Hạn chế và hướng khắc phục}
Bên cạnh các ưu điểm, hệ thống vẫn tồn tại một số hạn chế cần lưu ý:

\textbf{Chi phí tính toán cao}

Quá trình trích xuất đặc trưng và so sánh ảnh tín hiệu đòi hỏi tài nguyên xử lý lớn, không phù hợp để chạy trực tiếp trên các vi điều khiển đơn giản, cần phải tối ưu trong tương lai.

\textbf{Yêu cầu phần cứng mạnh}

Để triển khai trong thực tế, hệ thống cần chạy trên các thiết bị có năng lực xử lý tương đối tốt như Raspberry Pi hoặc Orange Pi.

\textbf{Không phát hiện được sự kiện xảy ra quá gần nhau}

Do giới hạn trong khâu định biên sự kiện, các sự kiện bật/tắt có khoảng thời gian quá ngắn giữa chúng có thể bị gộp hoặc bỏ sót

\chapter{Thu thập dữ liệu}
Trong phạm vi đồ án, dữ liệu được thu thập dưới dạng điện áp (U) và dòng điện (I) tức thời, liên tục trên mạng điện gia đình phục vụ cho bài toán NILM. Quá trình thu thập được thực hiện theo phương pháp bán thủ công, nhằm tạo ra các tập dữ liệu có chứa sự thay đổi trạng thái của thiết bị điện để phục vụ đánh giá và nhận diện sự kiện.

\section{Phương pháp thu thập}

Dữ liệu U và I được ghi nhận liên tục trong khi hệ thống đang hoạt động ở các trạng thái khác nhau của tập thiết bị gia đình. Trong mỗi lần thu thập, chúng tôi lựa chọn một tổ hợp thiết bị đang hoạt động ổn định (ví dụ bật đèn + quạt + laptop đang sạc). Sau đó, chúng tôi chủ động thay đổi trạng thái của một thiết bị duy nhất tại một thời điểm, chẳng hạn bật tủ lạnh, tắt sạc máy tính, hoặc bật máy sấy.

Mỗi sự kiện thay đổi trạng thái thiết bị đều được thu thập theo quy trình:
\begin{itemize}
    \item Ghi lại tín hiệu U và I trước thời điểm thiết bị thay đổi trạng thái (vùng “pre-event”).
    \item  Ghi lại tín hiệu U và I sau thời điểm thiết bị thay đổi trạng thái (vùng “post-event”).
    \item Hai vùng dữ liệu này được lưu dưới dạng các mẫu liên tục, dùng làm cơ sở để đánh giá khả năng phát hiện và nhận diện sự kiện.
\end{itemize}

\begin{figure}[H]{Sơ đồ hệ thống thu thập dữ liệu được sử dụng}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/measurement_system.png}
\end{figure}

\section{Phạm vi thực hiện}
Trong đồ án này, dữ liệu chỉ được sử dụng để đánh giá và nhận diện trên máy tính, thông qua file dữ liệu và xử lý bằng Python. Hệ thống chưa được triển khai thực tế, mà mới dừng ở mức mô phỏng quá trình phát hiện sự kiện và nhận diện dựa trên dữ liệu đã thu thập.

\section{Ghi chú về triển khai thực tế}

Trong ứng dụng thực tế của NILM, để xác định đúng vùng trước và sau của mỗi sự kiện, hệ thống phải liên tục lưu trữ và cập nhật tín hiệu U và I theo thời gian thực. Điều này giúp bất cứ khi nào có sự kiện phát sinh (ví dụ thiết bị bật/tắt), hệ thống luôn có sẵn vùng tín hiệu “trước sự kiện” và “sau sự kiện” để đưa vào thuật toán phát hiện và nhận diện.

\chapter{Thuật toán phát hiện sự kiện}
\section{Tổng quan thuật toán phát hiện sự kiện}

Trong bài toán phân tích phụ tải phi xâm lấn (NILM), sự kiện (event) được hiểu là thời điểm một thiết bị điện thay đổi trạng thái (bật hoặc tắt), dẫn đến biến thiên đáng kể trong tín hiệu dòng điện, điện áp hoặc công suất.

\textbf{Một số thuật ngữ cơ bản:}
\begin{table}[h]{Giải thích một số thuật ngữ về thuật toán phát hiện sự kiện}
    \centering
    \begin{adjustbox}{width=\linewidth}
        \begin{tabularx}{\linewidth}{| >{\centering\arraybackslash}p{3cm} | X |}
            \hline
            \textbf{Thuật ngữ} & \textbf{Giải thích} \\
            \hline
            Sự kiện (Event) & Thời điểm thiết bị bật hoặc tắt, gây thay đổi đột ngột trong dòng điện hoặc công suất. \\
            \hline
            Cửa sổ (Window) & Một đoạn tín hiệu con được trích từ chuỗi tín hiệu dài để phân tích tại một thời điểm xác định. \\
            \hline
        \end{tabularx}
    \end{adjustbox}
\end{table}

\textbf{Mục tiêu của bộ phát hiện sự kiện}
\begin{itemize}
    \item Xác định chính xác thời điểm thiết bị chuyển trạng thái (bật/tắt).
    \item Đây là bước nền tảng trong các hệ thống NILM, vì chất lượng của quá trình tách thiết bị và trích xuất đặc trưng phụ thuộc trực tiếp vào độ chính xác của việc phát hiện sự kiện.
\end{itemize}

\textbf{Nguyên lý hoạt động}

Tín hiệu công suất P được chia thành các cửa sổ thời gian có độ dài xác định. Với mỗi cửa sổ trượt, thuật toán so sánh công suất trung bình giữa hai phía (trước và sau) quanh một điểm nghi ngờ là sự kiện:
$$
\Delta P = \left| \overline{P}_{\text{trước}} - \overline{P}_{\text{sau}} \right|
$$

Nếu $\Delta P$ vượt quá một ngưỡng định trước, điểm này được xem là có khả năng xảy ra sự kiện — tức là thiết bị đã thay đổi trạng thái.

Quy trình tổng thể của hệ thống phát hiện sự kiện được mô tả như sau:

\textbf{1. Lọc và giảm tần số mẫu đầu vào} 
Tín hiệu đầu vào được giảm tần số mẫu, ví dụ từ 1000~Hz xuống 100~Hz. Việc giảm tần số nhằm:
\begin{itemize}
    \item Giảm nhiễu trong tín hiệu.
    \item Giảm khối lượng tính toán, tối ưu hiệu năng hệ thống.
\end{itemize}

\textbf{2. Tách tín hiệu thành hai nhánh xử lý song song}

\textit{Nhánh 1 – Thuật toán phát hiện tần số cao:}
\begin{itemize}
    \item Sử dụng thuật toán WAMMA để phát hiện các sự kiện có biên độ lớn và thay đổi rõ rệt.
\end{itemize}

\textit{Nhánh 2 – Thuật toán phát hiện tần số thấp:}
\begin{itemize}
    \item Lọc trung bình lần hai để làm mượt tín hiệu.
    \item Sử dụng bộ lọc Kalman nhằm loại bỏ nhiễu ngẫu nhiên.
    \item Áp dụng thuật toán MLZLI để phát hiện các sự kiện nhỏ hoặc xảy ra chậm.
\end{itemize}

\textbf{3. Khối gộp sự kiện (Event Merging) và ra quyết định} 

\begin{itemize}
    \item Kết hợp kết quả từ hai nhánh xử lý.
    \item Loại bỏ các sự kiện xuất hiện quá gần nhau (dưới ngưỡng thời gian tối thiểu).
    \item Tạo ra danh sách sự kiện cuối cùng, đảm bảo tính chính xác và ổn định của hệ thống.
\end{itemize}

\begin{figure}[H]{Sơ đồ thuật toán phát hiện sự kiện đề xuất}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Event_Dectection/sodoevt.jpg}
\end{figure}

\section{Lọc trung bình}
Bộ lọc trung bình (Moving Average Filter) được sử dụng để làm mượt tín hiệu bằng cách thay thế giá trị tại mỗi điểm bằng giá trị trung bình của một nhóm điểm lân cận. Phương pháp này giúp loại bỏ các dao động nhỏ và nhiễu cục bộ xuất hiện trong quá trình đo.

Công thức của bộ lọc trung bình với cửa sổ M điểm được viết như sau:
\[
y[n] = \frac{1}{M} \sum_{k=0}^{M-1} x[n-k]
\]
Trong đó:
\begin{itemize}
    \item \(x[n]\) là tín hiệu đầu vào tại mẫu thứ \(n\),
    \item \(y[n]\) là tín hiệu đầu ra sau khi lọc,
    \item \(M\) là số điểm trong cửa sổ trung bình.
\end{itemize}

Ví dụ, với chuỗi tín hiệu ban đầu:
\[
100,\; 101,\; 99,\; 100,\; 102,\; 99
\]
khi áp dụng bộ lọc trung bình với cửa sổ 3 điểm, tín hiệu đầu ra thu được là:
\[
100,\; 100
\]
Qua đó có thể thấy tín hiệu sau khi lọc trở nên mượt và ổn định hơn, thuận lợi cho các bước xử lý tiếp theo.

Trong hệ thống được xây dựng, bộ lọc trung bình còn được sử dụng để giảm tần số mẫu từ 1000~Hz xuống 100~Hz. Việc giảm tần số mẫu mang lại các lợi ích sau:
\begin{itemize}
    \item Giảm nhiễu trong tín hiệu.
    \item Giảm lượng dữ liệu cần xử lý.
    \item Tăng tốc độ và độ ổn định cho các thuật toán phát hiện sự kiện.
\end{itemize}

\begin{figure}[H]{Đồ thị công suất với công suất gốc tần số 30kHz và lấy mẫu lọc trung bình 50Hz trên tập PLAID}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/Event_Dectection/loctb.jpg}
\end{figure}

\section{Thuật toán WAMMA}

\subsection{Giới thiệu}

Trong bước phát hiện sự kiện của hệ thống NILM, việc xác định chính xác các thời điểm thay đổi công suất là rất quan trọng để tách biệt các thiết bị điện khác nhau. Tuy nhiên, các phương pháp sử dụng tham số cố định thường bị ảnh hưởng bởi nhiễu, dao động hoặc các sự kiện xảy ra gần nhau. 

Thuật toán WAMMA (Window with Adaptive Margins and Multi-window Analysis) được đề xuất nhằm khắc phục các hạn chế này bằng cách sử dụng cơ chế tự thích ứng ở cả ngưỡng phát hiện và cấu trúc cửa sổ phân tích. Phương pháp này được trình bày trong nghiên cứu của Yan et al và đã chứng minh hiệu quả vượt trội trong việc phát hiện sự kiện công suất với độ chính xác cao.

\subsection{Nguyên lý hoạt động của thuật toán}

Thuật toán WAMMA dựa trên ba cơ chế chính:

\begin{itemize}
    \item \textbf{(1) Adaptive Window Margins:} 
    Cửa sổ trượt được chia thành ba vùng: vùng biên trái (Left Margin), vùng trung tâm và vùng biên phải (Right Margin). Hai biên này đại diện cho các trạng thái công suất trước và sau sự kiện. Trong quá trình phân tích, kích thước biên được điều chỉnh tự động dựa trên biến thiên công suất và xu hướng tín hiệu để đảm bảo vùng chuyển tiếp của sự kiện được bao trọn hoàn toàn. 
    Cơ chế này giúp thuật toán thích nghi với độ dài khác nhau của các sự kiện chuyển tiếp (ví dụ: bật/tắt thiết bị công suất lớn thường có quá trình chuyển tiếp dài hơn so với thiết bị nhỏ).

    \item \textbf{(2) Adaptive Thresholding:}
    Ngưỡng phát hiện sự kiện không cố định mà được cập nhật động theo độ lệch chuẩn của dữ liệu trong cửa sổ hiện tại. 
    Cụ thể, ngưỡng thích ứng được tính theo công thức:
    \[
    P_{thr,w} = \max(P_{thr}, r_{thr} \times \sigma)
    \]
    trong đó $\sigma$ là độ lệch chuẩn của tín hiệu công suất trong cửa sổ, $P_{thr}$ là ngưỡng tối thiểu định trước, và $r_{thr}$ là hệ số tỉ lệ. 
    Cơ chế này giúp thuật toán tự động điều chỉnh độ nhạy, giảm phát hiện giả khi tín hiệu nhiễu cao và tăng độ chính xác khi tín hiệu ổn định.

    \item \textbf{(3) Multi-window Screening:}
    Để đảm bảo phát hiện ổn định, WAMMA có thể triển khai đồng thời nhiều cửa sổ có kích thước khác nhau. Nếu một sự kiện được phát hiện trong nhiều cửa sổ trượt liên tiếp hoặc ở các độ rộng cửa sổ khác nhau, kết quả đó được xác nhận là sự kiện thật. Cơ chế sàng lọc đa cửa sổ này giúp loại bỏ nhiễu ngắn hạn và cải thiện độ tin cậy của hệ thống.
\end{itemize}

Ngoài ra, WAMMA còn tích hợp cơ chế \textit{cross-validation} giữa các bộ dữ liệu để đánh giá tính ổn định của tham số, chứng minh khả năng tổng quát hóa cao trong môi trường thực tế.

\subsection{Mã giả thuật toán (theo triển khai trong đề tài)}

Thuật toán được mô tả ngắn gọn bằng mã giả dưới đây, dựa trên phần cài đặt Python của đề tài:

\begin{algorithm}[H]
\caption{Thuật toán WAMMA}
\begin{algorithmic}[1]
\Require Chuỗi công suất $P_t$, các tham số $N_w$, $N_m$, $P_{thr}$, $r_{thr}$
\State Khởi tạo cửa sổ trượt rỗng và giá trị biên ban đầu
\For{mỗi mẫu công suất $p$ trong chuỗi $P_t$}
    \State Thêm $p$ vào cửa sổ hiện tại
    \If{độ dài cửa sổ $<$ $N_w$}
        \State Tiếp tục đọc dữ liệu (chưa đủ mẫu)
        \State \textbf{continue}
    \EndIf
    \State Tính giá trị trung bình $u$ và độ lệch chuẩn $\sigma$
    \State Cập nhật ngưỡng thích ứng: $P_{thr,w} = \max(P_{thr}, r_{thr} \times \sigma)$
    \State Tính biến thiên công suất biên trái $\Delta P_L$ và biên phải $\Delta P_R$
    \If{$\Delta P_L$ hoặc $\Delta P_R$ vượt ngưỡng cục bộ}
        \State Điều chỉnh biên trái/phải, mở rộng cửa sổ
        \State \textbf{continue}
    \EndIf
    \State Tính trung bình biên trái $u_L$ và phải $u_R$
    \State $\Delta P = u_R - u_L$
    \If{$\Delta P > P_{thr,w}$}
        \State Ghi nhận sự kiện bật (ON)
    \ElsIf{$\Delta P < -P_{thr,w}$}
        \State Ghi nhận sự kiện tắt (OFF)
    \EndIf
    \State Khởi tạo lại cửa sổ để tiếp tục phát hiện sự kiện tiếp theo
\EndFor
\end{algorithmic}
\end{algorithm}

\subsection{Phân tích và đánh giá}

WAMMA mang lại một số ưu điểm nổi bật so với các phương pháp truyền thống như CUSUM hay GLR:
\begin{itemize}
    \item Thích ứng tốt với nhiễu và dao động do điều khiển điện tử.
    \item Không cần tinh chỉnh tham số thủ công khi áp dụng cho các hộ gia đình khác nhau.
    \item Có thể mở rộng sang các tập dữ liệu có tần số lấy mẫu khác nhau (20 Hz, 50 Hz, 60 Hz).
\end{itemize}

Các thử nghiệm trên bộ dữ liệu LIFTED (50 Hz) và BLUED (60 Hz) trong nghiên cứu gốc cho thấy, phương pháp WAMMA đạt độ chính xác cao hơn và độ nhạy tốt hơn so với các kỹ thuật phát hiện sự kiện hiện có, đồng thời duy trì khả năng ổn định khi thay đổi tập dữ liệu.

\section{Bộ lọc Kalman}
Bộ lọc Kalman là một phương pháp ước lượng trạng thái tối ưu, được sử dụng để làm mượt tín hiệu trong các hệ thống có nhiễu. Nguyên tắc cơ bản là kết hợp giá trị dự đoán từ dữ liệu trước đó với giá trị quan sát thực tế, nhằm tạo ra một tín hiệu mượt và chính xác hơn.

Với dữ liệu công suất 1 chiều, bộ lọc Kalman có thể được mô tả đơn giản như sau:

\begin{enumerate}
    \item \textbf{Dự đoán giá trị tiếp theo:}
    \[
    \hat{x}_{k|k-1} = \hat{x}_{k-1}
    \]

    \item \textbf{Cập nhật ước lượng với quan sát thực tế:}
    \[
    \hat{x}_k = \hat{x}_{k|k-1} + K_k (z_k - \hat{x}_{k|k-1})
    \]

    \item \textbf{Trọng số Kalman \(K_k\)} xác định mức độ tin tưởng vào quan sát mới, giá trị trong khoảng từ 0 đến 1.
\end{enumerate}

Trong đó: 
\begin{itemize}
    \item $\hat{x}_k$ là giá trị công suất đã làm mượt tại thời điểm $k$,
    \item $z_k$ là giá trị quan sát thực tế,
    \item $K_k$ là trọng số Kalman.
\end{itemize}

\textbf{Tác dụng trong đề tài:}  
Trong đồ án này, bộ lọc Kalman được áp dụng trước thuật toán Hybrid để làm mượt tín hiệu công suất, giúp nhận diện các sự kiện tiêu thụ điện năng chậm, yếu hoặc bị che khuất trong môi trường công suất thay đổi mạnh (CVDs). Nhờ đó, việc phát hiện các sự kiện trở nên chính xác và ổn định hơn, giảm nhiễu và dao động nền, tạo điều kiện thuận lợi cho các bước xử lý tiếp theo.


\section{Thuật toán Hybrid của Mengqi Lu và Zuyi Li}

Sau khi hoàn tất quá trình tiền xử lý bằng Bộ lọc Trung bình (Averaging Filter) và Bộ lọc Kalman (Kalman Filter), chúng tôi áp dụng Thuật toán Phát hiện Cơ sở (Base Detection Algorithm) – một thành phần của Thuật toán Hybrid được đề xuất bởi Mengqi Lu và Zuyi Li – lên dữ liệu đã được làm mượt. Thuật toán này xác định các sự kiện chuyển mạch dựa trên tiêu chí chênh lệch lớn giữa công suất trung bình trước và sau một điểm thời gian quan sát. Chức năng chính của phương pháp này là nâng cao khả năng phát hiện các sự kiện có biên độ nhỏ hoặc dễ bị che khuất trong môi trường có sự biến động công suất mạnh.

Thuật toán Cơ sở hoạt động bằng cách tìm kiếm sự chênh lệch lớn về công suất trung bình đã ước tính ($P_{\text{estimated}}$) giữa hai cửa sổ trượt liền kề.

\textbf{Tính toán Trung bình Động}

Tại mỗi điểm mẫu $i$, thuật toán tính toán công suất trung bình trong hai cửa sổ trượt có kích thước $n$ mẫu:
\begin{align*}
Mean_{i,\text{before}} &= \frac{1}{n} \sum_{j=i-n}^{i-1} P_{\text{estimated}, j} \\
Mean_{i,\text{after}} &= \frac{1}{n} \sum_{j=i+1}^{i+n+1} P_{\text{estimated}, j}
\end{align*}
\textit{Kích thước cửa sổ $n$ được chọn tương ứng với khoảng $10$ giây để tối ưu hóa độ nhạy.}

\textbf{Điều Kiện Phát Hiện Sự Kiện}

Một sự kiện được xác nhận tại thời điểm $i$ nếu độ chênh lệch tuyệt đối giữa hai giá trị trung bình này vượt quá ngưỡng công suất $P_{\text{th}}$:
\begin{equation*}
\text{Sự kiện xảy ra tại } i \text{ nếu } |Mean_{i,\text{after}} - Mean_{i,\text{before}}| > P_{\text{th}}
\end{equation*}

\textbf{Cơ Chế Giới Hạn Thời Gian (Time Limit)}

Để tránh việc phát hiện một quá trình quá độ thành nhiều sự kiện nhỏ, cơ chế Giới hạn Thời gian ($T_{\text{th}}$) được áp dụng. Nếu hai sự kiện được phát hiện liên tiếp trong khoảng thời gian $\Delta t < T_{\text{th}}$ (chọn $T_{\text{th}} = 0.2$ giây theo khuyến nghị của bài báo gốc), chúng sẽ được gộp lại và coi là một sự kiện chuyển trạng thái duy nhất.

Ở trong phạm vi của khóa luận này, MLZL là thuật toán Hybrid của Mengqi Lu và Zuyi Li gốc, và MLZLI là cho thuật toán đó nhưng được chỉnh được áp dụng cho hệ thống đề xuất.

\section{Đánh giá thuật toán}
\begin{table}[H]{Bảng kết quả đánh giá thuật toán phát hiện sự kiện trên tập dữ liệu tự đo}
    \centering
    \begin{tabular}{|c|c|c|c|c|c|c|}
        \hline
        & $WAMMA_1$ & $WAMMA_2$ & $WAMMA_3$ & $MLZL_1$ & $MLZL_2$ & ĐỀ XUẤT \\ \hline
        TPP & 65.3\% & 84.6\% & 75\% & 36\% & 80\% & 100\% \\ \hline
        FPP & 6\% & 17.3\% & 2.3\% & 8\% & 0\% & 14\% \\ \hline
        FNN & 34.7\% & 9.4\% & 25\% & 64\% & 20\% & 0\% \\ \hline
        F1  & 76.2\% & 86.3\% & 86.6\% & 53\% & 92\% & 93.5\% \\ \hline
    \end{tabular}
\end{table}

\textbf{Giải thích}

TPP: (True positive Percentage) Nhận đúng sự kiện

FPP: (False positive Percentage) Không có sự kiện nhưng lại ra có

FNN: (False Negative Percentage) Có sự kiện nhưng không nhận ra

Tham số:

\begin{itemize}
    \item \texttt{WAMMA\_1}: $P_{thre} = 30\ \text{W}$, cửa sổ $10\ \text{s}$, viền $3\ \text{s}$, nhạy nhiễu $=1$, lấy mẫu $10\ \text{Hz}$
    \item \texttt{WAMMA\_2}: $P_{thre} = 20\ \text{W}$, cửa sổ $5\ \text{s}$, viền $2\ \text{s}$, nhạy nhiễu $=0.5$, lấy mẫu $10\ \text{Hz}$
    \item \texttt{WAMMA\_3}: $P_{thre} = 20\ \text{W}$, cửa sổ $8\ \text{s}$, viền $2\ \text{s}$, nhạy nhiễu $=0.1$, lấy mẫu $1\ \text{Hz}$
    \item \texttt{MLZL\_1}: $P_{thre} = 20\ \text{W}$, cửa sổ $10\ \text{s}$, lấy mẫu $100\ \text{Hz}$
    \item \texttt{MLZL\_2}: $P_{thre} = 20\ \text{W}$, cửa sổ $5\ \text{s}$, lấy mẫu $0.1\ \text{Hz}$
    \item \textbf{Đề xuất:} \texttt{WAMMA\_Thre} = 30\,W, \texttt{WAMMA\_WIN\_SEC} = 10\,s, \texttt{WAMMA\_WIN\_BOR} = 3, \texttt{LOW\_DEC} = 0.1\,Hz, \texttt{LOW\_DEC\_Thre} = 10\,W, \texttt{EVENT\_TIME\_LIMIT\_DIF} = 30\,s, \texttt{EVENT\_TIME\_LIMIT\_SAM} = 1\,s
    \item \texttt{LOW\_DEC\_SAMPLING\_SEC} = 10, lấy mẫu 100\,Hz
\end{itemize}


\textbf{Nhận xét}
Các thuật toán gốc nếu là trường hợp đơn giản thì khả năng phát hiện tốt nhờ lấy mẫu công suất thấp, nhưng sẽ khó phát hiện các trường hợp phức tạp như thêm sạc máy tính

Trong các trường hợp kém hơn như WAMMA\_1 và MLZL\_1, khi nhận dạng tín hiện phức tạp nhiễu nhiều thì sẽ đúng nhiều hơn, nhưng lại lỡ nhiều trương hợp đơn giản, làm giảm tỷ lệ nhận diện event đúng (TPP)

Tăng độ chính xác sẽ (TPP) nhìn chung tăng tỉ lệ nhận nhầm (FPP)

Thuật toán đề xuất có tỉ lệ nhận nhầm khá cao nhưng không bỏ lỡ event nào

Đề xuất giảm FPP: Nếu không nhận diện ra thiết bị hoặc thiết bị cũ thì có thể bỏ qua

\chapter{Tiền xử lý dữ liệu và trích xuất đặc trưng}

\section{Mục tiêu của giai đoạn tiền xử lý và trích xuất đặc trưng}
Mục tiêu chính của giai đoạn tiền xử lý và trích xuất đặc trưng là xác định và biểu diễn đặc trưng riêng của thiết bị vừa thay đổi trạng thái hoạt động. Cụ thể, quá trình này bao gồm:
\begin{itemize}
    \item Trích xuất đặc trưng công suất tiêu thụ của thiết bị tại thời điểm xảy ra thay đổi trạng thái (bật/tắt hoặc chuyển chế độ hoạt động).
    \item Trích xuất đặc trưng hình ảnh (I–V) của thiết bị, trong đó hình ảnh được biểu diễn dưới dạng đồ thị với: \begin{itemize}
        \item Trục hoành: hiệu điện thế U
        \item Trục tung: dòng điện I       
    \end{itemize}
\end{itemize}
Trong hệ thống điện dân dụng, hiệu điện thế U thường có dạng gần như cố định, trong khi dòng điện I thay đổi theo đặc tính tải của từng thiết bị. Do đó, mỗi thiết bị sẽ tạo ra đặc trưng I–V khác nhau, phản ánh hành vi tiêu thụ điện riêng biệt.

Các đặc trưng về công suất và hình ảnh I–V này sẽ được sử dụng làm cơ sở cho quá trình nhận dạng thiết bị, giúp phân biệt các thiết bị điện trong cùng hệ thống.

\section{Trích xuất đặc trưng công suất}
Khi thuật toán phát hiện sự kiện xác định có sự thay đổi trạng thái xảy ra, nó sẽ trả về thời điểm phát hiện sự kiện cùng với độ dài cửa sổ sự kiện. Dựa trên các thông tin này, ta xác định hai mốc thời gian quan trọng:
\begin{itemize}
    \item Thời điểm trước sự kiện: được lấy sớm hơn thời điểm phát hiện một vài giây.
    \item Thời điểm sau sự kiện: được lấy muộn hơn thời điểm kết thúc cửa sổ sự kiện một vài giây.
\end{itemize}
Việc dịch thời gian như vậy nhằm loại bỏ giai đoạn quá độ (transition period) – giai đoạn mà thiết bị vừa thay đổi trạng thái và công suất chưa ổn định. Điều này giúp đảm bảo dữ liệu đo được phản ánh trạng thái ổn định trước và sau khi thiết bị thay đổi.
Sau khi xác định hai khoảng thời gian trên, thuật toán sẽ:
\begin{itemize}
    \item Tính giá trị trung bình công suất tức thời trong mỗi khoảng (trước và sau sự kiện).
    \item Lấy hiệu tuyệt đối giữa hai giá trị trung bình này.
\end{itemize}
Giá trị thu được chính là đặc trưng công suất tiêu thụ của thiết bị vừa thay đổi trạng thái.

Trong quá trình trích xuất đặc trưng hình ảnh (I–V), các mốc thời gian “trước” và “sau” sự kiện cũng được xác định tương tự, nhằm đảm bảo tính nhất quán giữa hai loại đặc trưng.

\section{Trích xuất đặc trưng ảnh}

\subsection{Cơ sở lý thuyết}

Hệ thống NILM chỉ đo tại một điểm duy nhất, vì thế sẽ chỉ biết được U và I của cả mạng điện tại thời điểm nào đó

Khi một thiết bị mới được cắm vào, nó sẽ song song với mọi thiết bị khác

Vì hệ thống NILM đã biết được U, I của thời điểm trước và sau khi cắm thêm thiết bị mới, gọi Up,Ip là dòng và hiệu điện thế cả hệ thống sau khi cắm; Ut,It là trước đó, áp dụng định luật Kirchhoff có thể lấy được dòng và áp của thiết bị bằng công thức sau:

\begin{equation}
    Un+1 = Up = Ut
\end{equation}
\begin{equation}
    In+1 = Ip - It 
\end{equation}

\begin{figure}[H]{Mạng điện trước khi cắm thêm thiết bị n+1}
    \centering
    \includegraphics[height=0.4\linewidth]{IMAGE/Co_so_ly_thuyet_tien_xu_ly/mangdienn.jpg}
\end{figure}
\begin{figure}[H]{Mạng điện sau khi cắm thêm thiết bị n+1}
    \centering
    \includegraphics[height=0.4\linewidth]{IMAGE/Co_so_ly_thuyet_tien_xu_ly/mangdienn_1.jpg}
\end{figure}

\subsection{Vấn đề thực tế}
Trong hệ thống điện thực tế, dòng điện và điện áp được đo tại từng thời điểm tức thời (instantaneous). Do nguồn điện sử dụng là dòng xoay chiều (AC), giá trị của điện áp và dòng điện luôn biến thiên theo thời gian theo dạng hình sin.
Khi thu thập dữ liệu trong một khoảng thời gian đủ dài trước và sau thời điểm thiết bị thay đổi trạng thái (bật hoặc tắt), ta thu được hai dãy mẫu $U_t,I_t$ (trước) và $U_p,I_p$ (sau). Tuy nhiên, thời điểm bắt đầu lấy mẫu của hai dãy không đảm bảo trùng pha hoặc cách nhau đúng một số nguyên chu kỳ điện. Điều này có nghĩa là dạng sóng $U_t$ và $U_p$ có thể bị lệch pha so với nhau. Vì lý do đó, ta không thể trực tiếp lấy hiệu $I_p-It$ hay $U_p=Ut$ để trích xuất đặc trưng thay đổi của thiết bị — việc so sánh hai tín hiệu lệch pha sẽ gây sai lệch lớn và không phản ánh đúng sự khác biệt do thiết bị tạo ra.

Ngoài ra, trong điều kiện thực tế, nếu cảm biến hoạt động ở tần số lấy mẫu thấp hoặc không ổn định, các điểm lấy mẫu thậm chí còn có khoảng cách thời gian không đều nhau. Điều này làm cho việc so khớp pha và tái dựng dạng sóng càng trở nên khó khăn, đòi hỏi phải có bước xử lý bổ sung như nội suy, đồng bộ pha hoặc tái đồng bộ tín hiệu trước khi phân tích.

\begin{figure}[H]{Minh họa mảng $Up$ và $Ut$ khác nhau, nên đồ thì chúng cũng khác nhau
}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/Screenshot 2025-11-25 103337.png}
\end{figure}

\begin{figure}[H]{Hình ảnh minh họa các điểm U được lấy mẫu lấy mẫu không đều}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/Screenshot 2025-11-25 104309.png}
\end{figure}

Với vấn đề trên, chỉ cần đảm bảo U trước và sau giống nhau, hay cùng pha là có thể thực hiện trừ I và trích xuất đặc trưng

\section{Phương pháp tính}

\textbf{Bước 1: Nội suy tuyến tính}
Ở bước đầu tiên, tiến hành nội suy tuyến tính cho cả hai mảng $U$ và $I$ nhằm tăng số lượng điểm dữ liệu, lấp đầy các khoảng trống giữa các mẫu và giảm sai số do tần số lấy mẫu thấp hoặc không đều.

Việc nội suy giúp tái dựng dạng sóng mượt hơn, đồng thời đảm bảo độ chính xác khi thực hiện các bước xử lý tiếp theo.

\begin{figure}[H]{Ví dụ minh hoạ: nội suy tín hiệu $U$ với số lượng điểm tăng gấp 6 lần số điểm gốc}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/buoc1.png}
\end{figure}

\textbf{Bước 2: Dịch mảng và căn chỉnh pha}

Mục tiêu của bước này là tìm độ dịch tối ưu để hai mảng điện áp $U_p$ (sau khi thiết thay đổi trạng thái) và $U_t$ (trước khi thiết bị thay đổi trạng thái) trở nên trùng khớp với nhau nhất có thể.

Quy trình thực hiện như sau:
\begin{enumerate}
    \item Dịch mảng $U_t$ theo từng bước nhỏ (theo thời gian hoặc theo chỉ số mẫu).
    \item Tại mỗi vị trí dịch, tính sai số giữa hai mảng bằng công thức:    \begin{equation}
        E = \sum_{i=1}^{n} \left| U_p(i) - U_t(i) \right|
    \end{equation}
    Với n là độ dài mảng
    \item Sai số $E$ biểu thị mức độ khác biệt giữa hai dạng sóng tại vị trí dịch tương ứng.
    \item Lặp lại quá trình dịch và tính toán, ta tìm được vị trí dịch tạo ra sai số nhỏ nhất — đây chính là lúc hai dạng sóng đã gần trùng khớp nhất.
\end{enumerate}

Khi tìm được độ dịch tối ưu:

\begin{itemize}
    \item Hai tín hiệu $U_p$ và $U_t$ được căn chỉnh theo thời gian (đồng bộ pha).
    \item Vì dòng điện $I_t$ tương ứng vớ $U_t$, nên $I_t$ được dịch theo cùng độ dịch.
    \item Sau khi căn chỉnh xong, ta có thể lấy hiệu trực tiếp hai mảng dòng điện: 
    $
       I_{n+1} = I_p - I_t
    $
\end{itemize}
Nhờ đó, phần biến thiên của dòng điện thu được phản ánh đúng thay đổi do thiết bị tạo ra, thay vì sai lệch pha hoặc sai lệch thời gian giữa các mẫu đo.

\begin{figure}[H]{Minh họa Up, Ut trước và sau khi dịch theo Up}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/buoc2.png}
\end{figure}

\textbf{Bước 3: Chia đoạn và lấy trung bình theo chu kỳ}

Sau khi đã căn chỉnh pha, tiến hành chia tín hiệu $U$ và $I$ thành nhiều đoạn, mỗi đoạn tương ứng với một chu kỳ điện.

Tiếp theo, tính trung bình tất cả các đoạn theo từng vị trí mẫu để tạo ra dạng sóng đại diện cho thiết bị.

Quá trình này giúp loại bỏ nhiễu, giảm ảnh hưởng của biến thiên tức thời, và thu được đặc trưng dạng sóng ổn định.

\begin{figure}[H]{Hình minh họa mô tả quá trình chia đoạn và tính trung bình.}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/buoc3.png}
\end{figure}

Hoàn thành bước này nghĩa là ta đã trích xuất thành công “đặc trưng dạng sóng” của thiết bị.

\textbf{Bước 4: Lấy hiệu và vẽ đồ thị}

Ở bước cuối, ta thực hiện:
\begin{itemize}
    \item Vẽ đồ thị các tín hiệu U và I sau khi đã xử lý.
    \item Tính hiệu trực tiếp: $U_{n+1} = U_p = U_t$, $I_{n+1} = I_p - I_t$
    \item Biểu diễn kết quả bằng đồ thị để quan sát trực quan sự thay đổi tín hiệu tại thời điểm thiết bị hoạt động.
\end{itemize}

Các hình ảnh ở góc dưới bên trái minh họa tín hiệu U và I sau khi hoàn thành bước 3 (trích xuất đặc trưng dạng sóng), trong khi các hình còn lại thể hiện kết quả cuối sau bước 4.

\begin{figure}[H]{Hình ảnh đồ thị từ bước 3 và 4.}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/Trich xuat dac trung anh/buoc4.jpg}
\end{figure}

\section{Kết quả trích xuất đặc trưng ảnh}

Thực hiện đánh giá bằng cách so sánh đặc trưng ảnh giữa việc dùng thuật toán và không sử dụng thuật toán trong trường hợp chỉ có 1 thiết bị hoạt động duy nhất làm tham chiếu
Chạy thử thuật toán trên một số thiết bị cho kết quả như sau:

Đối với quạt không sử dụng thuật toán
\begin{figure}[H]{Đặc trưng ảnh của quạt không sử dụng thuật toán và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/dactrungquatkothuattoan.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của quạt có sử dụng thuật toán tạo ảnh và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/dactrungquatthuatoan.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của quạt khi dùng cả thuật toán trừ và thuật toán tạo ảnh}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/dactrungquatcatru.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của sạc máy tính không sử dụng thuật toán và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/image6.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của sạc máy tính có sử dụng thuật toán tạo ảnh và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/image7.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của sạc máy tính khi dùng cả thuật toán trừ và thuật toán tạo ảnh}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/image8.png}
\end{figure}

\textbf{Nhận xét}

Khi các thiết bị hoạt động độc lập, thuật toán tạo ảnh cho kết quả khá tương đồng với ảnh gốc (ảnh không qua xử lý). Tuy nhiên, một số chi tiết nhỏ hoặc góc cạnh bị mờ đi do quá trình tính trung bình trong thuật toán.

Khi kết hợp thêm thuật toán trừ để trích xuất đặc trưng, ảnh thu được có hình dạng và phân bố rất gần với ảnh của trường hợp thiết bị hoạt động đơn lẻ và có áp dụng thuật toán tạo ảnh.

Từ các ví dụ minh họa, có thể thấy rằng thuật toán trích xuất đặc trưng có khả năng tái tạo ảnh đủ rõ để mô hình học máy có thể nhận diện và phân loại thiết bị một cách hiệu quả.

\chapter{Mô hình học máy}

\section{Giới thiệu}

Trong hệ thống Giám sát Phụ tải Không Xâm lấn (Non-Intrusive Load Monitoring -- NILM), sau khi phát hiện được thời điểm xảy ra một sự kiện bật/tắt, nhiệm vụ quan trọng tiếp theo là xác định thiết bị nào đã tạo ra sự kiện đó. Đối với bài toán nhận dạng thiết bị trong đề tài, mô hình được sử dụng là mạng nơ-ron đa lớp (Multi-Layer Perceptron -- MLP) với tập đặc trưng đầu vào bao gồm ảnh đặc trưng I--V và giá trị công suất trung bình của thiết bị.

MLP là một mô hình học máy có cấu trúc đơn giản nhưng mang lại hiệu quả cao đối với các bài toán phân loại có đầu vào dạng vector cố định. Trong bối cảnh của đề tài, ảnh đặc trưng I--V được chuyển đổi thành dạng ma trận và làm phẳng (flatten) thành vector, sau đó kết hợp với giá trị công suất trung bình $P_{\mathrm{mean}}$. Việc biểu diễn như vậy cho phép mô hình học được sự khác biệt đặc trưng giữa các thiết bị điện dựa trên hành vi tiêu thụ của chúng.

Nhờ đặc điểm gọn nhẹ, tốc độ suy luận nhanh và khả năng triển khai trong thời gian thực, MLP trở thành lựa chọn phù hợp cho bài toán phân loại thiết bị trong hệ thống NILM của đề tài. Phần này sẽ trình bày chi tiết quy trình xây dựng đặc trưng đầu vào, kiến trúc mô hình, phương pháp huấn luyện và đánh giá, qua đó làm rõ vai trò của mô hình MLP trong toàn bộ hệ thống nhận dạng thiết bị.

\section{Đầu vào của mô hình}

Đầu vào của mô hình MLP trong đề tài bao gồm hai loại đặc trưng được xử lý thông qua hai nhánh mạng riêng biệt: (1) ảnh đặc trưng I--V và (2) giá trị công suất $P$ của thiết bị tại thời điểm xảy ra sự kiện bật/tắt. Cả hai đặc trưng này đều được trích xuất từ khối tiền xử lý và trích xuất đặc trưng.

Ảnh I--V được xây dựng dựa trên mối quan hệ giữa dòng điện và điện áp khi thiết bị thay đổi trạng thái. Sau giai đoạn tiền xử lý, dữ liệu được ánh xạ thành ảnh kích thước $32 \times 32$, biểu diễn dạng phân bố đặc trưng của thiết bị. Ảnh được chuẩn hoá và làm phẳng (flatten) thành một vector một chiều trước khi đưa vào nhánh xử lý ảnh của mô hình, tạo ra vector đặc trưng $f_{\mathrm{img}} \in \mathrm{R}^{64}$.

Giá trị công suất $P$ của thiết bị tại thời điểm xảy ra sự kiện được đưa vào nhánh mạng thứ hai. Sau hai lớp fully-connected, đặc trưng này được biểu diễn dưới dạng vector $f_{P} \in \mathrm{R}^{16}$.

Cuối cùng, hai vector đặc trưng được ghép lại bằng phép nối:
\[
x = [f_{\mathrm{img}},\; f_{P}] \in \mathrm{R}^{80},
\]
và được đưa vào bộ phân loại cuối cùng để xác định thiết bị tương ứng.


\section{Kiến trúc mô hình MLP}

Mô hình MLP được thiết kế nhằm phân loại thiết bị dựa trên hai loại đặc trưng: ảnh I--V và giá trị công suất $P$. Mô hình có cấu trúc gồm ba phần chính: nhánh xử lý ảnh, nhánh xử lý công suất, và bộ phân loại kết hợp.

\begin{figure}[H]{Kiến trúc mô hình MLP được sử dụng}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/kientrucmlp.jpg}
\end{figure}

\subsection{Nhánh xử lý ảnh I--V}

Nhánh này nhận đầu vào là ảnh I--V đã được làm phẳng (flatten) thành vector một chiều có kích thước $32 \times 32 = 1024$. Nhánh xử lý ảnh gồm bốn lớp fully-connected liên tiếp với hàm kích hoạt ReLU:

\begin{itemize}
    \item Lớp 1: 1024 $\rightarrow$ 512 neuron
    \item Lớp 2: 512 $\rightarrow$ 256 neuron
    \item Lớp 3: 256 $\rightarrow$ 128 neuron
    \item Lớp 4: 128 $\rightarrow$ 64 neuron
\end{itemize}

Sau nhánh này, ảnh I--V được biểu diễn dưới dạng vector đặc trưng $f_{\mathrm{img}} \in \mathbb{R}^{64}$.

\subsection{Nhánh xử lý giá trị công suất}

Nhánh này nhận đầu vào là giá trị công suất $P$ của thiết bị tại thời điểm sự kiện. Nhánh gồm hai lớp fully-connected với ReLU:

\begin{itemize}
    \item Lớp 1: 1 $\rightarrow$ 32 neuron
    \item Lớp 2: 32 $\rightarrow$ 16 neuron
\end{itemize}

Kết quả là vector đặc trưng $f_P \in \mathbb{R}^{16}$.

\subsection{Bộ phân loại kết hợp}

Hai vector đặc trưng $f_{\mathrm{img}}$ và $f_P$ được ghép nối thành vector $x \in \mathbb{R}^{80}$:
\[
x = [f_{\mathrm{img}},\; f_P]
\]

Vector $x$ được đưa vào bộ phân loại gồm hai lớp fully-connected với ReLU:

\begin{itemize}
    \item Lớp 1: 80 $\rightarrow$ 32 neuron
    \item Lớp 2: 32 $\rightarrow$ $C$ neuron (số lớp bằng số thiết bị cần phân loại)
\end{itemize}

Lớp đầu ra trả về vector logits, sau đó có thể áp dụng softmax để tính xác suất dự đoán thiết bị.

\subsection{Tóm tắt kiến trúc}

Như vậy, kiến trúc MLP gồm hai nhánh độc lập xử lý ảnh I--V và công suất $P$, sau đó hợp nhất vector đặc trưng và đưa vào bộ phân loại. Cấu trúc này giúp mô hình học được đặc trưng riêng của từng loại dữ liệu, đồng thời kết hợp thông tin để phân loại chính xác các thiết bị.

\subsection{Hàm mất mát và tối ưu}

Mô hình MLP được huấn luyện để phân loại thiết bị sử dụng Categorical Cross-Entropy làm hàm mất mát:
\[
\mathcal{L} = - \sum_{i=1}^{C} y_i \log(\hat{y}_i),
\]
trong đó $C$ là số lớp (số thiết bị), $y_i$ là nhãn thật và $\hat{y}_i$ là xác suất dự đoán từ mô hình.

Mô hình được tối ưu bằng thuật toán Adam với learning rate $1 \times 10^{-3}$, huấn luyện trong 15 epoch với batch size 32, lựa chọn này giúp mạng học hiệu quả đặc trưng từ cả ảnh I--V và giá trị công suất $P$ đồng thời hạn chế tình trạng overfit.

\section{Quy trình huấn luyện}

Quy trình huấn luyện mô hình MLP bao gồm các bước chính sau:

\begin{enumerate}
    \item \textbf{Chuẩn hóa dữ liệu:} Ảnh I--V được chuẩn hóa và làm phẳng thành vector một chiều, trong khi giá trị công suất $P$ cũng được chuẩn hóa, đảm bảo các đặc trưng đầu vào cùng thang đo phù hợp cho mạng MLP.
    
    \item \textbf{Chia tập dữ liệu:} Tập huấn luyện được tạo từ các thiết bị hoạt động độc lập (mỗi thiết bị bật một mình), giúp mạng học chính xác đặc trưng của từng thiết bị. Tập kiểm tra (test) được tạo từ các sự kiện thay đổi trạng thái thiết bị trong môi trường có 0 hoặc nhiều thiết bị khác đang bật, nhằm đánh giá khả năng phân loại trong tình huống thực tế. Dữ liệu cũng được chia thành tập train và validation để theo dõi quá trình huấn luyện và điều chỉnh tham số.
    
    \item \textbf{Huấn luyện theo batch:} Mạng được huấn luyện theo batch với batch size = 32, sử dụng hàm mất mát Categorical Cross-Entropy và optimizer Adam với learning rate $1 \times 10^{-3}$. Quá trình huấn luyện kéo dài 15 epoch, đảm bảo mạng học hiệu quả đặc trưng từ cả ảnh I--V và công suất $P$ đồng thời hạn chế overfit.
    
    \item \textbf{Lưu mô hình:} Sau mỗi epoch, trạng thái mô hình và optimizer được lưu lại (checkpoint) để có thể tiếp tục huấn luyện nếu cần. Sau khi huấn luyện kết thúc, mô hình cuối cùng và bộ mã hóa nhãn (label encoder) được lưu để sử dụng cho dự đoán thiết bị.
\end{enumerate}


\chapter{Kết quả và đánh giá hệ thống}

\section{Dữ liệu đánh giá}

Bộ dữ liệu sử dụng để đánh giá hệ thống gồm 116 tệp dữ liệu, tương ứng với 5 thiết bị điện khác nhau.

Mỗi tệp mô tả quá trình một thiết bị thay đổi trạng thái (bật/tắt) tại một thời điểm xác định, trong các điều kiện khác nhau (các thiết bị còn lại có thể đang bật hoặc tắt).
Toàn bộ dữ liệu được tự thu thập trong phòng thí nghiệm, đảm bảo tính kiểm soát và đồng nhất về môi trường đo

\section{Quy trình đánh giá}

Trong quá trình đánh giá, hệ thống nhận đầu vào là một tệp dữ liệu duy nhất, sau đó
Đọc tuần tự giá trị dòng điện (I) và điện áp (U) tức thời.

Phát hiện sự kiện thay đổi trạng thái thiết bị.

Tiền xử lý và trích xuất đặc trưng để đưa vào mô hình học máy phân loại thiết bị.

Vì mỗi tệp chỉ chứa một sự kiện thực, nên:
\begin{itemize}
    \item Nếu hệ thống phát hiện nhiều hơn một sự kiện, các sự kiện dư sẽ được coi là sự kiện giả (false positive).Nếu hệ thống phát hiện nhiều hơn một sự kiện, các sự kiện dư sẽ được coi là sự kiện giả (false positive).
    \item Nếu hệ thống không phát hiện sự kiện nào, tệp đó được coi là một sự kiện bị bỏ sót (false negative).
\end{itemize}
Khi đánh giá mô hình học máy (ML) trong bài toán nhận diện sự kiện, mô hình chỉ đánh giá trên các sự kiện mà thuật toán phát hiện được. Điều này dẫn đến hạn chế: mô hình không phản ánh đầy đủ hiệu suất của toàn bộ hệ thống phát hiện sự kiện.
Trong thực tế, hệ thống có thể tạo ra:
\begin{itemize}
    \item Sự kiện giả (false positive): hệ thống phát hiện sự kiện dù thực tế không có.
    \item Sự kiện bị bỏ lỡ (false negative): sự kiện thực tế xảy ra nhưng hệ thống không phát hiện.Sự kiện bị bỏ lỡ (false negative): sự kiện thực tế xảy ra nhưng hệ thống không phát hiện.
\end{itemize}
Ví dụ: có 100 sự kiện thực tế cần nhận diện, nhưng hệ thống chỉ phát hiện được 90 sự kiện → bỏ lỡ 10 sự kiện. Trong 90 sự kiện phát hiện được, có 8 sự kiện là giả → 8 sự kiện giả.
Mô hình học máy chỉ đánh giá trên 82 sự kiện mà nó nhận được từ hệ thống, nên không thể đánh giá toàn diện toàn hệ thống (vì thiếu cả sự kiện giả và sự kiện bị bỏ lỡ).
Để đánh giá tổng thể, ta quy ước:
\begin{itemize}
    \item Các sự kiện giả được gán nhãn thực tế là null.
    \item Các sự kiện thật nhưng bị bỏ lỡ được xem như mô hình gán nhãn null.
\end{itemize}

Nhờ quy ước này, ta có thể đánh giá toàn bộ hệ thống (gồm cả phát hiện + phân loại) theo cách tương tự như đánh giá một mô hình ML thông thường.

\section{Kết quả thực nghiệm}

Tổng số sự kiện cần nhận diện: 116 sự kiện

\subsection{Đánh giá hệ thống sử dụng thuật toán phát hiện sự kiện WAMMA}

\begin{itemize}
    \item Số sự kiện được phát hiện chính xác: 65/116 (56\%)
    \item Số sự kiện bỏ lỡ: 51/116 (44\%)
    \item Số lượng sự kiện giả phát sinh: 2
\end{itemize}

\textbf{Kết quả đánh giả chỉ mô hình học máy:}

\begin{itemize}
    \item F1 Score: 95\%
    \item Recall: 95\%
    \item Percision: 95\%
    \item Accuracy: 95.24\%
\end{itemize}

\begin{figure}[H]{Kết quả phân loại sử dụng thuật toán WAMMA chỉ xét đến mô hình}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image9.png}
\end{figure}

\textbf{Kết quả đánh giá toàn bộ hệ thống}
\begin{itemize}
    \item F1 Score: 62\%
    \item Recall: 51\%
    \item Percision: 88\%
    \item Accuracy: 50.85\%
\end{itemize}

\begin{figure}[H]{Kết quả toàn bộ hệ thống sử dụng thuật toán sự kiện WAMMA}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image10.png}
\end{figure}

\subsection{Đánh giá hệ thống sử dụng thuật toán phát hiện sự kiện Hybrid của Mengqi Lu và Zuyi Li}
\begin{itemize}
    \item Số sự kiện được phát hiện chính xác: 81/116 (69.83\%)
    \item Số sự kiện bỏ lỡ: 36/116 (30.17\%)
    \item Số lượng sự kiện giả phát sinh: 9
\end{itemize}
\textbf{Kết quả đánh giả chỉ mô hình học máy:}
\begin{itemize}
    \item F1 Score: 99\%
    \item Recall: 99\%
    \item Percision: 99\%
    \item Accuracy: 98.75\%
\end{itemize}

\begin{figure}[H]{Kết quả phân loại sử dụng thuật toán Hybrid của Mengqi Lu và Zuyi Li chỉ xét đến mô hình}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image11.png}
\end{figure}

\textbf{Kết quả đánh giá toàn bộ hệ thống}
\begin{itemize}
    \item F1 Score: 73\%
    \item Recall: 68\%
    \item Percision: 97\%
    \item Accuracy: 67.52\%
\end{itemize}
\begin{figure}[H]{Kết quả toàn bộ hệ thống sử dụng thuật toán sự kiện Hybrid của Mengqi Lu và Zuyi Li}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image12.png}
\end{figure}

\subsection{Đánh giá hệ thống sử dụng thuật toán phát hiện sự kiện đề xuất}
\begin{itemize}
    \item Số sự kiện được phát hiện chính xác: 116/116 (100\%)
    \item Số sự kiện bỏ lỡ: 0/116 (0\%)
    \item Số lượng sự kiện giả phát sinh: 9
\end{itemize}
\textbf{Kết quả đánh giả chỉ mô hình học máy:}
\begin{itemize}
    \item F1 Score: 95\%
    \item Recall: 95\%
    \item Percision: 95\%
    \item Accuracy: 95.69\%
\end{itemize}

\begin{figure}[H]{Kết quả phân loại sử dụng thuật toán đề xuất chỉ xét đến mô hình}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image13.png}
\end{figure}

\textbf{Kết quả đánh giá toàn bộ hệ thống}
\begin{itemize}
    \item F1 Score: 84\%
    \item Recall: 89\%
    \item Percision: 86\%
    \item Accuracy: 88.8\%
\end{itemize}
\begin{figure}[H]{Kết quả toàn bộ hệ thống sử dụng thuật toán sự kiện đề xuất}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image14.png}
\end{figure}

\section{Nhận xét kết quả}
Kết quả thực nghiệm cho thấy hiệu suất của hệ thống phụ thuộc chủ yếu vào thuật toán phát hiện sự kiện, trong khi mô hình học máy dùng để phân loại thiết bị hoạt động ổn định và nhất quán ở cả ba trường hợp (WAMMA, Hybrid và thuật toán đề xuất). Vì vậy, phần trọng tâm đánh giá ở đây là so sánh các thuật toán phát hiện sự kiện.

Hiệu suất của các thuật toán phát hiện sự kiện:

\textbf{Thuật toán WAMMA}

Thuật toán WAMMA chỉ phát hiện được 65/116 sự kiện (56\%), dẫn đến việc bỏ sót 51 sự kiện – một con số lớn, làm giảm đáng kể hiệu suất toàn hệ thống, mặc dù mô hình phân loại vẫn đạt khoảng 95\% F1-Score trên các sự kiện được phát hiện. Số lượng sự kiện bỏ sót cao khiến Recall end-to-end giảm mạnh và hệ thống mất khả năng theo dõi tình trạng thiết bị theo thời gian thực.

\textbf{Thuật toán Hybrid của Mengqi Lu \& Zuyi Li}

Thuật toán Hybrid cải thiện đáng kể so với WAMMA, phát hiện được 81/116 sự kiện (69.83\%). Tuy nhiên, nó vẫn bỏ sót hơn 30\% tổng số sự kiện, gây ảnh hưởng lớn đến kết quả toàn hệ thống. Dù mô hình phân loại đạt F1-Score tới 99\%, việc thiếu dữ liệu đầu vào và sinh ra 9 sự kiện giả khiến hiệu suất end-to-end chỉ đạt 67.52\%. Điều này cho thấy thuật toán Hybrid vẫn chưa đạt độ tin cậy cần thiết khi triển khai thực tế.

\textbf{Thuật toán phát hiện sự kiện đề xuất}

Thuật toán đề xuất phát hiện đầy đủ 116/116 sự kiện (100\%), không bỏ sót sự kiện nào. Đây là cải thiện lớn nhất so với hai thuật toán còn lại, và đặc biệt quan trọng trong các ứng dụng NILM yêu cầu theo dõi trạng thái thiết bị theo thời gian thực, nơi việc bỏ sót một sự kiện có thể làm đứt gãy toàn bộ quá trình nhận dạng.
Tuy nhiên, thuật toán đề xuất tạo ra 9 sự kiện giả, khiến precision của việc phát hiện sự kiện chưa tối ưu. Nguyên nhân chủ yếu đến từ:
\begin{itemize}
    \item Nhiễu tín hiệu tại các thời điểm thiết bị CVD thay đổi công suất,
    \item Thiết bị CVD giảm công suất kiến nhận sai
    \item Ngưỡng phát hiện (threshold) chưa tối ưu cho từng loại thiết bị có profile đặc thù.
\end{itemize}

Dù vậy, nhờ không bỏ sót bất kỳ sự kiện nào, kết quả end-to-end của hệ thống sử dụng thuật toán đề xuất vẫn đạt hiệu suất cao nhất trong ba phương pháp:

Accuracy 88.8\%, F1 = 84\%, Recall = 89\%.


% ============================
% TÀI LIỆU THAM KHẢO
% ============================
\begin{thebibliography}{15}

\begin{bibsection}{Tiếng Việt}


\end{bibsection}

\begin{bibsection}{Tiếng Anh}

\bibitem{LuLi2019Hybrid}
M. Lu and Z. Li,
``A Hybrid Event Detection Approach for Non-Intrusive Load Monitoring,''
\textit{IEEE Transactions on Smart Grid},
vol. 11, no. 1, pp. 528--540, Jan. 2020,
doi: 10.1109/TSG.2019.2924862.

\bibitem{WAMMA}
L. Yan, W. Tian, X. Hao, Z. Li, and H. Wang,
``Robust Event Detection for Residential Load Disaggregation,''
\textit{IEEE Transactions on Smart Grid},
vol. 9, no. 5, pp. 5516--5524, Sept. 2018.

\bibitem{Liu2020NILM}
H. Liu,
\textit{Non-Intrusive Load Monitoring: Theory, Technologies and Applications}.
Singapore: Springer Nature, 2020,
doi: 10.1007/978-981-15-1860-7.

\bibitem{zheng2018supervised}
Z. Zheng, H. Chen, and X. Luo, ``A Supervised Event-Based Non-Intrusive Load Monitoring for Non-Linear Appliances,'' \textit{Sustainability}, vol. 10, no. 4, p. 950, Mar. 2018.

\bibitem{Lu2024Siamese}
L. Lu, J.-S. Kang, F. Meng, and M. Yu,
``Non-Intrusive Load Identification Based on Retrainable Siamese Network,''
\textit{Sensors}, vol. 24, no. 8, p. 2562, Apr. 2024,
doi: 10.3390/s24082562.


\end{bibsection}

\end{thebibliography}


\end{document}