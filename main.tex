\documentclass{uetgraduation}

\usepackage[hidelinks]{hyperref}
\setlength{\parindent}{2em}
\usepackage{array}      % mở rộng tùy chọn cột
\usepackage{tabularx}   % cột tự co giãn X
\usepackage{adjustbox}  % thu-phóng bảng theo bề rộng
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsfonts}   % hoặc
\usepackage{amssymb}

% Nếu cần định nghĩa thêm các kiểu đính kèm (ví dụ cho code, sơ đồ), bạn có thể đặt ở đây
% \makeattachmenttype{...}{...}{...}{...}{...}{...}{...}{...}

\begin{document}

% ===========================
% THÔNG TIN TRANG BÌA
% ===========================
\studentname{Trần Hồng Quân}
\title{NHẬN DIỆN THIẾT BỊ TRÊN MẠNG ĐIỆN PHỨC TẠP SỬ DỤNG THUẬT TOÁN PHÁT HIỆN SỰ KIỆN ĐƯỢC TỐI ƯU
}
\documenttype{Đồ án tốt nghiệp chương trình đào tạo chuẩn}
\major{Kỹ thuật máy tính}
\year{2025}
\supervisor{TS. Nguyễn Ngọc An}
\title{NHẬN DIỆN THIẾT BỊ TRÊN MẠNG ĐIỆN PHỨC TẠP SỬ DỤNG THUẬT TOÁN PHÁT HIỆN SỰ KIỆN ĐƯỢC TỐI ƯU
}
\major{Kỹ thuật máy tính}
\supervisor{TS. Nguyễn Ngọc An}
\makecovers

% ===========================
% TÓM TẮT, CAM ĐOAN, CẢM ƠN
% ===========================
\begin{preamble}{Tóm tắt}
\textbf{Tóm tắt:} 
Trong bối cảnh nhu cầu quản lý năng lượng thông minh ngày càng gia tăng, việc giám sát và nhận dạng mức tiêu thụ điện của từng thiết bị trở thành yếu tố quan trọng để tối ưu hóa sử dụng điện và giảm lãng phí năng lượng. Mặc dù NILM (Non-Intrusive Load Monitoring) đã được nghiên cứu trong nhiều năm, các hệ thống hiện tại vẫn gặp phải nhiều hạn chế thực tế. Phần lớn các mô hình nghiên cứu giả định rằng tại một thời điểm chỉ có một thiết bị thay đổi trạng thái, điều này giúp việc huấn luyện và phân loại tín hiệu trở nên đơn giản, nhưng không phản ánh đúng môi trường thực tế, nơi nhiều thiết bị có thể bật/tắt gần như đồng thời, gây chồng lấn tín hiệu, bỏ sót sự kiện hoặc nhận dạng sai thiết bị. Bên cạnh đó, các thuật toán phát hiện sự kiện thường nhạy cảm với nhiễu hoặc biến đổi nhỏ trong tín hiệu, dẫn đến hệ thống thiếu ổn định khi triển khai thực tế.  

Trước những hạn chế này, đề tài tập trung xây dựng và kiểm chứng một hệ thống NILM hướng sự kiện có khả năng hoạt động ổn định trong môi trường phức tạp, phát hiện chính xác các sự kiện bật/tắt của nhiều thiết bị hoạt động đồng thời và duy trì độ chính xác nhận dạng thiết bị. Dữ liệu điện áp và dòng điện được thu thập từ nhiều thiết bị trong các sự kiện bật/tắt thực tế và xử lý ngoại tuyến trong môi trường Python. Hệ thống thực hiện các bước chính: phát hiện sự kiện bật/tắt, tiền xử lý và trích xuất đặc trưng (bao gồm công suất tức thời và đặc trưng ảnh dạng sóng I–V), và nhận dạng thiết bị bằng mô hình học máy MLP kết hợp giữa các đặc trưng công suất và hình ảnh tín hiệu.  

Đề tài cũng xây dựng một bộ dữ liệu thực nghiệm mới, ghi nhận các sự kiện bật/tắt của nhiều thiết bị trong điều kiện thực tế tại Việt Nam, làm cơ sở kiểm thử trực tiếp cho hệ thống NILM hướng sự kiện, tương tự PLAID dataset nhưng phản ánh điều kiện địa phương một cách chân thực hơn. Các thuật toán phát hiện sự kiện như lọc trung bình, WAMMA, bộ lọc Kalman và thuật toán Hybrid của Mengqi Lu – Zuyi Li được triển khai và đánh giá nhằm giảm bỏ sót sự kiện và nâng cao độ chính xác nhận dạng.  

Kết quả thực nghiệm cho thấy hệ thống đề xuất có khả năng phát hiện sự kiện bật/tắt và nhận dạng thiết bị với độ tin cậy cao trong môi trường nhiều tải hoạt động đồng thời. Đề tài đóng góp hai kết quả chính: (1) xây dựng thành công hệ thống NILM hướng sự kiện, (2) phát triển bộ dữ liệu thực nghiệm phục vụ kiểm thử và nghiên cứu NILM, đồng thời tạo nền tảng cho các ứng dụng thực tế trong nhà thông minh, quản lý năng lượng và giám sát tiêu thụ điện trong công nghiệp.


\end{preamble}

\begin{preamble}{Lời cam đoan}
Tôi xin cam kết rằng đồ án tốt nghiệp với đề tài “NHẬN DIỆN THIẾT BỊ TRÊN MẠNG ĐIỆN PHỨC TẠP SỬ DỤNG THUẬT TOÁN PHÁT HIỆN SỰ KIỆN ĐƯỢC TỐI ƯU” là kết quả nghiên cứu do chính tôi thực hiện. Toàn bộ nội dung và kết
quả trình bày trong đồ án là trung thực, phản ánh đúng quá trình thực nghiệm và phân tích của
bản thân tôi, không sao chép hoặc sử dụng từ bất kỳ công trình nào đã được công bố hoặc bảo
vệ tại các cơ sở giáo dục khác.
Tôi hoàn toàn chịu trách nhiệm về tính trung thực và nguyên bản của đồ án này trước Hội đồng
chấm đồ án và các quy định liên quan của nhà trường.

\vspace{1.5cm}
\begin{flushright}
    Hà Nội, ngày \hspace{0.5cm} tháng \hspace{0.5cm} năm 2025\\
\end{flushright}
\begin{tabular}{p{0.5\linewidth} p{0.5\linewidth}}
    \hspace{1cm}\textbf{} & \hspace{2cm}\textbf{Sinh viên thực hiện} \\
    \\[2cm] % khoảng trống để ký
    \hspace{1cm}\textbf{} & \hspace{2.1cm}\textbf{Trần Hồng Quân} \\
\end{tabular}

\end{preamble}

\begin{preamble}{Lời cảm ơn}
Để hoàn thành được đồ án này, trước hết tôi xin bày tỏ lòng biết ơn đến thầy TS. Nguyễn Ngọc
An, người đã tận tình hướng dẫn, đồng hành và dành nhiều thời gian quý báu để định hướng, hỗ
trợ tôi trong suốt quá trình thực hiện đồ án.
Tôi cũng xin gửi lời cảm ơn chân thành đến Ban Giám hiệu Nhà trường cùng các thầy, cô giáo
ngành Kỹ thuật máy tính đã không ngừng tạo điều kiện học tập thuận lợi và truyền đạt những
kiến thức nền tảng quý giá trong suốt quá trình học tập tại trường.
Dù đã cố gắng hoàn thiện đồ án với tinh thần nghiêm túc và nỗ lực cao nhất, nhưng chắc chắn
không tránh khỏi những thiếu sót. Tôi mong nhận được những góp ý chân thành từ các thầy cô
để đồ án được hoàn thiện hơn.
Cuối cùng, tôi xin gửi lời cảm ơn đến nhóm nghiên cứu myLab của thầy Nguyễn Ngọc An đã
tiếp thêm động lực để tôi có thể kiên trì theo đuổi và hoàn thành đồ án này.
\end{preamble}

% ===========================
% MỤC LỤC, DANH SÁCH HÌNH, BẢNG
% ===========================
\begin{contentlisting}
\tableofcontents
\listoffigures
\listoftables
\end{contentlisting}

% ===========================
% CÁC CHƯƠNG NỘI DUNG
% ===========================
\chapter{Giới thiệu}

\section{Giới thiệu Hệ thống NILM}

Hệ thống NILM (Non-Intrusive Load Monitoring), hay còn gọi là giám sát tải điện không xâm lấn, là một phương pháp tiên tiến trong lĩnh vực quản lý năng lượng, giúp xác định mức tiêu thụ và nhận dạng từng thiết bị điện riêng lẻ trong một hệ thống điện chỉ dựa trên dữ liệu tổng hợp về dòng điện và điện áp tại một điểm duy nhất, thường là tại công tơ điện tổng của hộ gia đình hoặc tòa nhà.  

Khác với phương pháp ILM (Intrusive Load Monitoring), trong đó mỗi thiết bị cần được gắn cảm biến riêng biệt để đo công suất tiêu thụ, NILM chỉ yêu cầu một bộ cảm biến duy nhất tại đầu nguồn. Nhờ đó, hệ thống NILM mang lại nhiều lợi ích nổi bật: giảm chi phí triển khai, hạn chế sự xâm lấn vào thiết bị hiện hữu, dễ dàng mở rộng và áp dụng cho các môi trường khác nhau từ hộ gia đình, văn phòng đến các khu công nghiệp lớn.  

Nguyên lý hoạt động của NILM thường được chia thành ba bước chính: đầu tiên là thu thập tín hiệu tổng hợp, dữ liệu dòng điện và điện áp được ghi lại tại đầu nguồn với tần số mẫu cao để đảm bảo ghi nhận được các biến đổi nhanh của tải. Tiếp theo là phát hiện sự kiện bật/tắt thiết bị, các thay đổi đột ngột hoặc mẫu dao động đặc trưng trong tín hiệu tổng được phân tích để xác định thời điểm một thiết bị được bật hoặc tắt. Cuối cùng là nhận dạng thiết bị, thông qua việc trích xuất các đặc trưng tín hiệu như mức công suất, dạng sóng dòng, pha, hoặc các đặc trưng Fourier, sau đó so sánh với cơ sở dữ liệu mẫu đã biết hoặc áp dụng các mô hình học máy để xác định loại thiết bị đang hoạt động.  

Hệ thống NILM có nhiều ứng dụng thực tiễn. Trong nhà thông minh, nó giúp giám sát mức tiêu thụ của từng thiết bị và cảnh báo khi có tiêu thụ điện bất thường. Trong quản lý năng lượng, NILM giúp người dùng tối ưu hóa việc sử dụng điện, từ đó giảm chi phí hóa đơn và lượng phát thải carbon. Trong giám sát công nghiệp, nó cho phép theo dõi hiệu suất và trạng thái thiết bị trong dây chuyền sản xuất mà không cần gắn cảm biến rời cho từng máy. Ngoài ra, NILM còn hỗ trợ nghiên cứu và phân tích dữ liệu tiêu thụ, giúp lập kế hoạch quản lý tải điện hiệu quả.  

Tuy nhiên, hệ thống này vẫn tồn tại một số hạn chế kỹ thuật. Việc phân biệt các thiết bị có đặc trưng tín hiệu tương tự nhau vẫn còn khó khăn, ví dụ như nhiều loại bóng đèn hoặc thiết bị điện tử có mô hình bật/tắt gần giống nhau. Khi nhiều thiết bị bật/tắt cùng lúc, độ chính xác giảm do tín hiệu nhiễu và chồng lấn. NILM cũng phụ thuộc vào dữ liệu huấn luyện; nếu mô hình chưa được huấn luyện với các thiết bị cụ thể trong thực tế, độ chính xác nhận dạng sẽ giảm. Bên cạnh đó, NILM vẫn chưa thể hoàn toàn thay thế các cảm biến vật lý, đặc biệt đối với những thiết bị có đặc tính điện phức tạp hoặc hệ thống yêu cầu giám sát thời gian thực cực cao.  

Do đó, các hướng nghiên cứu hiện nay tập trung vào nâng cao khả năng phát hiện sự kiện và giảm bỏ sót các thay đổi nhỏ trong tín hiệu, tăng độ chính xác nhận dạng bằng cách áp dụng các mô hình học máy tiên tiến, kết hợp dữ liệu thời gian thực và dữ liệu lịch sử. Ngoài ra, việc thử nghiệm trên các nền tảng mô phỏng như Python hoặc MATLAB trước khi triển khai thực tế cũng là bước quan trọng giúp đánh giá hiệu năng và tối ưu thuật toán.  

Hệ thống NILM hiện đang được xem là một giải pháp hứa hẹn trong quản lý năng lượng thông minh, đồng thời mở ra nhiều hướng nghiên cứu về xử lý tín hiệu, học máy và IoT trong môi trường năng lượng.


\section{Phân loại hệ thống NILM}

Hiện nay, các hệ thống NILM (Non-Intrusive Load Monitoring) được phát triển theo hai hướng tiếp cận chính là hướng liên tục (Continuous-based NILM) và hướng theo sự kiện (Event-based NILM). Mỗi hướng tiếp cận có triết lý xử lý tín hiệu và ưu, nhược điểm riêng, tùy thuộc vào mục tiêu và điều kiện triển khai của hệ thống

Mỗi hướng có triết lý khác nhau về cách xử lý tín hiệu:

\begin{itemize}
    \item Continuous: “Theo dõi suốt quá trình tiêu thụ”
    \item Event: “Chỉ chú ý khi có thay đổi rõ ràng”
\end{itemize}

\subsection{Hướng tiếp cận liên tục (Continuous-based)}

\textbf{Nguyên lý hoạt động:}

Hệ thống theo hướng này sẽ phân tích toàn bộ chuỗi tín hiệu tổng (dòng điện, điện áp, công suất tức thời, v.v.) trong suốt thời gian hoạt động. Dữ liệu được thu thập liên tục và đưa vào mô hình xử lý để dự đoán trạng thái bật/tắt của từng thiết bị tại mỗi thời điểm. Quá trình này đòi hỏi mô hình có khả năng học và theo dõi sự biến đổi liên tục của tín hiệu trong thời gian thực.

\textbf{Đặc điểm nổi bật:}

\begin{itemize}
    \item Cho phép dự đoán chi tiết và liên tục trạng thái của từng thiết bị.
    \item Có thể học được hành vi tiêu thụ dài hạn hoặc các dạng sóng phức tạp của thiết bị.
\end{itemize}

\textbf{Nhược điểm:}

\begin{itemize}
    \item Cần dữ liệu huấn luyện có gán nhãn chi tiết theo thời gian, điều này khiến việc thu thập dữ liệu trở nên khó khăn và tốn công.
    \item Khối lượng tính toán lớn, khó triển khai trên thiết bị nhúng hoặc trong hệ thống cần giám sát nhiều thiết bị cùng lúc.
    \item Mô hình cần học tất cả các tổ hợp bật/tắt khả dĩ giữa các thiết bị, khiến chi phí huấn luyện tăng theo cấp số nhân khi số thiết bị tăng.
\end{itemize}

\textbf{Ví dụ:}
Nếu hệ thống có 3 thiết bị gồm đèn (500W), máy lạnh (1000W) và bơm nước (1500W), 
tổng số tổ hợp trạng thái bật/tắt có thể xảy ra là \( 2^3 = 8 \).
Khi thêm thiết bị thứ tư, số tổ hợp tăng lên \( 2^4 = 16 \).
Điều này cho thấy việc mở rộng hệ thống sẽ khiến mô hình huấn luyện ngày càng 
phức tạp và khó khả thi trong thực tế.

\subsection{Hướng tiếp cận theo sự kiện (Event-based)}

\textbf{Nguyên lý hoạt động:}

\begin{itemize}
    \item Phát hiện sự kiện:
\end{itemize}

Xác định các thời điểm xảy ra sự thay đổi trạng thái của thiết bị dựa trên biến động công suất tức thời (thường sử dụng ngưỡng ∆P). Các điểm có mức thay đổi lớn được xem là ứng viên sự kiện bật hoặc tắt.

\begin{itemize}
    \item Trích xuất đặc trưng quanh sự kiện:
\end{itemize}

Từ mỗi sự kiện được phát hiện, tiến hành lấy một đoạn tín hiệu ngắn trước và sau thời điểm xảy ra sự kiện để xây dựng đặc trưng. Các đặc trưng có thể bao gồm: độ biến thiên công suất, gradient, dạng sóng tín hiệu (waveform), hoặc các biến đổi liên quan.

\begin{itemize}
    \item Phân loại sự kiện:
\end{itemize}
Mô hình máy học sẽ nhận các đặc trưng này và dự đoán thiết bị tương ứng gây ra sự kiện bật/tắt.

\textbf{Ưu điểm của phương pháp}

\begin{itemize}
    \item Không yêu cầu gán nhãn toàn bộ chuỗi tín hiệu, chỉ cần gán nhãn tại thời điểm bật/tắt, giúp giảm đáng kể chi phí thu thập và xử lý dữ liệu.
    \item Tập trung vào thông tin quan trọng nhất, cụ thể là thời điểm có thay đổi trạng thái, từ đó nâng cao hiệu quả của mô hình phân loại.
\end{itemize}

\subsection{So sánh hai hướng tiếp cận trong NILM}

\begin{table}[h]{So sánh giữa Continuous-based NILM và Event-based NILM}
    \centering
    \begin{tabularx}{\linewidth}{|X|X|X|}
        \hline
        \textbf{Tiêu chí} & \textbf{Continuous-based NILM} & \textbf{Event-based NILM} \\ \hline

        Cách tiếp cận 
        & Phân tích toàn bộ chuỗi tín hiệu theo thời gian 
        & Chỉ phân tích các sự kiện bật/tắt thiết bị \\ \hline

        Tín hiệu đầu vào 
        & Chuỗi tín hiệu liên tục: $P(t)$, $I(t)$, ... 
        & Đoạn tín hiệu ngắn quanh thời điểm sự kiện \\ \hline

        Yêu cầu dữ liệu gán nhãn 
        & Cần gán nhãn từng thời điểm 
        & Chỉ cần gán nhãn tại thời điểm bật/tắt \\ \hline

        Khả năng mở rộng 
        & Khó mở rộng nếu số lượng thiết bị lớn 
        & Dễ mở rộng vì chỉ xử lý các điểm quan trọng \\ \hline

        Phù hợp cho hệ thống thực tế 
        & Hạ tầng có số lượng thiết bị giới hạn 
        & Hạ tầng có nhiều thiết bị, ưu tiên thời điểm bật/tắt \\ \hline

        Hạn chế chính 
        & Khó huấn luyện và khó mở rộng mô hình 
        & Có thể bỏ sót sự kiện hoặc gặp sự kiện trùng lặp gây nhầm lẫn \\ \hline
    \end{tabularx}
\end{table}

\textbf{Hướng Continuous-based (phân tích liên tục)}

Ở hướng tiếp cận này, mô hình phải học và nhận diện toàn bộ các tổ hợp trạng thái có thể xảy ra của tất cả thiết bị trong hệ thống.

Ví dụ minh họa, giả sử có 3 thiết bị:

\begin{itemize}
    \item Đèn (500W)
    \item Máy lạnh (1000W)
    \item Bơm nước (1500W)
\end{itemize}

Khi đó sẽ có tổng cộng $2^3=8$ tổ hợp bật/tắt (chỉ đèn bật, đèn + máy lạnh bật, chỉ bơm bật, ...). Nếu thêm một thiết bị thứ tư, số tổ hợp tăng lên thành $2^4=16$

Điều này dẫn đến hệ quả:

\begin{itemize}
    \item Khi thêm thiết bị mới, mô hình cần được huấn luyện lại để học toàn bộ tổ hợp mới.
    \item Khi xuất hiện thiết bị lạ (chưa từng thấy trong quá trình huấn luyện), mô hình dễ bị sai lệch.
    \item Việc huấn luyện trở nên phức tạp khi số lượng thiết bị lớn, gây khó khăn khi triển khai trong các thiết bị nhúng hoặc hệ thống có tài nguyên hạn chế.
\end{itemize}

\textbf{Hướng Event-based (phân tích theo sự kiện)}

Trong hướng tiếp cận này, hệ thống chỉ phân tích tín hiệu trong khoảng thời gian xảy ra sự kiện bật hoặc tắt.

Các đặc điểm chính:

\begin{itemize}
    \item Mỗi thiết bị chỉ cần một mô hình phân loại tại thời điểm nó thay đổi trạng thái.
    \item  Không cần xét các tổ hợp thiết bị bật cùng lúc.
\end{itemize}

Ví dụ:

Khi đèn bật, hệ thống chỉ cần phân tích tín hiệu tại thời điểm xuất hiện sự kiện để xác định xem đó có phải là “đèn” hay không, mà không cần tính đến trạng thái của máy lạnh hay bơm nước.

Ưu điểm đáng chú ý:

\begin{itemize}
    \item Khi thêm thiết bị mới, chỉ cần huấn luyện mô hình cho thiết bị đó mà không ảnh hưởng đến các mô hình cũ.
    \item Nếu có thiết bị lạ xuất hiện, hệ thống có thể coi là sự kiện không hợp lệ hoặc sự kiện nhiễu mà không gây ảnh hưởng lớn.
\end{itemize}

\textbf{Lưu ý khi lựa chọn hướng tiếp cận}

Mặc dù phương pháp dựa trên sự kiện có ưu điểm về tính nhẹ và khả năng mở rộng, nó vẫn tồn tại rủi ro nếu bỏ sót sự kiện hoặc phân loại nhầm, dẫn đến tích lũy sai số theo thời gian.

Do đó, lựa chọn phương pháp phù hợp phụ thuộc vào mục tiêu ứng dụng:

\begin{itemize}
    \item Nếu hệ thống chỉ cần theo dõi một số thiết bị cố định, ít thay đổi: Phương pháp phân tích liên tục có thể phù hợp hơn vì theo dõi chi tiết và liên tục toàn bộ tín hiệu.
    \item Nếu hệ thống phải giám sát nhiều thiết bị, hoặc số lượng thiết bị có thể thay đổi linh hoạt: Phương pháp dựa trên sự kiện là lựa chọn tốt nhờ khả năng mở rộng, đơn giản hóa việc huấn luyện.
\end{itemize}


\section{Đặt vấn đề}

Trong những năm gần đây, cùng với xu hướng phát triển của lưới điện thông minh (Smart Grid) và nhu cầu nâng cao hiệu quả sử dụng năng lượng, bài toán phân tích tiêu thụ điện năng trong các hộ gia đình và tòa nhà dân dụng ngày càng nhận được nhiều sự quan tâm. Hệ thống Nhận dạng phụ tải không xâm nhập (Non-Intrusive Load Monitoring – NILM) được xem là một trong những giải pháp tiềm năng, cho phép xác định trạng thái hoạt động và mức tiêu thụ điện năng của từng thiết bị điện chỉ dựa trên tín hiệu đo tại một điểm duy nhất ở đầu nguồn, mà không cần lắp đặt thêm các công tơ riêng lẻ cho mỗi thiết bị.

Mặc dù đã được nghiên cứu trong nhiều năm và đạt được nhiều kết quả đáng kể trong các môi trường thử nghiệm, việc triển khai hệ thống NILM trong thực tế vẫn còn gặp phải nhiều thách thức lớn. Phần lớn các công trình trước đây thường đưa ra giả định rằng tại một thời điểm chỉ có một thiết bị thay đổi trạng thái (bật hoặc tắt). Giả định này giúp đơn giản hóa việc phát hiện và phân loại sự kiện, tuy nhiên lại không phản ánh đúng tình huống vận hành thực tế trong các hộ gia đình hiện đại, nơi nhiều thiết bị có thể hoạt động đồng thời hoặc chuyển trạng thái trong khoảng thời gian rất gần nhau. Sự chồng lấn giữa các sự kiện làm cho tín hiệu công suất tổng trở nên phức tạp và khó phân tách, từ đó làm tăng xác suất nhầm lẫn giữa các thiết bị có đặc tính tiêu thụ tương tự nhau.

Bên cạnh đó, nhiều thiết bị điện hiện đại như máy điều hòa không khí sử dụng công nghệ inverter, tủ lạnh, máy giặt, hoặc các thiết bị điện tử không có mức công suất tiêu thụ cố định mà liên tục dao động theo chế độ vận hành và điều kiện môi trường. Điều này khiến cho các phương pháp NILM truyền thống dựa trên ngưỡng công suất trở nên kém hiệu quả. Ngoài ra, các yếu tố như nhiễu đo lường, dao động điện áp của lưới điện, sai số của cảm biến và sự thay đổi hành vi sử dụng điện của người dùng theo thời gian cũng góp phần làm cho dữ liệu đo trở nên không ổn định và khó xử lý hơn rất nhiều so với dữ liệu trong môi trường lý tưởng của phòng thí nghiệm.

Một hạn chế quan trọng khác của các nghiên cứu hiện tại là sự phụ thuộc lớn vào các bộ dữ liệu tiêu chuẩn được công bố rộng rãi như REDD, UK-DALE, PLAID hay REFIT. Mặc dù đây là những bộ dữ liệu có giá trị tham khảo cao, chúng chủ yếu được thu thập tại các quốc gia phát triển với điều kiện lưới điện ổn định, cấu trúc phụ tải và thói quen sử dụng điện khác biệt so với điều kiện tại Việt Nam. Trong khi đó, đặc điểm tiêu thụ điện của các hộ gia đình Việt Nam chịu ảnh hưởng bởi nhiều yếu tố đặc thù như chất lượng điện áp không đồng đều, thói quen sinh hoạt, điều kiện khí hậu nhiệt đới và sự đa dạng của các thiết bị điện giá rẻ trên thị trường. Việc áp dụng trực tiếp các mô hình được huấn luyện từ những bộ dữ liệu nước ngoài vào thực tế trong nước vì thế thường không đạt được độ chính xác như kỳ vọng.

Ngoài ra, trong điều kiện thực tế, một sự kiện nếu bị bỏ sót hoặc bị nhận dạng sai ngay từ ban đầu có thể dẫn đến sự sai lệch dây chuyền trong quá trình theo dõi trạng thái các thiết bị về sau, làm tích lũy sai số và gây ảnh hưởng nghiêm trọng đến độ tin cậy của toàn bộ hệ thống NILM. Điều này đặc biệt quan trọng trong các ứng dụng yêu cầu độ chính xác cao như quản lý năng lượng thông minh, chẩn đoán lỗi thiết bị hoặc hỗ trợ người dùng tối ưu hóa mức tiêu thụ điện năng.

Xuất phát từ những hạn chế và thách thức nêu trên, có thể thấy rằng việc xây dựng một hệ thống NILM có khả năng hoạt động tốt trong môi trường thực tế, với nhiều thiết bị hoạt động đồng thời, tín hiệu đo chứa nhiễu và dựa trên dữ liệu thu thập tại môi trường trong nước là một vấn đề cần thiết và có ý nghĩa thực tiễn cao. Điều này đặt ra yêu cầu phải nghiên cứu sâu hơn về phương pháp phát hiện sự kiện, trích chọn đặc trưng và nhận dạng phụ tải dựa trên dữ liệu thực nghiệm, đồng thời giảm thiểu sự phụ thuộc vào những giả định lý tưởng thường được sử dụng trong các nghiên cứu trước đây.

Chính vì vậy, đề tài đô án này tập trung vào việc nghiên cứu và xây dựng một hướng tiếp cận cho bài toán NILM dựa trên dữ liệu đo thực tế, với mục tiêu cải thiện khả năng phát hiện và nhận dạng thiết bị điện trong điều kiện có nhiều sự kiện chồng lấn và tín hiệu không ổn định. Đây không chỉ là một bài toán mang tính học thuật mà còn có ý nghĩa ứng dụng rõ rệt trong bối cảnh quản lý và sử dụng năng lượng hiệu quả tại Việt Nam hiện nay.


\section{Mục tiêu nghiên cứu}
Đề tài được thực hiện nhằm xây dựng, kiểm thử và đánh giá một hệ thống NILM theo hướng sự kiện (Event-based NILM) có khả năng vận hành ổn định trong điều kiện thực tế, nơi tín hiệu điện chịu ảnh hưởng bởi nhiễu, dao động phụ tải và sự chồng lấn sự kiện bật/tắt của nhiều thiết bị. Các mục tiêu cụ thể của nghiên cứu bao gồm:
\begin{itemize}
    \item Xây dựng phương pháp phát hiện sự kiện bật/tắt của thiết bị dựa trên tín hiệu điện tổng thu thập từ hệ thống thực, đảm bảo xác định đúng thời điểm thay đổi trạng thái của thiết bị ngay cả trong môi trường chứa nhiều nhiễu và nhiều thiết bị hoạt động đồng thời.
    \item Giảm thiểu tỉ lệ bỏ sót sự kiện (missed events) và hạn chế nhiễu giả (false events) thông qua việc đề xuất hoặc điều chỉnh các thuật toán xử lý tín hiệu, nhằm nâng cao độ ổn định và độ tin cậy của quá trình phát hiện sự kiện.
    \item Thực hiện nhận dạng thiết bị dựa trên các đặc trưng tín hiệu trích xuất từ dữ liệu đo thực, bao gồm công suất tức thời, dạng sóng dòng điện, điện áp và các đặc trưng thống kê hoặc miền tần số; từ đó phân loại và nhận dạng thiết bị một cách chính xác hơn trong điều kiện tín hiệu thực nghiệm phức tạp.
    \item Xây dựng và công bố một bộ dữ liệu thực nghiệm mới gồm tín hiệu điện áp và dòng điện tức thời của nhiều thiết bị gia dụng trong các sự kiện bật/tắt. Bộ dữ liệu được thu thập trong điều kiện lưới điện Việt Nam, đóng vai trò như một nền tảng đánh giá cho các phương pháp NILM hướng sự kiện và góp phần khắc phục sự thiếu hụt dữ liệu bản địa so với các bộ dữ liệu quốc tế như PLAID.
    \item Triển khai, mô phỏng và kiểm thử toàn bộ thuật toán trên môi trường phần mềm (Python) theo phương thức xử lý ngoại tuyến (offline processing), bao gồm trực quan hóa tín hiệu, phân tích đặc trưng và đánh giá hiệu năng thuật toán nhằm kiểm chứng tính khả thi và độ chính xác của hệ thống.
    \item Định hướng phát triển ứng dụng trong thực tế, làm tiền đề cho việc triển khai hệ thống NILM tại các hộ gia đình hoặc các mô hình quản lý năng lượng thông minh trong tương lai, góp phần nâng cao hiệu quả sử dụng năng lượng và hỗ trợ người dùng theo dõi phụ tải một cách chi tiết mà không cần sử dụng cảm biến riêng lẻ cho từng thiết bị.
\end{itemize}

\section{Phạm vi nghiên cứu}
Phạm vi của đề tài tập trung vào việc xây dựng, triển khai và đánh giá hệ thống NILM theo hướng sự kiện dựa trên dữ liệu đo thực nghiệm. Nghiên cứu chỉ xem xét việc xử lý và phân tích tín hiệu dưới dạng ngoại tuyến (offline), không bao gồm việc triển khai trên phần cứng đo lường thời gian thực hoặc các hệ thống IoT tích hợp.

Dữ liệu sử dụng trong đồ án được thu thập trực tiếp từ nhiều thiết bị điện gia dụng trong các sự kiện bật/tắt, bao gồm tín hiệu điện áp và dòng điện tức thời. Các tín hiệu này được xử lý trong môi trường lập trình Python nhằm trích xuất đặc trưng, phát hiện sự kiện và nhận dạng thiết bị.

Trong giới hạn nghiên cứu, đề tài tập trung vào các nội dung chính sau:

\begin{itemize}
    \item Phát hiện sự kiện bật/tắt của thiết bị từ tín hiệu điện tổng trong điều kiện có nhiễu và nhiều phụ tải hoạt động đồng thời.
    \item Trích xuất đặc trưng và nhận dạng thiết bị dựa trên dữ liệu dòng điện và điện áp được đo trong các sự kiện chuyển trạng thái.
    \item Đánh giá hiệu năng của hệ thống thông qua các thí nghiệm ngoại tuyến, bao gồm độ chính xác phát hiện sự kiện và nhận dạng thiết bị.
\end{itemize}

Một số nội dung liên quan nhưng không được xem xét trong phạm vi đề tài bao gồm:

\begin{itemize}
    \item Ước lượng năng lượng tiêu thụ dài hạn hoặc phân rã công suất liên tục theo thời gian.
    \item Tối ưu hóa chuyên sâu các mô hình học máy hoặc triển khai các mô hình phức tạp yêu cầu dữ liệu lớn.
    \item Tích hợp hệ thống vào phần cứng đo đạc thời gian thực hoặc các nền tảng IoT/embedded.
\end{itemize}

\section{Cấu trúc của đồ án}

Đồ án này được tổ chức thành 7 chương, mỗi chương trình bày một cách mạch lạc và chi tiết, giúp người đọc dễ dàng theo dõi quá trình nghiên cứu, từ lý thuyết cơ bản đến triển khai và đánh giá hệ thống NILM dựa trên dữ liệu đo thực tế.

Cấu trúc cụ thể của đồ án như sau:

\begin{itemize}
    \item \textbf{Chương 1: Giới thiệu} – Trình bày bối cảnh nghiên cứu về NILM, các hướng tiếp cận phổ biến, đặt vấn đề, mục tiêu và phạm vi nghiên cứu. Đồng thời, chương này nêu tổng quan về đóng góp chính của đề tài, bao gồm xây dựng hệ thống NILM hướng sự kiện và bộ dữ liệu thực nghiệm mới.
    
    \item \textbf{Chương 2: Tổng quan hệ thống NILM đề xuất} – Mô tả kiến trúc và các thành phần chính của hệ thống, bao gồm khối thu thập dữ liệu, phát hiện sự kiện, tiền xử lý và trích xuất đặc trưng, nhận dạng thiết bị. Chương này cũng nêu ưu điểm nổi bật và các hạn chế cùng hướng khắc phục.
    
    \item \textbf{Chương 3: Thu thập dữ liệu} – Trình bày phương pháp thu thập dữ liệu thực nghiệm, bao gồm các sự kiện bật/tắt của nhiều thiết bị, phạm vi thực hiện và ghi chú về triển khai thực tế. Chương này cũng giới thiệu bộ dữ liệu mới được xây dựng, phục vụ trực tiếp cho kiểm thử hệ thống NILM hướng sự kiện.
    
    \item \textbf{Chương 4: Thuật toán phát hiện sự kiện} – Trình bày tổng quan thuật toán phát hiện sự kiện đề xuất được áp dụng, áp dụng nhiều phương pháp bao gồm lọc trung bình, WAMMA, bộ lọc Kalman, và thuật toán Hybrid của Mengqi Lu và Zuyi Li. Chương này cũng trình bày cách đánh giá hiệu quả các thuật toán.
    
    \item \textbf{Chương 5: Tiền xử lý dữ liệu và trích xuất đặc trưng} – Trình bày mục tiêu của giai đoạn tiền xử lý, phương pháp trích xuất đặc trưng công suất và đặc trưng ảnh, cơ sở lý thuyết, vấn đề thực tế, phương pháp tính toán và kết quả thu được.
    
    \item \textbf{Chương 6: Mô hình học máy} – Trình bày các mô hình học máy được áp dụng cho việc nhận dạng thiết bị dựa trên đặc trưng tín hiệu đã trích xuất, cũng như các bước huấn luyện, kiểm thử và tối ưu hóa mô hình.
    
    \item \textbf{Chương 7: Kết quả và đánh giá hệ thống} – Trình bày dữ liệu đánh giá, quy trình đánh giá, kết quả thực nghiệm của các thuật toán phát hiện sự kiện, nhận xét và phân tích hiệu quả hệ thống.
\end{itemize}

Cấu trúc này giúp làm rõ quá trình nghiên cứu từ lý thuyết đến triển khai thực nghiệm và đánh giá thuật toán, đồng thời nhấn mạnh đóng góp chính của đề tài trong việc phát triển hệ thống NILM hướng sự kiện và bộ dữ liệu thực nghiệm phục vụ quản lý năng lượng hiệu quả trong môi trường gia đình.

\chapter{Tổng quan hệ thống NILM đề xuất}
\section{Kiến trúc tổng thể và các thành phần chức năng}

Hệ thống NILM đề xuất trong đồ án được thiết kế theo hướng mô-đun hoá, cho phép
tách biệt rõ ràng vai trò của từng khối xử lý và đảm bảo tính mở rộng khi triển khai thực
tế. Kiến trúc tổng thể gồm bốn thành phần chính: (1) Khối thu thập tín hiệu, (2) Khối phát
hiện sự kiện bật/tắt, (3) Khối tiền xử lý và trích xuất đặc trưng, và (4) Khối nhận diện thiết
bị. Các khối này phối hợp theo chu trình xử lý tuần tự, từ việc thu nhận dữ liệu thô đến 
việc xác định chính xác danh tính thiết bị gây ra sự kiện tiêu thụ điện.

\begin{figure}[H]{Kiến trúc tổng thể của hệ thống NILM đề xuất}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/LuongHeThongNILM.jpg}
\end{figure}

\subsection{Khối thu thập tín hiệu}

Khối thu thập tín hiệu đóng vai trò là nguồn dữ liệu đầu vào cho toàn bộ hệ thống.
Tín hiệu điện áp (U) và dòng điện (I) được lấy từ công tơ tổng theo thời gian thực, sau đó
được sử dụng để tính công suất tức thời $P(t)$. Độ chính xác và tính ổn định của các tín
hiệu này có ảnh hưởng quan trọng đến hiệu suất của các khối phía sau, đặc biệt là khối
phát hiện sự kiện. Do đó, khối này không chỉ thực hiện việc thu thập mà còn đảm bảo 
chuẩn hoá dữ liệu và đồng bộ thời gian giữa các kênh đo.

\subsection{Khối phát hiện sự kiện bật/tắt thiết bị}

Khối phát hiện sự kiện nhằm xác định thời điểm mà một thiết bị trong hệ thống thay 
đổi trạng thái hoạt động. Đây là bước quan trọng nhất của toàn bộ pipeline, bởi chất lượng
phát hiện sự kiện sẽ quyết định trực tiếp đến độ chính xác end-to-end của hệ thống.

Trong mô hình đề xuất, khối này được thiết kế theo hướng kết hợp nhiều kỹ thuật xử
lý tín hiệu nhằm:
\begin{itemize}
    \item Giảm nhiễu do dao động tức thời của phụ tải
    \item Tăng độ nhạy với các biến động công suất nhỏ
    \item Cải thiện khả năng định biên sự kiện khi nhiều thiết bị hoạt động đồng thời.
\end{itemize}

Kết quả đầu ra của khối này là danh sách thời điểm xảy ra các sự kiện bật/tắt, làm
cơ sở cho bước trích xuất đặc trưng.

\subsection{Khối tiền xử lý và trích xuất đặc trưng}

Sau khi phát hiện sự kiện, hệ thống tiến hành cắt trích đoạn tín hiệu trong một cửa sổ 
thời gian xung quanh sự kiện. Từ các đoạn tín hiệu này, các đặc trưng quan trọng được
rút trích, bao gồm:
\begin{itemize}
    \item Độ thay đổi công suất $\Delta P$ trước và sau sự kiện,
    \item Thông tin dạng sóng I--V,
    \item Các biểu diễn tín hiệu được chuẩn hoá và chuyển đổi sang dạng ảnh phục vụ 
          mô hình học máy.
\end{itemize}

Khối này đóng vai trò kết nối giữa xử lý tín hiệu truyền thống và học máy, đảm bảo
các tín hiệu thô được chuyển đổi sang không gian đặc trưng phù hợp để phân loại.

\subsection{Khối nhận diện thiết bị}

Dựa trên các đặc trưng được trích xuất, hệ thống sử dụng mô hình học máy MLP 
(Multilayer Perceptron) để nhận diện thiết bị gây ra sự kiện. Mô hình được huấn luyện 
từ các đặc trưng ảnh tín hiệu và các đặc trưng công suất, cho phép phân biệt các thiết bị 
có profile tiêu thụ tương đối gần nhau. Đầu ra của khối này là nhãn thiết bị tương ứng
với từng sự kiện bật/tắt, cung cấp khả năng theo dõi hoạt động thiết bị theo thời gian thực.

\section{Ưu điểm của kiến trúc hệ thống đề xuất}

Kiến trúc mà đồ án đề xuất đem lại nhiều ưu điểm so với các hệ thống NILM truyền 
thống:

\textbf{Khả năng phát hiện sự kiện chính xác và ổn định}

Nhờ sự kết hợp giữa nhiều bộ lọc và thuật toán tối ưu trong khâu phát hiện sự kiện,
hệ thống đạt khả năng nhận biết biến động công suất với độ tin cậy cao, giảm thiểu cả bỏ
sót lẫn phát hiện giả.

\textbf{Xử lý tốt môi trường thực với nhiều thiết bị đồng thời}

Khác với nhiều nghiên cứu giả định ít thiết bị hoặc trạng thái đơn giản, hệ thống 
được thiết kế để hoạt động ổn định ngay cả khi nhiều phụ tải thay đổi trạng thái cùng lúc.

\textbf{Khả năng loại bỏ nhiễu và sự kiện bất thường}

Cơ chế phân tích đặc trưng kết hợp với mô hình học máy giúp hệ thống nhận biết 
các sự kiện bất thường và thiết bị không thuộc tập huấn luyện, tránh việc nhận dạng sai.

\section{Hạn chế và hướng hoàn thiện}

Mặc dù có nhiều ưu điểm, hệ thống vẫn tồn tại một số hạn chế:

\begin{itemize}
    \item \textbf{Chi phí tính toán tương đối cao}: Các bước trích xuất và phân tích ảnh
          tín hiệu đòi hỏi tài nguyên xử lý đáng kể.
    \item \textbf{Yêu cầu phần cứng tương đối mạnh}: Việc triển khai trên thiết bị nhúng 
          công suất thấp gặp nhiều hạn chế.
    \item \textbf{Giới hạn trong các sự kiện quá gần nhau}: Khi hai sự kiện xảy ra trong
          khoảng thời gian ngắn, việc định biên có thể chưa chính xác, dẫn đến gộp sự kiện.
\end{itemize}

Những hạn chế này được thảo luận chi tiết hơn ở các chương tiếp theo cùng với định 
hướng khắc phục trong tương lai.

\chapter{Thu thập dữ liệu}

Trong phạm vi đồ án, dữ liệu điện áp (U) và dòng điện (I) tức thời của hệ thống điện gia đình được thu thập với mục tiêu tạo ra tập dữ liệu phục vụ bài toán phát hiện và nhận diện sự kiện trong phân tích phụ tải phi xâm lấn (NILM). Việc thu thập được tiến hành trong môi trường có kiểm soát, nơi các sự kiện bật/tắt thiết bị được tạo ra một cách chủ động để đảm bảo dữ liệu có chất lượng và độ rõ ràng cao, phù hợp cho quá trình đánh giá thuật toán.

\section{Phương pháp thu thập}

Dữ liệu U và I được ghi nhận liên tục trong khi hệ thống đang hoạt động ở các trạng thái khác nhau của tập thiết bị gia đình. Trong mỗi lần thu thập, chúng tôi lựa chọn một tổ hợp thiết bị đang hoạt động ổn định (ví dụ bật đèn + quạt + laptop đang sạc). Sau đó, chúng tôi chủ động thay đổi trạng thái của một thiết bị duy nhất tại một thời điểm, chẳng hạn bật tủ lạnh, tắt sạc máy tính, hoặc bật máy sấy.

Mỗi sự kiện thay đổi trạng thái thiết bị đều được thu thập theo quy trình:
\begin{itemize}
    \item Ghi lại tín hiệu U và I trước thời điểm thiết bị thay đổi trạng thái (vùng “pre-event”).
    \item  Ghi lại tín hiệu U và I sau thời điểm thiết bị thay đổi trạng thái (vùng “post-event”).
    \item Hai vùng dữ liệu này được lưu dưới dạng các mẫu liên tục, dùng làm cơ sở để đánh giá khả năng phát hiện và nhận diện sự kiện.
\end{itemize}

\section{Cấu hình hệ thống đo và lý do lựa chọn phần cứng}

Để đảm bảo thu được tín hiệu tức thời có độ chính xác cao, hệ thống đo được thiết kế dựa trên các thành phần sau.

\textbf{Điều kiện điện lưới Việt Nam}

\begin{itemize}
    \item Điện áp danh định: 220 V AC
    \item Tần số lưới: 50 Hz
\end{itemize}

Các thông số này ảnh hưởng trực tiếp đến biên dạng tín hiệu cần đo, tốc độ lấy mẫu và yêu cầu thiết bị cảm biến.

\textbf{Cảm biến dòng SCT013}

Cảm biến SCT013 là loại biến dòng không xâm lấn, có ưu điểm:

\begin{itemize}
    \item An toàn tuyệt đối nhờ cách ly hoàn toàn với lưới điện.
    \item Dễ lắp đặt ở mọi dây tải.
    \item Đáp ứng đủ chính xác cho các thiết bị gia dụng trong dải 0–20 A.
    \item Tín hiệu tuyến tính tốt trong khoảng dòng thường gặp của hộ gia đình.
\end{itemize}

SCT013 đặc biệt phù hợp cho nghiên cứu NILM vì nhiều thiết bị có dòng khởi động lớn, và cảm biến này có thể ghi nhận được đặc trưng chuyển tiếp đó.

\textbf{Cảm biến điện áp ZMPT107}

Việc đo điện áp dạng sóng giúp nhận diện:

\begin{itemize}
    \item Biến dạng sóng khi thiết bị phi tuyến bật/tắt
    \item Sự lệch pha giữa U và I
    \item Các nhiễu chuyển tiếp trong khoảng dưới 20 ms.
\end{itemize}

ZMPT107 có ưu điểm:

\begin{itemize}
    \item Độ chính xác cao với điện áp xoay chiều 0–250 V.
    \item Có biến áp cách ly chống giật, đảm bảo an toàn.
    \item Đáp ứng đủ nhanh cho bài toán NILM.
\end{itemize}

\textbf{IC đo điện năng BL0940}

IC BL0940 thực hiện số hóa tín hiệu U và I. Lý do lựa chọn BL0940 thay vì các IC như ADE7755 hay HLW8012:

\begin{itemize}
    \item Độ phân giải ADC cao hơn.
    \item Có khả năng xuất dữ liệu tức thời, không chỉ giá trị RMS.
    \item Tích hợp bộ lọc chống nhiễu tần số cao.
    \item Giao tiếp bằng SPI, tốc độ truyền nhanh và ổn định.
\end{itemize}


BL0940 cung cấp cả:

\begin{itemize}
    \item Tín hiệu điện áp tức thời
    \item Tín hiệu dòng tức thời
    \item Công suất tức thời
    \item Giá trị RMS theo cửa sổ trượt
\end{itemize}

IC này rất phù hợp cho NILM ở cả mức sự kiện và mức phân giải thiết bị.

\textbf{Raspberry Pi 4 là thiết bị thu nhận dữ liệu}

Raspberry Pi 4 đảm nhiệm các nhiệm vụ:

\begin{itemize}
    \item Nhận dữ liệu tốc độ cao qua SPI từ BL0940
    \item Ghi dữ liệu theo thời gian thực vào tệp CSV
    \item Gán timestamp với độ chính xác microsecond
    \item Giao tiếp dễ dàng với Python để xử lý tiền dữ liệu
\end{itemize}

Việc sử dụng Pi4 giúp đảm bảo không mất mẫu, đồng thời tạo môi trường xử lý linh hoạt.


\begin{figure}[H]{Sơ đồ hệ thống thu thập dữ liệu được sử dụng}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/measurement_system.png}
\end{figure}

\section{Phạm vi thực hiện}

Trong phạm vi của đồ án này, hệ thống thu thập dữ liệu được xây dựng nhằm phục vụ cho việc đánh giá thuật toán phát hiện sự kiện và nhận diện thiết bị dựa trên tín hiệu điện áp (U) và dòng điện (I). Toàn bộ quá trình xử lý được thực hiện ngoại tuyến (offline), nghĩa là dữ liệu được thu thập trước, lưu thành các tệp dữ liệu và sau đó được phân tích bằng các công cụ lập trình, chủ yếu là Python.

Dữ liệu được thu thập từ hệ thống phần cứng bao gồm cảm biến SCT013, ZMPT107, IC BL0940 và Raspberry Pi 4, nhưng việc nhận diện sự kiện chưa được triển khai trực tiếp trên phần cứng. Thay vào đó, các thuật toán phát hiện sự kiện, phân tích dạng sóng, tính toán đặc trưng và đánh giá hiệu năng đều được chạy trên máy tính cá nhân. Cách làm này phù hợp với phạm vi nghiên cứu trong khuôn khổ đồ án, giúp tập trung vào việc xây dựng và kiểm chứng thuật toán trước khi tiến đến các bước triển khai thực tế phức tạp hơn.

Ngoài ra, hệ thống chỉ xem xét một tập thiết bị gia dụng giới hạn, với số lượng và loại thiết bị được lựa chọn trước. Điều này cho phép kiểm soát tốt điều kiện thí nghiệm, song đồng thời cũng tạo ra ràng buộc về mặt tổng quát khi áp dụng cho môi trường hộ gia đình thực tế, nơi hành vi thiết bị diễn ra ngẫu nhiên, đa dạng và có thể chồng lấn nhiều sự kiện.

Do vậy, kết quả của đồ án có ý nghĩa như một bước thử nghiệm ban đầu, cung cấp cơ sở quan trọng cho các nghiên cứu mở rộng tiếp theo, nhưng chưa đại diện cho toàn bộ bối cảnh triển khai NILM trong thực tế.

\section{Ghi chú về triển khai thực tế}

Trong ứng dụng thực tế của hệ thống NILM, quá trình thu thập và xử lý dữ liệu phải được thực hiện theo thời gian thực (real-time), khác biệt đáng kể so với cách xử lý ngoại tuyến trong phạm vi đồ án. Cụ thể, để xác định đúng vùng ``trước sự kiện'' (pre-event) và ``sau sự kiện'' (post-event), hệ thống phải liên tục giám sát và lưu trữ tín hiệu U và I trong bộ đệm trượt (sliding buffer). Bộ đệm này luôn chứa một lượng dữ liệu gần nhất, cho phép truy xuất tức thời khi phát hiện sự thay đổi bất thường trong tín hiệu.

Trong trường hợp xảy ra sự kiện bật hoặc tắt thiết bị, hệ thống cần:
\begin{itemize}
    \item trích xuất một cửa sổ dữ liệu ngay trước thời điểm thay đổi (pre-event window),
    \item trích xuất cửa sổ dữ liệu ngay sau sự kiện (post-event window),
    \item gửi hai vùng tín hiệu này đến bộ phận phân tích đặc trưng và nhận diện.
\end{itemize}

Quá trình này đòi hỏi phần cứng phải hoạt động ổn định, có khả năng lấy mẫu liên tục, xử lý tín hiệu nhanh và có dung lượng bộ nhớ đủ để lưu bộ đệm. Bên cạnh đó, hệ thống thực tế cần có cơ chế đồng bộ thời gian chính xác, quản lý nhiều sự kiện có thể diễn ra gần như đồng thời, và đảm bảo độ tin cậy ngay cả khi tải biến động mạnh hoặc xuất hiện nhiễu điện lưới.

Ngoài yêu cầu kỹ thuật, triển khai thực tế còn phải đối mặt với các thách thức khác như:
\begin{itemize}
    \item Tính đa dạng của thiết bị gia dụng trong các hộ gia đình.
    \item Anh hưởng từ môi trường điện lực (nhiễu, dao động điện áp, công suất phản kháng).
    \item Giới hạn về chi phí phần cứng và khả năng mở rộng hệ thống.
\end{itemize}

Những yếu tố này cho thấy việc triển khai một hệ thống NILM hoàn chỉnh ngoài thực tế phức tạp hơn đáng kể so với mô phỏng trong khuôn khổ đồ án. Tuy nhiên, mô hình đã xây dựng trong đề tài có thể xem như nền tảng ban đầu để phát triển các phiên bản hoạt động theo thời gian thực trong tương lai.


\section{Hạn chế của hệ thống thu thập}

Mặc dù hệ thống thu thập dữ liệu được thiết kế phù hợp với mục tiêu của đề tài và đã trải qua quá trình hiệu chuẩn chi tiết, vẫn tồn tại một số hạn chế nhất định về mặt kỹ thuật. Việc nêu rõ các hạn chế này giúp đánh giá khách quan năng lực của hệ thống, tăng tính học thuật của báo cáo và định hướng rõ ràng các hướng phát triển trong tương lai.

\textbf{Giới hạn về tần số lấy mẫu}

Tần số lấy mẫu 1\,kHz được lựa chọn nhằm cân bằng giữa dung lượng dữ liệu, tốc độ xử lý và độ phân giải theo thời gian của tín hiệu. Tuy nhiên, mức tần số này chỉ phù hợp để thu thập tín hiệu cơ bản của lưới điện 50\,Hz và các sự kiện chuyển trạng thái kéo dài trong khoảng từ vài mili-giây trở lên. 

Đối với các nhiễu chuyển tiếp rất nhanh (transient) có thời gian đặc trưng dưới 1\,ms, tần số 1\,kHz không đủ để mô tả chính xác dạng sóng. Điều này đồng nghĩa hệ thống không thể thu thập tốt các thành phần phổ tần số cao, vốn là thông tin quan trọng trong các phương pháp NILM mức cao tần (High-Frequency NILM). Tuy nhiên, với mục tiêu của đề tài là phát hiện sự kiện mức cơ bản (state transition), mức lấy mẫu 1\,kHz vẫn đáp ứng đầy đủ yêu cầu.

\textbf{Hạn chế của cảm biến dòng SCT013}

Cảm biến SCT013, mặc dù phổ biến và an toàn, có một hạn chế đáng chú ý là độ tuyến tính suy giảm mạnh ở vùng dòng điện thấp (nhỏ hơn 0.2\,A). Điều này làm cho tín hiệu thu được ở các thiết bị công suất nhỏ (ví dụ: quạt công suất thấp) có độ chính xác không cao. 

Hệ quả là biên độ dòng điện bị thu nhỏ quá mức hoặc méo dạng, khiến các sự kiện bật/tắt của thiết bị nhỏ có thể bị bỏ sót hoặc không đủ rõ để phân tách khỏi nhiễu nền. Mặc dù vậy, hệ thống vẫn hoạt động tốt đối với đa số thiết bị có công suất trung bình và lớn trong hộ gia đình.

\textbf{Đặc tính bộ lọc nội của IC BL0940}

IC BL0940 có tích hợp bộ lọc nội nhằm làm mượt tín hiệu dòng và điện áp trước khi xuất giá trị đo. Bộ lọc này giúp giảm nhiễu điện từ và tăng độ ổn định của dữ liệu, nhưng đồng thời cũng làm giảm biên độ của các đỉnh dòng dạng xung ngắn (spikes) hoặc các nhiễu quá độ có thời gian rất ngắn.

Do đó, một số đặc trưng dạng sóng dùng cho phân tích nâng cao, như đỉnh khởi động của động cơ hoặc nhiễu chuyển mạch nhanh của các nguồn xung (SMPS), có thể bị làm mờ hoặc không còn xuất hiện rõ ràng. Điều này là hạn chế đối với NILM mức nâng cao, vốn cần phân tích chi tiết các thành phần tần số cao. Tuy nhiên, đối với mục tiêu phát hiện sự kiện (event detection) theo hướng truyền thống dựa trên biên độ và công suất tức thời, ảnh hưởng này là không đáng kể.

\textbf{Thu thập dữ liệu theo phương pháp bán thủ công}

Trong phạm vi đề tài, dữ liệu được thu thập bằng phương pháp bán thủ công: người thực hiện điều khiển bật/tắt thiết bị theo kịch bản có chủ đích để thu nhận các sự kiện rõ ràng. Mặc dù cách làm này thuận tiện cho đánh giá thuật toán, nó không phản ánh đầy đủ tính ngẫu nhiên của phụ tải trong môi trường sinh hoạt thực tế.

Ở các hộ gia đình, người dùng bật/tắt thiết bị theo hành vi rất đa dạng, thậm chí xảy ra nhiều thiết bị chuyển trạng thái gần như đồng thời. Do đó, việc thu thập bán thủ công có thể hạn chế tính tổng quát của mô hình khi triển khai ngoài thực tế. Tuy nhiên, đối với giai đoạn nghiên cứu ban đầu trong khuôn khổ đồ án, phương pháp này là hợp lý và cho phép kiểm soát tốt các biến đầu vào.

\textbf{Tổng kết}

Các hạn chế nêu trên không ảnh hưởng đến mục tiêu chính của đồ án, vốn tập trung vào phát hiện sự kiện mức cơ bản và đánh giá sự thay đổi công suất của các thiết bị gia dụng. Tuy nhiên, việc nhận diện rõ ràng các yếu tố giới hạn sẽ giúp định hướng các hướng mở rộng tiềm năng, chẳng hạn như tăng tần số lấy mẫu, thay thế cảm biến tuyến tính hơn, tắt bộ lọc nội của IC đo chuyên dụng, hoặc triển khai hệ thống thu thập tự động trong môi trường thực tế để nâng cao tính khái quát của dữ liệu.


\chapter{Thuật toán phát hiện sự kiện}

\section{Tổng quan thuật toán phát hiện sự kiện}

Trong các hệ thống NILM hiện đại, phát hiện sự kiện (event detection) là bước quan trọng đầu tiên nhằm xác định thời điểm một thiết bị điện thay đổi trạng thái (bật, tắt hoặc chuyển mức tiêu thụ). Chất lượng của module phát hiện sự kiện ảnh hưởng trực tiếp đến toàn bộ pipeline phân tách tải, bởi mọi thuật toán nhận dạng về sau đều phụ thuộc vào việc sự kiện được xác định chính xác.

Phần lớn dữ liệu đo tại công trình dân dụng thường bị nhiễu, không ổn định và chứa nhiều dao động nhỏ do đặc tính của lưới điện và bản thân bộ đo. Vì vậy, thuật toán phát hiện sự kiện cần xử lý đồng thời ba yêu cầu: (1) duy trì độ nhạy đủ lớn để không bỏ sót sự kiện nhỏ, (2) hạn chế sinh nhiễu báo động giả (false positive), và (3) đảm bảo hoạt động ổn định trong điều kiện đo thực tế.

Trong đề tài này, pipeline phát hiện sự kiện được xây dựng dựa trên cấu trúc nhiều giai đoạn, kết hợp các kỹ thuật xử lý tín hiệu thời gian thực để tận dụng đặc tính của từng loại tín hiệu.

\textbf{Một số thuật ngữ cơ bản:}
\begin{table}[h]{Giải thích một số thuật ngữ về thuật toán phát hiện sự kiện}
    \centering
    \begin{adjustbox}{width=\linewidth}
        \begin{tabularx}{\linewidth}{| >{\centering\arraybackslash}p{3cm} | X |}
            \hline
            \textbf{Thuật ngữ} & \textbf{Giải thích} \\
            \hline
            Sự kiện (Event) & Thời điểm thiết bị bật hoặc tắt, gây thay đổi đột ngột trong dòng điện hoặc công suất. \\
            \hline
            Cửa sổ (Window) & Một đoạn tín hiệu con được trích từ chuỗi tín hiệu dài để phân tích tại một thời điểm xác định. \\
            \hline
        \end{tabularx}
    \end{adjustbox}
\end{table}

\textbf{Mục tiêu của bộ phát hiện sự kiện}
\begin{itemize}
    \item Xác định chính xác thời điểm thiết bị chuyển trạng thái (bật/tắt).
    \item Đây là bước nền tảng trong các hệ thống NILM, vì chất lượng của quá trình tách thiết bị và trích xuất đặc trưng phụ thuộc trực tiếp vào độ chính xác của việc phát hiện sự kiện.
\end{itemize}

\textbf{Nguyên lý hoạt động}

Tín hiệu công suất P được chia thành các cửa sổ thời gian có độ dài xác định. Với mỗi cửa sổ trượt, thuật toán so sánh công suất trung bình giữa hai phía (trước và sau) quanh một điểm nghi ngờ là sự kiện:
$$
\Delta P = \left| \overline{P}_{\text{trước}} - \overline{P}_{\text{sau}} \right|
$$

Nếu $\Delta P$ vượt quá một ngưỡng định trước, điểm này được xem là có khả năng xảy ra sự kiện — tức là thiết bị đã thay đổi trạng thái.

Quy trình tổng thể của hệ thống phát hiện sự kiện được mô tả như sau:

\textbf{1. Lọc và giảm tần số mẫu đầu vào} 

Dữ liệu ban đầu gồm điện áp và dòng điện được lấy mẫu ở tần số cao. Tuy nhiên, tần số mẫu lớn không phải lúc nào cũng cần thiết cho nhiệm vụ phát hiện sự kiện, và có thể làm tăng nhiễu do dao động tức thời. Do đó, giai đoạn đầu tiên thực hiện giảm tần số mẫu (downsampling) nhằm loại bỏ nhiễu tần số cao và chuẩn hóa dữ liệu. Bước này vừa giảm khối lượng tính toán, vừa giúp tín hiệu ổn định hơn trước khi đưa vào các thuật toán phát hiện biên.

\textbf{2. Tách tín hiệu thành hai nhánh xử lý song song}

\textit{Nhánh 1 – Thuật toán phát hiện tần số cao:}

Sự thay đổi trạng thái của thiết bị thường gây ra biến đổi đột ngột của dòng điện và công suất. Vì vậy, nhánh tần số cao được sử dụng để mô phỏng bộ lọc phát hiện cạnh, làm nổi bật các điểm thay đổi mạnh của tín hiệu.

Trong nhánh này, đề tài áp dụng thuật toán WAMMA (Weighted Average Multi-Metric Algorithm), một kỹ thuật dựa trên việc kết hợp nhiều đặc trưng biến thiên theo thời gian nhằm tăng độ nhạy khi phát hiện cạnh. WAMMA giúp xác định nhanh các điểm nghi ngờ là candidate events, tuy nhiên có thể bị ảnh hưởng bởi nhiễu tức thời. Vì vậy, các candidate này chưa được xem là sự kiện cuối cùng mà cần so sánh thêm ở bước sau.

\textit{Nhánh 2 – Thuật toán phát hiện tần số thấp:}

Để khắc phục hạn chế của nhánh tần số cao, hệ thống dùng thêm một nhánh phân tích tần số thấp nhằm kiểm tra tính ổn định của tín hiệu sau khi thiết bị thay đổi trạng thái. Một thuật toán cải tiến của MLZLI (Thuật toán Hybrid của Mengqi Lu và Zuyi Li cải tiến) được áp dụng nhằm đo mức biến thiên kéo dài và ổn định sau biên.

Trong nhánh này, tín hiệu được chạy qua bộ lọc Kalman để làm mượt (smoothing) và loại bỏ nhiễu do thay đổi tức thời, giúp nhận biết chính xác hơn đâu là sự thay đổi thực sự của thiết bị. Kết quả của nhánh thấp tần có độ tin cậy cao nhưng phản ứng chậm.

\textbf{3. Khối gộp sự kiện (Event Merging) và ra quyết định} 

Hai nhánh xử lý được kết hợp để tận dụng ưu điểm của cả hai:

Nhánh tần số cao: Phát hiện nhanh nhưng dễ nhiễu.

Nhánh tần số thấp: Phát hiện chậm nhưng chính xác, ổn định.

Do thiết bị có thể gây ra nhiều dao động nhỏ trong vài chu kỳ điện và có 2 nhánh phát hiện sự kiện, các sự kiện liên tiếp trong một khoảng thời gian ngắn được nhóm lại thành một sự kiện duy nhất (event grouping). Điều này giúp giảm số lượng sự kiện giả và đảm bảo mỗi lần thay đổi trạng thái chỉ tạo ra một sự kiện duy nhất

\textbf{Ý nghĩa và vai trò của module phát hiện sự kiện}

Với pipeline nhiều tầng như trên, module phát hiện sự kiện trong đề tài vừa đảm bảo kiểm soát nhiễu tốt, vừa duy trì độ phản ứng nhanh cần thiết. Kết quả là toàn bộ luồng dữ liệu của hệ thống NILM trở nên ổn định hơn: các sự kiện được xác định rõ ràng, mạch lạc và phù hợp cho giai đoạn phân loại thiết bị phía sau.

\begin{figure}[H]{Sơ đồ thuật toán phát hiện sự kiện đề xuất}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Event_Dectection/sodoevt.jpg}
\end{figure}

\section{Lọc trung bình}

Bộ lọc trung bình (Moving Average Filter) là một trong những bộ lọc số đơn giản và phổ biến nhất trong xử lý tín hiệu rời rạc. Mục đích chính của bộ lọc là làm mượt (smoothing) tín hiệu bằng cách thay thế giá trị hiện tại bằng giá trị trung bình của một nhóm các mẫu lân cận. Phương pháp này đặc biệt hiệu quả trong việc loại bỏ nhiễu ngẫu nhiên biên độ nhỏ, giúp tín hiệu trở nên ổn định hơn trước khi đưa vào các thuật toán phân tích sự kiện trong bài toán NILM.

\textbf{Cơ sở toán học của bộ lọc}

Bộ lọc trung bình cửa sổ \(M\) điểm được biểu diễn theo công thức:
\[
y[n] = \frac{1}{M} \sum_{k=0}^{M-1} x[n-k]
\]
Trong đó:
\begin{itemize}
    \item \(x[n]\): mẫu tín hiệu đầu vào tại thời điểm \(n\),
    \item \(y[n]\): mẫu tín hiệu sau khi lọc,
    \item \(M\): kích thước cửa sổ trung bình.
\end{itemize}

Bộ lọc này có thể hiểu như một phép tích chập (convolution) giữa tín hiệu và một nhân lọc (kernel) có dạng:
\[
h[n] = \frac{1}{M} \left[ 1, 1, 1, \dots, 1 \right]
\]

\textbf{Ảnh hưởng lên tín hiệu và đáp ứng tần số}

Dưới góc nhìn miền tần số, Moving Average đóng vai trò như một bộ lọc thông thấp đơn giản. Đáp ứng biên độ của bộ lọc là:
\[
H(e^{j\omega}) = \frac{1}{M} \frac{\sin(\omega M/2)}{\sin(\omega/2)}
\]

Đặc điểm quan trọng:
\begin{itemize}
    \item Bộ lọc suy giảm mạnh các thành phần tần số cao (nhiễu nhanh).
    \item Giữ lại các thành phần chậm như dạng sóng 50\,Hz của điện áp và dòng điện.
    \item Có các ``zero'' tại nhiều tần số bội của \(\frac{2\pi}{M}\), làm triệt tiêu hoàn toàn một số thành phần tần số cao.
\end{itemize}

Nhờ các đặc tính này, bộ lọc trung bình phù hợp để làm mượt tín hiệu trong bài toán NILM vốn không yêu cầu phân tích nhiễu tần số cao.

\textbf{Ví dụ minh họa}

Xét chuỗi tín hiệu ban đầu:
\[
100,\; 101,\; 99,\; 100,\; 102,\; 99
\]

Khi áp dụng bộ lọc trung bình cửa sổ \(M=3\):
\[
100, \; 100
\]

Quá trình này làm giảm dao động cục bộ, làm mượt tín hiệu nhưng vẫn giữ nguyên xu hướng tổng thể.

\textbf{Ứng dụng trong hệ thống NILM của đề tài}

Trong hệ thống thu thập dữ liệu của đề tài, bộ lọc trung bình được sử dụng với hai mục đích chính:

\textit{Làm mượt tín hiệu dòng điện và điện áp}

Các cảm biến như SCT013 và ZMPT107 vốn có nhiễu nội tại, đặc biệt khi đo ở dòng nhỏ hoặc điện áp dao động. IC BL0940 cũng tạo ra nhiễu dạng xung nhỏ trong quá trình chuyển đổi ADC. Việc áp dụng Moving Average giúp:
\begin{itemize}
    \item giảm nhiễu đo,
    \item ổn định tín hiệu,
    \item làm rõ ràng các sự kiện bật/tắt,
    \item giảm sai số trong tính toán công suất tức thời.
\end{itemize}

Điều này đặc biệt quan trọng vì thuật toán phát hiện sự kiện dựa vào biến thiên đột ngột của công suất P và dòng I.

\textit{Giảm tần số lấy mẫu từ 1000\,Hz xuống 100\,Hz}

Việc thu thập tín hiệu ban đầu ở tần số 1000\,Hz giúp đảm bảo không mất thông tin gốc. Tuy nhiên, lưu và xử lý dữ liệu ở 1000 điểm/mỗi giây sẽ gây ra:

\begin{itemize}
    \item dung lượng dữ liệu lớn,
    \item tốc độ xử lý chậm,
    \item khó quan sát sự kiện,
    \item tăng thời gian huấn luyện mô hình và phân tích.
\end{itemize}

Do đó, tín hiệu sau khi làm mượt được giảm mẫu còn 100\,Hz bằng cách tính trung bình mỗi 10 mẫu liên tiếp. Tần số 100\,Hz vẫn đủ cao để mô tả đầy đủ đường bao (envelope) của tải điện 50\,Hz.  

Lợi ích của việc giảm tần số mẫu:
\begin{itemize}
    \item giảm dung lượng dữ liệu xuống 1/10,
    \item tăng tốc độ xử lý mà không làm mất thông tin về sự kiện,
    \item phù hợp với yêu cầu của các thuật toán event detection truyền thống,
    \item giảm nhiễu tần số cao vốn không cần thiết cho bài toán.
\end{itemize}

\textbf{Hạn chế của bộ lọc trung bình}

Mặc dù hiệu quả và đơn giản, Moving Average có các hạn chế:
\begin{itemize}
    \item làm mờ biên các sự kiện rất nhanh (ví dụ spike nhỏ trong tải SMPS),
    \item không phù hợp cho phân tích tần số cao,
    \item có độ trễ cố hữu,
    \item không tối ưu khi nhiễu không phải dạng Gaussian.
\end{itemize}

Tuy nhiên, trong bối cảnh của đồ án — tập trung vào sự kiện bật/tắt công suất tương đối lớn — những hạn chế này không ảnh hưởng đến chất lượng mô hình.

\textbf{Minh họa trên dữ liệu PLAID}

Hình dưới đây thể hiện tín hiệu công suất ban đầu ở tần số 30\,kHz trong bộ dữ liệu PLAID và tín hiệu sau khi lọc trung bình và giảm mẫu xuống 50\,Hz. Có thể thấy nhiễu biên độ cao được loại bỏ, biên dạng công suất trở nên rõ ràng và dễ nhận diện sự kiện hơn.

\begin{figure}[H]{Đồ thị công suất với công suất gốc tần số 30kHz và lấy mẫu lọc trung bình 50Hz trên tập PLAID}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/Event_Dectection/loctb.jpg}
\end{figure}

Bộ lọc trung bình do đó là lựa chọn phù hợp cho hệ thống xử lý sự kiện của đề tài, đảm bảo cân bằng giữa độ phức tạp tính toán, mức độ nhiễu và chất lượng tín hiệu đầu ra.


\section{Thuật toán WAMMA}

\subsection{Giới thiệu}

Trong bước phát hiện sự kiện của hệ thống NILM, việc xác định chính xác các thời điểm thay đổi công suất là rất quan trọng để tách biệt các thiết bị điện khác nhau. Tuy nhiên, các phương pháp sử dụng tham số cố định thường bị ảnh hưởng bởi nhiễu, dao động hoặc các sự kiện xảy ra gần nhau. 

Thuật toán WAMMA (Window with Adaptive Margins and Multi-window Analysis) được đề xuất nhằm khắc phục các hạn chế này bằng cách sử dụng cơ chế tự thích ứng ở cả ngưỡng phát hiện và cấu trúc cửa sổ phân tích. Phương pháp này được trình bày trong nghiên cứu của Yan et al và đã chứng minh hiệu quả vượt trội trong việc phát hiện sự kiện công suất với độ chính xác cao.

\subsection{Nguyên lý hoạt động của thuật toán}

Thuật toán WAMMA dựa trên ba cơ chế chính:

\begin{itemize}
    \item \textbf{(1) Adaptive Window Margins:} 
    Cửa sổ trượt được chia thành ba vùng: vùng biên trái (Left Margin), vùng trung tâm và vùng biên phải (Right Margin). Hai biên này đại diện cho các trạng thái công suất trước và sau sự kiện. Trong quá trình phân tích, kích thước biên được điều chỉnh tự động dựa trên biến thiên công suất và xu hướng tín hiệu để đảm bảo vùng chuyển tiếp của sự kiện được bao trọn hoàn toàn. 
    Cơ chế này giúp thuật toán thích nghi với độ dài khác nhau của các sự kiện chuyển tiếp (ví dụ: bật/tắt thiết bị công suất lớn thường có quá trình chuyển tiếp dài hơn so với thiết bị nhỏ).

    \item \textbf{(2) Adaptive Thresholding:}
    Ngưỡng phát hiện sự kiện không cố định mà được cập nhật động theo độ lệch chuẩn của dữ liệu trong cửa sổ hiện tại. 
    Cụ thể, ngưỡng thích ứng được tính theo công thức:
    \[
    P_{thr,w} = \max(P_{thr}, r_{thr} \times \sigma)
    \]
    trong đó $\sigma$ là độ lệch chuẩn của tín hiệu công suất trong cửa sổ, $P_{thr}$ là ngưỡng tối thiểu định trước, và $r_{thr}$ là hệ số tỉ lệ. 
    Cơ chế này giúp thuật toán tự động điều chỉnh độ nhạy, giảm phát hiện giả khi tín hiệu nhiễu cao và tăng độ chính xác khi tín hiệu ổn định.

    \item \textbf{(3) Multi-window Screening:}
    Để đảm bảo phát hiện ổn định, WAMMA có thể triển khai đồng thời nhiều cửa sổ có kích thước khác nhau. Nếu một sự kiện được phát hiện trong nhiều cửa sổ trượt liên tiếp hoặc ở các độ rộng cửa sổ khác nhau, kết quả đó được xác nhận là sự kiện thật. Cơ chế sàng lọc đa cửa sổ này giúp loại bỏ nhiễu ngắn hạn và cải thiện độ tin cậy của hệ thống.
\end{itemize}

Ngoài ra, WAMMA còn tích hợp cơ chế \textit{cross-validation} giữa các bộ dữ liệu để đánh giá tính ổn định của tham số, chứng minh khả năng tổng quát hóa cao trong môi trường thực tế.

\subsection{Mã giả thuật toán (theo triển khai trong đề tài)}

Thuật toán được mô tả ngắn gọn bằng mã giả dưới đây, dựa trên phần cài đặt Python của đề tài:

\begin{algorithm}[H]
\caption{Thuật toán WAMMA}
\begin{algorithmic}[1]
\Require Chuỗi công suất $P_t$, các tham số $N_w$, $N_m$, $P_{thr}$, $r_{thr}$
\State Khởi tạo cửa sổ trượt rỗng và giá trị biên ban đầu
\For{mỗi mẫu công suất $p$ trong chuỗi $P_t$}
    \State Thêm $p$ vào cửa sổ hiện tại
    \If{độ dài cửa sổ $<$ $N_w$}
        \State Tiếp tục đọc dữ liệu (chưa đủ mẫu)
        \State \textbf{continue}
    \EndIf
    \State Tính giá trị trung bình $u$ và độ lệch chuẩn $\sigma$
    \State Cập nhật ngưỡng thích ứng: $P_{thr,w} = \max(P_{thr}, r_{thr} \times \sigma)$
    \State Tính biến thiên công suất biên trái $\Delta P_L$ và biên phải $\Delta P_R$
    \If{$\Delta P_L$ hoặc $\Delta P_R$ vượt ngưỡng cục bộ}
        \State Điều chỉnh biên trái/phải, mở rộng cửa sổ
        \State \textbf{continue}
    \EndIf
    \State Tính trung bình biên trái $u_L$ và phải $u_R$
    \State $\Delta P = u_R - u_L$
    \If{$\Delta P > P_{thr,w}$}
        \State Ghi nhận sự kiện bật (ON)
    \ElsIf{$\Delta P < -P_{thr,w}$}
        \State Ghi nhận sự kiện tắt (OFF)
    \EndIf
    \State Khởi tạo lại cửa sổ để tiếp tục phát hiện sự kiện tiếp theo
\EndFor
\end{algorithmic}
\end{algorithm}

\subsection{Phân tích và đánh giá}

WAMMA mang lại một số ưu điểm nổi bật so với các phương pháp truyền thống như CUSUM hay GLR:
\begin{itemize}
    \item Thích ứng tốt với nhiễu và dao động do điều khiển điện tử.
    \item Không cần tinh chỉnh tham số thủ công khi áp dụng cho các hộ gia đình khác nhau.
    \item Có thể mở rộng sang các tập dữ liệu có tần số lấy mẫu khác nhau (20 Hz, 50 Hz, 60 Hz).
\end{itemize}

Các thử nghiệm trên bộ dữ liệu LIFTED (50 Hz) và BLUED (60 Hz) trong nghiên cứu gốc cho thấy, phương pháp WAMMA đạt độ chính xác cao hơn và độ nhạy tốt hơn so với các kỹ thuật phát hiện sự kiện hiện có, đồng thời duy trì khả năng ổn định khi thay đổi tập dữ liệu.

\section{Bộ lọc Kalman}
Bộ lọc Kalman là một phương pháp ước lượng trạng thái tối ưu, được sử dụng để làm mượt tín hiệu trong các hệ thống có nhiễu. Nguyên tắc cơ bản là kết hợp giá trị dự đoán từ dữ liệu trước đó với giá trị quan sát thực tế, nhằm tạo ra một tín hiệu mượt và chính xác hơn.

Với dữ liệu công suất 1 chiều, bộ lọc Kalman có thể được mô tả đơn giản như sau:

\begin{enumerate}
    \item \textbf{Dự đoán giá trị tiếp theo:}
    \[
    \hat{x}_{k|k-1} = \hat{x}_{k-1}
    \]

    \item \textbf{Cập nhật ước lượng với quan sát thực tế:}
    \[
    \hat{x}_k = \hat{x}_{k|k-1} + K_k (z_k - \hat{x}_{k|k-1})
    \]

    \item \textbf{Trọng số Kalman \(K_k\)} xác định mức độ tin tưởng vào quan sát mới, giá trị trong khoảng từ 0 đến 1.
\end{enumerate}

Trong đó: 
\begin{itemize}
    \item $\hat{x}_k$ là giá trị công suất đã làm mượt tại thời điểm $k$,
    \item $z_k$ là giá trị quan sát thực tế,
    \item $K_k$ là trọng số Kalman.
\end{itemize}

\textbf{Tác dụng trong đề tài:}  
Trong đồ án này, bộ lọc Kalman được áp dụng trước thuật toán Hybrid để làm mượt tín hiệu công suất, giúp nhận diện các sự kiện tiêu thụ điện năng chậm, yếu hoặc bị che khuất trong môi trường công suất thay đổi mạnh (CVDs). Nhờ đó, việc phát hiện các sự kiện trở nên chính xác và ổn định hơn, giảm nhiễu và dao động nền, tạo điều kiện thuận lợi cho các bước xử lý tiếp theo.


\section{Thuật toán Hybrid của Mengqi Lu và Zuyi Li}

Sau khi hoàn tất quá trình tiền xử lý bằng Bộ lọc Trung bình (Averaging Filter) và Bộ lọc Kalman (Kalman Filter), chúng tôi áp dụng Thuật toán Phát hiện Cơ sở (Base Detection Algorithm) – một thành phần của Thuật toán Hybrid được đề xuất bởi Mengqi Lu và Zuyi Li – lên dữ liệu đã được làm mượt. Thuật toán này xác định các sự kiện chuyển mạch dựa trên tiêu chí chênh lệch lớn giữa công suất trung bình trước và sau một điểm thời gian quan sát. Chức năng chính của phương pháp này là nâng cao khả năng phát hiện các sự kiện có biên độ nhỏ hoặc dễ bị che khuất trong môi trường có sự biến động công suất mạnh.

Thuật toán Cơ sở hoạt động bằng cách tìm kiếm sự chênh lệch lớn về công suất trung bình đã ước tính ($P_{\text{estimated}}$) giữa hai cửa sổ trượt liền kề.

\textbf{Tính toán Trung bình Động}

Tại mỗi điểm mẫu $i$, thuật toán tính toán công suất trung bình trong hai cửa sổ trượt có kích thước $n$ mẫu:
\begin{align*}
Mean_{i,\text{before}} &= \frac{1}{n} \sum_{j=i-n}^{i-1} P_{\text{estimated}, j} \\
Mean_{i,\text{after}} &= \frac{1}{n} \sum_{j=i+1}^{i+n+1} P_{\text{estimated}, j}
\end{align*}
\textit{Kích thước cửa sổ $n$ được chọn tương ứng với khoảng $10$ giây để tối ưu hóa độ nhạy.}

\textbf{Điều Kiện Phát Hiện Sự Kiện}

Một sự kiện được xác nhận tại thời điểm $i$ nếu độ chênh lệch tuyệt đối giữa hai giá trị trung bình này vượt quá ngưỡng công suất $P_{\text{th}}$:
\begin{equation*}
\text{Sự kiện xảy ra tại } i \text{ nếu } |Mean_{i,\text{after}} - Mean_{i,\text{before}}| > P_{\text{th}}
\end{equation*}

\textbf{Cơ Chế Giới Hạn Thời Gian (Time Limit)}

Để tránh việc phát hiện một quá trình quá độ thành nhiều sự kiện nhỏ, cơ chế Giới hạn Thời gian ($T_{\text{th}}$) được áp dụng. Nếu hai sự kiện được phát hiện liên tiếp trong khoảng thời gian $\Delta t < T_{\text{th}}$ (chọn $T_{\text{th}} = 0.2$ giây theo khuyến nghị của bài báo gốc), chúng sẽ được gộp lại và coi là một sự kiện chuyển trạng thái duy nhất.

Ở trong phạm vi của đồ án này, MLZL là thuật toán Hybrid của Mengqi Lu và Zuyi Li gốc, và MLZLI là cho thuật toán đó nhưng được chỉnh được áp dụng cho hệ thống đề xuất.

\section{Đánh giá thuật toán}
\begin{table}[H]{Bảng kết quả đánh giá thuật toán phát hiện sự kiện trên tập dữ liệu tự đo}
    \centering
    \begin{tabular}{|c|c|c|c|c|c|c|}
        \hline
        & $WAMMA_1$ & $WAMMA_2$ & $WAMMA_3$ & $MLZL_1$ & $MLZL_2$ & ĐỀ XUẤT \\ \hline
        TPP & 65.3\% & 84.6\% & 75\% & 36\% & 80\% & 100\% \\ \hline
        FPP & 6\% & 17.3\% & 2.3\% & 8\% & 0\% & 14\% \\ \hline
        FNN & 34.7\% & 9.4\% & 25\% & 64\% & 20\% & 0\% \\ \hline
        F1  & 76.2\% & 86.3\% & 86.6\% & 53\% & 92\% & 93.5\% \\ \hline
    \end{tabular}
\end{table}

\textbf{Giải thích}

TPP: (True positive Percentage) Nhận đúng sự kiện

FPP: (False positive Percentage) Không có sự kiện nhưng lại ra có

FNN: (False Negative Percentage) Có sự kiện nhưng không nhận ra

Tham số:

\begin{itemize}
    \item \texttt{WAMMA\_1}: $P_{thre} = 30\ \text{W}$, cửa sổ $10\ \text{s}$, viền $3\ \text{s}$, nhạy nhiễu $=1$, lấy mẫu $10\ \text{Hz}$
    \item \texttt{WAMMA\_2}: $P_{thre} = 20\ \text{W}$, cửa sổ $5\ \text{s}$, viền $2\ \text{s}$, nhạy nhiễu $=0.5$, lấy mẫu $10\ \text{Hz}$
    \item \texttt{WAMMA\_3}: $P_{thre} = 20\ \text{W}$, cửa sổ $8\ \text{s}$, viền $2\ \text{s}$, nhạy nhiễu $=0.1$, lấy mẫu $1\ \text{Hz}$
    \item \texttt{MLZL\_1}: $P_{thre} = 20\ \text{W}$, cửa sổ $10\ \text{s}$, lấy mẫu $100\ \text{Hz}$
    \item \texttt{MLZL\_2}: $P_{thre} = 20\ \text{W}$, cửa sổ $5\ \text{s}$, lấy mẫu $0.1\ \text{Hz}$
    \item \textbf{Đề xuất:} \texttt{WAMMA\_Thre} = 30\,W, \texttt{WAMMA\_WIN\_SEC} = 10\,s, \texttt{WAMMA\_WIN\_BOR} = 3, \texttt{LOW\_DEC} = 0.1\,Hz, \texttt{LOW\_DEC\_Thre} = 10\,W, \texttt{EVENT\_TIME\_LIMIT\_DIF} = 30\,s, \texttt{EVENT\_TIME\_LIMIT\_SAM} = 1\,s
    \item \texttt{LOW\_DEC\_SAMPLING\_SEC} = 10, lấy mẫu 100\,Hz
\end{itemize}


\textbf{Nhận xét:}

Kết quả trong bảng cho thấy sự khác biệt rõ rệt giữa các cấu hình WAMMA, MLZL và thuật toán đề xuất. Nhìn chung, các thuật toán gốc hoạt động tốt trong các trường hợp tín hiệu đơn giản, ít nhiễu, nhưng gặp hạn chế khi phải xử lý các tình huống phức tạp như thiết bị có công suất nhỏ, thiết bị bật/tắt trong thời gian rất ngắn hoặc trường hợp có nhiều thiết bị thay đổi trạng thái cùng lúc.

Một quan sát quan trọng là các cấu hình sử dụng tần số lấy mẫu thấp (ví dụ WAMMA\_2, WAMMA\_3 và MLZL\_2) có xu hướng đạt TPP cao hơn trong các tình huống đơn giản vì tín hiệu được làm mượt nhiều, giảm nhiễu tức thời. Tuy nhiên, việc giảm nhiễu bằng cách lấy mẫu thấp cũng làm giảm khả năng phát hiện các sự kiện nhỏ hoặc có biên dạng công suất biến thiên nhanh, dẫn đến sai sót khi gặp các thiết bị khó, chẳng hạn như bộ sạc laptop, quạt nhỏ, \ldots{} Đây là lý do MLZL\_2 đạt TPP tốt (80\%) nhưng vẫn xuất hiện 20\% FNN.

Ngược lại, các cấu hình lấy mẫu cao như WAMMA\_1 và MLZL\_1 giúp ghi nhận đầy đủ biên dạng thay đổi công suất theo thời gian, nhờ đó phát hiện chính xác hơn các trường hợp phức tạp, nhiều nhiễu hoặc biên dạng không tuyến tính. Tuy nhiên, tần số lấy mẫu cao làm tăng độ nhạy đối với nhiễu ngẫu nhiên, dẫn đến tỷ lệ FPP cao hơn. Điều này thể hiện rõ ở WAMMA\_1 (6\% FPP) và đặc biệt MLZL\_1 (8\% FPP), dù khả năng nhận diện đúng TPP lại thấp (36\%). Nguyên nhân là các thuật toán MLZL cần tín hiệu mượt hơn để hoạt động hiệu quả; khi áp dụng trên tín hiệu nhiễu, mô hình dễ hiểu nhầm nhiễu thành sự kiện.

Một điểm đáng chú ý khác là sự đánh đổi giữa TPP và FPP xuất hiện xuyên suốt tất cả các cấu hình. Khi thuật toán tăng độ nhạy (giảm ngưỡng hoặc tăng tần số lấy mẫu), TPP thường tăng nhưng FPP cũng tăng theo. Khi giảm độ nhạy (ngưỡng cao hoặc lấy mẫu thấp), FPP giảm nhưng dễ bỏ sót sự kiện, làm tăng FNN. Đây là đặc tính chung của hầu hết các bộ phát hiện sự kiện dựa trên biên độ công suất.

Thuật toán đề xuất đạt TPP = 100\%, tức không bỏ lỡ bất kỳ sự kiện nào (FNN = 0\%). Kết quả này cho thấy hệ lai ghép (kết hợp WAMMA + Low-Dec + các ràng buộc thời gian) đã khắc phục tốt hạn chế của từng phương pháp gốc. Cụ thể:

\begin{itemize}
    \item WAMMA xử lý tốt các sự kiện lớn hoặc có biên dạng rõ ràng.
    \item Low-Dec xử lý tốt các sự kiện nhỏ và thay đổi chậm.
    \item Bộ ràng buộc thời gian giúp loại bỏ nhiễu ngắn hạn nhưng vẫn giữ được các sự kiện thực.
\end{itemize}

Tuy nhiên, nhược điểm của thuật toán đề xuất là tỷ lệ FPP còn cao (14\%), nguyên nhân chính là hệ thống ưu tiên ``không bỏ sót sự kiện'' hơn là ``hạn chế báo sai''. Một số trường hợp như thay đổi điện áp lưới hoặc dao động công suất tự nhiên của thiết bị bị hiểu sai thành sự kiện. Điều này có thể được cải thiện bằng cách:

\begin{itemize}
    \item Bỏ qua các sự kiện không khớp với bất kỳ thiết bị nào trong cơ sở dữ liệu,
    \item Giảm độ nhạy của ngưỡng Low-Dec với các tín hiệu dao động nhỏ,
    \item Bổ sung bộ phân loại hậu kỳ để xác nhận sự kiện.
\end{itemize}

Tổng thể, kết quả cho thấy thuật toán đề xuất phù hợp với mục tiêu của hệ NILM thời gian thực: không bỏ lỡ sự kiện và phản ứng nhanh với thay đổi phụ tải. Mặc dù FPP còn cao, nhưng mức này chấp nhận được và có thể giảm tiếp bằng các bước lọc hoặc nhận dạng thiết bị ở giai đoạn sau.

\chapter{Tiền xử lý dữ liệu và trích xuất đặc trưng}

\section{Mục tiêu của giai đoạn tiền xử lý và trích xuất đặc trưng}
Mục tiêu chính của giai đoạn tiền xử lý và trích xuất đặc trưng là xác định và biểu diễn đặc trưng riêng của thiết bị vừa thay đổi trạng thái hoạt động. Cụ thể, quá trình này bao gồm:
\begin{itemize}
    \item Trích xuất đặc trưng công suất tiêu thụ của thiết bị tại thời điểm xảy ra thay đổi trạng thái (bật/tắt hoặc chuyển chế độ hoạt động).
    \item Trích xuất đặc trưng hình ảnh (I–V) của thiết bị, trong đó hình ảnh được biểu diễn dưới dạng đồ thị với: \begin{itemize}
        \item Trục hoành: hiệu điện thế U
        \item Trục tung: dòng điện I       
    \end{itemize}
\end{itemize}
Trong hệ thống điện dân dụng, hiệu điện thế U thường có dạng gần như cố định, trong khi dòng điện I thay đổi theo đặc tính tải của từng thiết bị. Do đó, mỗi thiết bị sẽ tạo ra đặc trưng I–V khác nhau, phản ánh hành vi tiêu thụ điện riêng biệt.

Các đặc trưng về công suất và hình ảnh I–V này sẽ được sử dụng làm cơ sở cho quá trình nhận dạng thiết bị, giúp phân biệt các thiết bị điện trong cùng hệ thống.

\section{Trích xuất đặc trưng công suất}
Khi thuật toán phát hiện sự kiện xác định có sự thay đổi trạng thái xảy ra, nó sẽ trả về thời điểm phát hiện sự kiện cùng với độ dài cửa sổ sự kiện. Dựa trên các thông tin này, ta xác định hai mốc thời gian quan trọng:
\begin{itemize}
    \item Thời điểm trước sự kiện: được lấy sớm hơn thời điểm phát hiện một vài giây.
    \item Thời điểm sau sự kiện: được lấy muộn hơn thời điểm kết thúc cửa sổ sự kiện một vài giây.
\end{itemize}
Việc dịch thời gian như vậy nhằm loại bỏ giai đoạn quá độ (transition period) – giai đoạn mà thiết bị vừa thay đổi trạng thái và công suất chưa ổn định. Điều này giúp đảm bảo dữ liệu đo được phản ánh trạng thái ổn định trước và sau khi thiết bị thay đổi.
Sau khi xác định hai khoảng thời gian trên, thuật toán sẽ:
\begin{itemize}
    \item Tính giá trị trung bình công suất tức thời trong mỗi khoảng (trước và sau sự kiện).
    \item Lấy hiệu tuyệt đối giữa hai giá trị trung bình này.
\end{itemize}
Giá trị thu được chính là đặc trưng công suất tiêu thụ của thiết bị vừa thay đổi trạng thái.

Trong quá trình trích xuất đặc trưng hình ảnh (I–V), các mốc thời gian “trước” và “sau” sự kiện cũng được xác định tương tự, nhằm đảm bảo tính nhất quán giữa hai loại đặc trưng.

\section{Trích xuất đặc trưng ảnh}
\subsection{Cơ sở lý thuyết}

Trong hệ thống phân tích phụ tải phi xâm lấn (NILM), toàn bộ phép đo được thực hiện tại một điểm duy nhất trên mạng điện, thường là ngay sau công tơ tổng. Điều này có nghĩa là hệ thống chỉ quan sát được điện áp $U(t)$ và dòng điện tổng $I(t)$ của toàn bộ tải trong nhà, thay vì quan sát từng thiết bị riêng lẻ như các hệ đo đa kênh. Vì vậy, bài toán NILM đặt ra câu hỏi trung tâm: Từ tín hiệu tổng hợp này, làm thế nào để suy ra sự thay đổi của từng thiết bị?

Mạng điện dân dụng là mạng mắc song song, do đó điện áp đặt lên tất cả các thiết bị là như nhau. Khi một thiết bị mới được bật, nó được mắc song song với các thiết bị đang hoạt động, dẫn đến tổng dòng điện trong mạch tăng lên. Quan hệ này được mô tả bởi định luật Kirchhoff về dòng điện:

\[
I_{\text{total}} = \sum_{k=1}^{n} I_k.
\]

Giả sử tại thời điểm $t_0$, hệ thống có $n$ thiết bị đang hoạt động, với tổng dòng điện $I_t$. Tại thời điểm $t_1$, khi thiết bị thứ $(n+1)$ được bật, dòng tổng tăng lên thành $I_p$. Vì đặc tính mắc song song, điện áp tổng trước và sau khi bật thiết bị được xem như không đổi:

\begin{equation}
U_{n+1} = U_p = U_t.
\end{equation}

Dòng điện của thiết bị mới có thể được suy ra từ chênh lệch dòng tổng:

\begin{equation}
I_{n+1} = I_p - I_t.
\end{equation}

Hai hình dưới đây minh họa mạng điện trước và sau khi thiết bị mới được cắm vào:

\begin{figure}[H]{Mạng điện trước khi cắm thêm thiết bị $n{+}1$}
    \centering
    \includegraphics[height=0.35\linewidth]{IMAGE/Co_so_ly_thuyet_tien_xu_ly/mangdienn.jpg}
\end{figure}

\begin{figure}[H]{Mạng điện sau khi cắm thêm thiết bị $n{+}1$}
    \centering
    \includegraphics[height=0.35\linewidth]{IMAGE/Co_so_ly_thuyet_tien_xu_ly/mangdienn_1.jpg}
\end{figure}

Từ góc nhìn công suất, ta có:

\[
P(t) = U(t)\,I(t),
\]

và sự kiện bật/tắt thiết bị tạo ra một bước nhảy công suất:

\[
\Delta P = P_{\text{after}} - P_{\text{before}}.
\]

Đây chính là ``chữ ký'' quan trọng giúp các thuật toán phát hiện sự kiện nhận biết thời điểm có thiết bị thay đổi trạng thái.

Mặt khác, mỗi thiết bị điện có thể được mô hình hóa như một tải tổng trở $Z = R + jX$, vì vậy dòng điện đặc trưng của thiết bị là:

\[
I = \frac{U}{Z}.
\]

Khi thiết bị bật, tổng trở tương đương của toàn mạng thay đổi, kéo theo sự thay đổi dòng điện tổng. Mức thay đổi này chịu ảnh hưởng của loại thiết bị, nguyên lý hoạt động (điện trở thuần, thiết bị có cuộn cảm, thiết bị có bộ nguồn switching), và đặc tính chuyển mạch. Nhờ đó, các hệ thống NILM có thể dựa trên dạng thay đổi của $I(t)$ và $P(t)$ để nhận diện thiết bị.

Cơ sở lý thuyết của NILM dựa trên ba nguyên lý quan trọng:

\begin{itemize}
    \item Mạng điện dân dụng mắc song song nên điện áp bằng nhau ở mọi tải.
    \item Dòng điện tổng là tổng dòng của từng thiết bị riêng lẻ.
    \item Sự kiện bật/tắt tạo ra bước nhảy đặc trưng trong tín hiệu dòng hoặc công suất.
\end{itemize}

Những nguyên lý này tạo nền tảng cho toàn bộ các thuật toán phát hiện sự kiện và nhận dạng thiết bị được trình bày ở các phần tiếp theo.

\subsection{Vấn đề thực tế}

Trong hệ thống điện thực tế, dòng điện và điện áp được đo tại từng thời điểm tức thời (instantaneous). Do nguồn điện sử dụng là dòng xoay chiều (AC), giá trị của điện áp và dòng điện luôn biến thiên theo thời gian theo dạng hình sin.
Khi thu thập dữ liệu trong một khoảng thời gian đủ dài trước và sau thời điểm thiết bị thay đổi trạng thái (bật hoặc tắt), ta thu được hai dãy mẫu $U_t,I_t$ (trước) và $U_p,I_p$ (sau). Tuy nhiên, thời điểm bắt đầu lấy mẫu của hai dãy không đảm bảo trùng pha hoặc cách nhau đúng một số nguyên chu kỳ điện. Điều này có nghĩa là dạng sóng $U_t$ và $U_p$ có thể bị lệch pha so với nhau. Vì lý do đó, ta không thể trực tiếp lấy hiệu $I_p-It$ hay $U_p=Ut$ để trích xuất đặc trưng thay đổi của thiết bị — việc so sánh hai tín hiệu lệch pha sẽ gây sai lệch lớn và không phản ánh đúng sự khác biệt do thiết bị tạo ra.

Ngoài ra, trong điều kiện thực tế, nếu cảm biến hoạt động ở tần số lấy mẫu thấp hoặc không ổn định, các điểm lấy mẫu thậm chí còn có khoảng cách thời gian không đều nhau. Điều này làm cho việc so khớp pha và tái dựng dạng sóng càng trở nên khó khăn, đòi hỏi phải có bước xử lý bổ sung như nội suy, đồng bộ pha hoặc tái đồng bộ tín hiệu trước khi phân tích.

\begin{figure}[H]{Minh họa mảng $Up$ và $Ut$ khác nhau, nên đồ thì chúng cũng khác nhau
}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/Screenshot 2025-11-25 103337.png}
\end{figure}

\begin{figure}[H]{Hình ảnh minh họa các điểm U được lấy mẫu lấy mẫu không đều}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/Screenshot 2025-11-25 104309.png}
\end{figure}

Với vấn đề trên, chỉ cần đảm bảo U trước và sau giống nhau, hay cùng pha là có thể thực hiện trừ I và trích xuất đặc trưng

\section{Phương pháp tính}

Quá trình trích xuất đặc trưng ảnh từ tín hiệu điện áp $U$ và dòng điện $I$ gồm bốn bước chính: nội suy dữ liệu, căn chỉnh pha, chia đoạn theo chu kỳ và lấy trung bình, sau đó tính hiệu và biểu diễn dạng sóng đặc trưng. Mỗi bước đều đóng vai trò quan trọng trong việc đảm bảo rằng tín hiệu đầu vào được xử lý một cách nhất quán, giảm nhiễu, và làm nổi bật chính xác phần thay đổi do thiết bị gây ra khi bật/tắt. Dưới đây là mô tả chi tiết từng bước.

\textbf{Bước 1: Nội suy tuyến tính}


Dữ liệu thu thập từ cảm biến thường có tần số mẫu không quá cao hoặc có thể không đều qua thời gian. Điều này gây khó khăn khi cần so sánh hai vùng tín hiệu trước và sau sự kiện. Vì vậy, bước đầu tiên là thực hiện nội suy tuyến tính cho cả hai tín hiệu $U$ và $I$.

Nội suy tuyến tính giúp:
\begin{itemize}
    \item Tăng số lượng điểm mẫu, cải thiện độ phân giải tín hiệu theo thời gian.
    \item Làm mượt dạng sóng, giúp dễ dàng quan sát chu kỳ và phát hiện biến thiên.
    \item Giảm sai số do hiện tượng trễ hoặc thiếu mẫu.
\end{itemize}

Việc nội suy không làm thay đổi đặc tính gốc của tín hiệu mà chỉ tăng mật độ thông tin. Do đó, các bước căn chỉnh và so khớp sau đó sẽ trở nên chính xác hơn.

\begin{figure}[H]{Ví dụ minh hoạ: nội suy tín hiệu $U$ với số lượng điểm tăng gấp 6 lần số điểm gốc}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/buoc1.png}
\end{figure}

\textbf{Bước 2: Dịch mảng và căn chỉnh pha}

Mục tiêu của bước này là tìm độ dịch tối ưu để hai mảng điện áp $U_p$ (sau khi thiết thay đổi trạng thái) và $U_t$ (trước khi thiết bị thay đổi trạng thái) trở nên trùng khớp với nhau nhất có thể.

Quy trình thực hiện như sau:
\begin{enumerate}
    \item Dịch mảng $U_t$ theo từng bước nhỏ (theo thời gian hoặc theo chỉ số mẫu).
    \item Tại mỗi vị trí dịch, tính sai số giữa hai mảng bằng công thức:    \begin{equation}
        E = \sum_{i=1}^{n} \left| U_p(i) - U_t(i) \right|
    \end{equation}
    Với n là độ dài mảng
    \item Sai số $E$ biểu thị mức độ khác biệt giữa hai dạng sóng tại vị trí dịch tương ứng.
    \item Lặp lại quá trình dịch và tính toán, ta tìm được vị trí dịch tạo ra sai số nhỏ nhất — đây chính là lúc hai dạng sóng đã gần trùng khớp nhất.
\end{enumerate}

Khi tìm được độ dịch tối ưu:

\begin{itemize}
    \item Hai tín hiệu $U_p$ và $U_t$ được căn chỉnh theo thời gian (đồng bộ pha).
    \item Vì dòng điện $I_t$ tương ứng vớ $U_t$, nên $I_t$ được dịch theo cùng độ dịch.
    \item Sau khi căn chỉnh xong, ta có thể lấy hiệu trực tiếp hai mảng dòng điện: 
    $
       I_{n+1} = I_p - I_t
    $
\end{itemize}
Nhờ đó, phần biến thiên của dòng điện thu được phản ánh đúng thay đổi do thiết bị tạo ra, thay vì sai lệch pha hoặc sai lệch thời gian giữa các mẫu đo.

\begin{figure}[H]{Minh họa Up, Ut trước và sau khi dịch theo Up}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/buoc2.png}
\end{figure}

\textbf{Bước 3: Chia đoạn và lấy trung bình theo chu kỳ}


Sau khi căn chỉnh pha, tín hiệu được chia thành nhiều đoạn tương ứng với từng chu kỳ điện. Việc chia theo chu kỳ dựa trên các điểm zero-crossing của điện áp hoặc các đỉnh cực đại/cực tiểu.

Tiếp theo, các chu kỳ được xếp chồng lên nhau và tính trung bình theo từng vị trí mẫu:
\[
\bar{U}(i) = \frac{1}{m} \sum_{k=1}^{m} U_k(i), \qquad 
\bar{I}(i) = \frac{1}{m} \sum_{k=1}^{m} I_k(i)
\]

Điều này giúp:
\begin{itemize}
    \item Loại bỏ nhiễu ngẫu nhiên.
    \item Tăng độ ổn định của đặc trưng dạng sóng.
    \item Thu được hình dạng trung bình đại diện cho thiết bị.
\end{itemize}

Kết quả thu được sau bước này là “đặc trưng dạng sóng” — dạng đặc trưng riêng của thiết bị, gần như bất biến theo thời gian và dễ nhận diện.


\begin{figure}[H]{Hình minh họa mô tả quá trình chia đoạn và tính trung bình.}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Trich xuat dac trung anh/buoc3.png}
\end{figure}

Hoàn thành bước này nghĩa là ta đã trích xuất thành công “đặc trưng dạng sóng” của thiết bị.

\textbf{Bước 4: Lấy hiệu và vẽ đồ thị}

Ở bước cuối, ta thực hiện:
\begin{itemize}
    \item Vẽ đồ thị các tín hiệu U và I sau khi đã xử lý.
    \item Tính hiệu trực tiếp: $U_{n+1} = U_p = U_t$, $I_{n+1} = I_p - I_t$
    \item Biểu diễn kết quả bằng đồ thị để quan sát trực quan sự thay đổi tín hiệu tại thời điểm thiết bị hoạt động.
\end{itemize}

Các hình ảnh ở góc dưới bên trái minh họa tín hiệu U và I sau khi hoàn thành bước 3 (trích xuất đặc trưng dạng sóng), trong khi các hình còn lại thể hiện kết quả cuối sau bước 4.

\begin{figure}[H]{Hình ảnh đồ thị từ bước 3 và 4.}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/Trich xuat dac trung anh/buoc4.jpg}
\end{figure}

\section{Kết quả trích xuất đặc trưng ảnh}

Thực hiện đánh giá bằng cách so sánh đặc trưng ảnh giữa việc dùng thuật toán và không sử dụng thuật toán trong trường hợp chỉ có 1 thiết bị hoạt động duy nhất làm tham chiếu
Chạy thử thuật toán trên một số thiết bị cho kết quả như sau:

Đối với quạt không sử dụng thuật toán
\begin{figure}[H]{Đặc trưng ảnh của quạt không sử dụng thuật toán và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/dactrungquatkothuattoan.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của quạt có sử dụng thuật toán tạo ảnh và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/dactrungquatthuatoan.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của quạt khi dùng cả thuật toán trừ và thuật toán tạo ảnh}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/dactrungquatcatru.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của sạc máy tính không sử dụng thuật toán và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/image6.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của sạc máy tính có sử dụng thuật toán tạo ảnh và hoạt động một mình}
    \centering
    \includegraphics[height=0.6\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/image7.png}
\end{figure}

\begin{figure}[H]{Đặc trưng ảnh của sạc máy tính khi dùng cả thuật toán trừ và thuật toán tạo ảnh}
    \centering
    \includegraphics[width=0.9\linewidth]{IMAGE/Ket_qua_thuat_toan_tao_anh/image8.png}
\end{figure}

\textbf{Nhận xét}

Từ các kết quả thử nghiệm, có thể nhận thấy rằng khi thiết bị hoạt động độc lập và không có sự chồng chéo giữa các tín hiệu, thuật toán tạo ảnh cho ra kết quả khá tương đồng với ảnh gốc (ảnh không qua xử lý). Các đặc trưng chính như biên dạng dòng điện theo chu kỳ, mức độ biến thiên theo thời gian và hình dáng tổng quát của dạng sóng đều được bảo toàn. Tuy nhiên, do bản chất của quá trình lấy trung bình theo chu kỳ, một số chi tiết biên nhỏ hoặc các đoạn có biến thiên nhanh bị làm mờ nhẹ. Điều này là kết quả tất yếu khi ưu tiên giảm nhiễu và thu được dạng sóng đại diện ổn định.

Khi áp dụng thêm thuật toán trừ (sử dụng cặp tín hiệu trước–sau sự kiện), các ảnh đặc trưng thu được thể hiện hình dạng rất gần với ảnh của trường hợp thiết bị hoạt động đơn lẻ có áp dụng thuật toán tạo ảnh. Điều này chứng tỏ rằng quá trình căn chỉnh pha và trích xuất phần tín hiệu đóng góp riêng của thiết bị đã vận hành đúng và chính xác. Đặc biệt, phần biến thiên của dòng điện $I_{n+1}$ sau khi trừ gần như trùng khớp với đặc trưng thực của thiết bị, dù trong tín hiệu gốc có nhiều thành phần chồng chéo từ các thiết bị khác.

Từ các ví dụ minh họa, có thể khẳng định rằng thuật toán trích xuất đặc trưng dạng sóng hoạt động hiệu quả và giữ được hình dạng đủ rõ ràng để cung cấp cho mô hình học máy. Mặc dù một số thông tin biên độ chi tiết có thể giảm nhẹ khi trung bình, nhưng hình dáng tổng thể và cấu trúc năng lượng theo chu kỳ — vốn là phần quan trọng nhất đối với mô hình phân loại — vẫn được bảo toàn. Điều này cho thấy rằng phương pháp đề xuất phù hợp với bài toán phân loại thiết bị trong hệ thống NILM và có tiềm năng đạt độ chính xác cao khi tích hợp vào mô hình nhận diện.

\chapter{Mô hình học máy}

\section{Giới thiệu}

Trong hệ thống Giám sát Phụ tải Không Xâm lấn (Non-Intrusive Load Monitoring -- NILM), sau khi phát hiện được thời điểm xảy ra một sự kiện bật/tắt, nhiệm vụ quan trọng tiếp theo là xác định thiết bị nào đã tạo ra sự kiện đó. Đối với bài toán nhận dạng thiết bị trong đề tài, mô hình được sử dụng là mạng nơ-ron đa lớp (Multi-Layer Perceptron -- MLP) với tập đặc trưng đầu vào bao gồm ảnh đặc trưng I--V và giá trị công suất trung bình của thiết bị.

MLP là một mô hình học máy có cấu trúc đơn giản nhưng mang lại hiệu quả cao đối với các bài toán phân loại có đầu vào dạng vector cố định. Trong bối cảnh của đề tài, ảnh đặc trưng I--V được chuyển đổi thành dạng ma trận và làm phẳng (flatten) thành vector, sau đó kết hợp với giá trị công suất trung bình $P_{\mathrm{mean}}$. Việc biểu diễn như vậy cho phép mô hình học được sự khác biệt đặc trưng giữa các thiết bị điện dựa trên hành vi tiêu thụ của chúng.

Nhờ đặc điểm gọn nhẹ, tốc độ suy luận nhanh và khả năng triển khai trong thời gian thực, MLP trở thành lựa chọn phù hợp cho bài toán phân loại thiết bị trong hệ thống NILM của đề tài. Phần này sẽ trình bày chi tiết quy trình xây dựng đặc trưng đầu vào, kiến trúc mô hình, phương pháp huấn luyện và đánh giá, qua đó làm rõ vai trò của mô hình MLP trong toàn bộ hệ thống nhận dạng thiết bị.

\section{Đầu vào của mô hình}

Đầu vào của mô hình MLP trong đề tài bao gồm hai loại đặc trưng được xử lý thông qua hai nhánh mạng riêng biệt: (1) ảnh đặc trưng I--V và (2) giá trị công suất $P$ của thiết bị tại thời điểm xảy ra sự kiện bật/tắt. Cả hai đặc trưng này đều được trích xuất từ khối tiền xử lý và trích xuất đặc trưng.

Ảnh I--V được xây dựng dựa trên mối quan hệ giữa dòng điện và điện áp khi thiết bị thay đổi trạng thái. Sau giai đoạn tiền xử lý, dữ liệu được ánh xạ thành ảnh kích thước $32 \times 32$, biểu diễn dạng phân bố đặc trưng của thiết bị. Ảnh được chuẩn hoá và làm phẳng (flatten) thành một vector một chiều trước khi đưa vào nhánh xử lý ảnh của mô hình, tạo ra vector đặc trưng $f_{\mathrm{img}} \in \mathrm{R}^{64}$.

Giá trị công suất $P$ của thiết bị tại thời điểm xảy ra sự kiện được đưa vào nhánh mạng thứ hai. Sau hai lớp fully-connected, đặc trưng này được biểu diễn dưới dạng vector $f_{P} \in \mathrm{R}^{16}$.

Cuối cùng, hai vector đặc trưng được ghép lại bằng phép nối:
\[
x = [f_{\mathrm{img}},\; f_{P}] \in \mathrm{R}^{80},
\]
và được đưa vào bộ phân loại cuối cùng để xác định thiết bị tương ứng.


\section{Kiến trúc mô hình MLP}

Mô hình MLP được thiết kế nhằm phân loại thiết bị dựa trên hai loại đặc trưng: ảnh I--V và giá trị công suất $P$. Mô hình có cấu trúc gồm ba phần chính: nhánh xử lý ảnh, nhánh xử lý công suất, và bộ phân loại kết hợp.

\begin{figure}[H]{Kiến trúc mô hình MLP được sử dụng}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/kientrucmlp.jpg}
\end{figure}

\subsection{Nhánh xử lý ảnh I--V}

Nhánh này nhận đầu vào là ảnh I--V đã được làm phẳng (flatten) thành vector một chiều có kích thước $32 \times 32 = 1024$. Nhánh xử lý ảnh gồm bốn lớp fully-connected liên tiếp với hàm kích hoạt ReLU:

\begin{itemize}
    \item Lớp 1: 1024 $\rightarrow$ 512 neuron
    \item Lớp 2: 512 $\rightarrow$ 256 neuron
    \item Lớp 3: 256 $\rightarrow$ 128 neuron
    \item Lớp 4: 128 $\rightarrow$ 64 neuron
\end{itemize}

Sau nhánh này, ảnh I--V được biểu diễn dưới dạng vector đặc trưng $f_{\mathrm{img}} \in \mathbb{R}^{64}$.

\subsection{Nhánh xử lý giá trị công suất}

Nhánh này nhận đầu vào là giá trị công suất $P$ của thiết bị tại thời điểm sự kiện. Nhánh gồm hai lớp fully-connected với ReLU:

\begin{itemize}
    \item Lớp 1: 1 $\rightarrow$ 32 neuron
    \item Lớp 2: 32 $\rightarrow$ 16 neuron
\end{itemize}

Kết quả là vector đặc trưng $f_P \in \mathbb{R}^{16}$.

\subsection{Bộ phân loại kết hợp}

Hai vector đặc trưng $f_{\mathrm{img}}$ và $f_P$ được ghép nối thành vector $x \in \mathbb{R}^{80}$:
\[
x = [f_{\mathrm{img}},\; f_P]
\]

Vector $x$ được đưa vào bộ phân loại gồm hai lớp fully-connected với ReLU:

\begin{itemize}
    \item Lớp 1: 80 $\rightarrow$ 32 neuron
    \item Lớp 2: 32 $\rightarrow$ $C$ neuron (số lớp bằng số thiết bị cần phân loại)
\end{itemize}

Lớp đầu ra trả về vector logits, sau đó có thể áp dụng softmax để tính xác suất dự đoán thiết bị.

\subsection{Tóm tắt kiến trúc}

Như vậy, kiến trúc MLP gồm hai nhánh độc lập xử lý ảnh I--V và công suất $P$, sau đó hợp nhất vector đặc trưng và đưa vào bộ phân loại. Cấu trúc này giúp mô hình học được đặc trưng riêng của từng loại dữ liệu, đồng thời kết hợp thông tin để phân loại chính xác các thiết bị.

\subsection{Hàm mất mát và tối ưu}

Mô hình MLP được huấn luyện để phân loại thiết bị sử dụng Categorical Cross-Entropy làm hàm mất mát:
\[
\mathcal{L} = - \sum_{i=1}^{C} y_i \log(\hat{y}_i),
\]
trong đó $C$ là số lớp (số thiết bị), $y_i$ là nhãn thật và $\hat{y}_i$ là xác suất dự đoán từ mô hình.

Mô hình được tối ưu bằng thuật toán Adam với learning rate $1 \times 10^{-3}$, huấn luyện trong 15 epoch với batch size 32, lựa chọn này giúp mạng học hiệu quả đặc trưng từ cả ảnh I--V và giá trị công suất $P$ đồng thời hạn chế tình trạng overfit.

\section{Quy trình huấn luyện}

Quy trình huấn luyện mô hình MLP bao gồm các bước chính sau:

\begin{enumerate}
    \item \textbf{Chuẩn hóa dữ liệu:} Ảnh I--V được chuẩn hóa và làm phẳng thành vector một chiều, trong khi giá trị công suất $P$ cũng được chuẩn hóa, đảm bảo các đặc trưng đầu vào cùng thang đo phù hợp cho mạng MLP.
    
    \item \textbf{Chia tập dữ liệu:} Tập huấn luyện được tạo từ các thiết bị hoạt động độc lập (mỗi thiết bị bật một mình), giúp mạng học chính xác đặc trưng của từng thiết bị. Tập kiểm tra (test) được tạo từ các sự kiện thay đổi trạng thái thiết bị trong môi trường có 0 hoặc nhiều thiết bị khác đang bật, nhằm đánh giá khả năng phân loại trong tình huống thực tế. Dữ liệu cũng được chia thành tập train và validation để theo dõi quá trình huấn luyện và điều chỉnh tham số.
    
    \item \textbf{Huấn luyện theo batch:} Mạng được huấn luyện theo batch với batch size = 32, sử dụng hàm mất mát Categorical Cross-Entropy và optimizer Adam với learning rate $1 \times 10^{-3}$. Quá trình huấn luyện kéo dài 15 epoch, đảm bảo mạng học hiệu quả đặc trưng từ cả ảnh I--V và công suất $P$ đồng thời hạn chế overfit.
    
    \item \textbf{Lưu mô hình:} Sau mỗi epoch, trạng thái mô hình và optimizer được lưu lại (checkpoint) để có thể tiếp tục huấn luyện nếu cần. Sau khi huấn luyện kết thúc, mô hình cuối cùng và bộ mã hóa nhãn (label encoder) được lưu để sử dụng cho dự đoán thiết bị.
\end{enumerate}


\chapter{Kết quả và đánh giá hệ thống}

\section{Dữ liệu đánh giá}

Bộ dữ liệu sử dụng để đánh giá hệ thống gồm 116 tệp dữ liệu, tương ứng với 5 thiết bị điện khác nhau.

Mỗi tệp mô tả quá trình một thiết bị thay đổi trạng thái (bật/tắt) tại một thời điểm xác định, trong các điều kiện khác nhau (các thiết bị còn lại có thể đang bật hoặc tắt).
Toàn bộ dữ liệu được tự thu thập trong phòng thí nghiệm, đảm bảo tính kiểm soát và đồng nhất về môi trường đo

\section{Quy trình đánh giá}

Trong quá trình đánh giá, hệ thống nhận đầu vào là một tệp dữ liệu duy nhất, sau đó
Đọc tuần tự giá trị dòng điện (I) và điện áp (U) tức thời.

Phát hiện sự kiện thay đổi trạng thái thiết bị.

Tiền xử lý và trích xuất đặc trưng để đưa vào mô hình học máy phân loại thiết bị.

Vì mỗi tệp chỉ chứa một sự kiện thực, nên:
\begin{itemize}
    \item Nếu hệ thống phát hiện nhiều hơn một sự kiện, các sự kiện dư sẽ được coi là sự kiện giả (false positive).Nếu hệ thống phát hiện nhiều hơn một sự kiện, các sự kiện dư sẽ được coi là sự kiện giả (false positive).
    \item Nếu hệ thống không phát hiện sự kiện nào, tệp đó được coi là một sự kiện bị bỏ sót (false negative).
\end{itemize}
Khi đánh giá mô hình học máy (ML) trong bài toán nhận diện sự kiện, mô hình chỉ đánh giá trên các sự kiện mà thuật toán phát hiện được. Điều này dẫn đến hạn chế: mô hình không phản ánh đầy đủ hiệu suất của toàn bộ hệ thống phát hiện sự kiện.
Trong thực tế, hệ thống có thể tạo ra:
\begin{itemize}
    \item Sự kiện giả (false positive): hệ thống phát hiện sự kiện dù thực tế không có.
    \item Sự kiện bị bỏ lỡ (false negative): sự kiện thực tế xảy ra nhưng hệ thống không phát hiện.Sự kiện bị bỏ lỡ (false negative): sự kiện thực tế xảy ra nhưng hệ thống không phát hiện.
\end{itemize}
Ví dụ: có 100 sự kiện thực tế cần nhận diện, nhưng hệ thống chỉ phát hiện được 90 sự kiện → bỏ lỡ 10 sự kiện. Trong 90 sự kiện phát hiện được, có 8 sự kiện là giả → 8 sự kiện giả.
Mô hình học máy chỉ đánh giá trên 82 sự kiện mà nó nhận được từ hệ thống, nên không thể đánh giá toàn diện toàn hệ thống (vì thiếu cả sự kiện giả và sự kiện bị bỏ lỡ).
Để đánh giá tổng thể, ta quy ước:
\begin{itemize}
    \item Các sự kiện giả được gán nhãn thực tế là null.
    \item Các sự kiện thật nhưng bị bỏ lỡ được xem như mô hình gán nhãn null.
\end{itemize}

Nhờ quy ước này, ta có thể đánh giá toàn bộ hệ thống (gồm cả phát hiện + phân loại) theo cách tương tự như đánh giá một mô hình ML thông thường.

\section{Kết quả thực nghiệm}

Tổng số sự kiện cần nhận diện: 116 sự kiện

\subsection{Đánh giá hệ thống sử dụng thuật toán phát hiện sự kiện WAMMA}

\begin{itemize}
    \item Số sự kiện được phát hiện chính xác: 65/116 (56\%)
    \item Số sự kiện bỏ lỡ: 51/116 (44\%)
    \item Số lượng sự kiện giả phát sinh: 2
\end{itemize}

\textbf{Kết quả đánh giả chỉ mô hình học máy:}

\begin{itemize}
    \item F1 Score: 95\%
    \item Recall: 95\%
    \item Percision: 95\%
    \item Accuracy: 95.24\%
\end{itemize}

\begin{figure}[H]{Kết quả phân loại sử dụng thuật toán WAMMA chỉ xét đến mô hình}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image9.png}
\end{figure}

\textbf{Kết quả đánh giá toàn bộ hệ thống}
\begin{itemize}
    \item F1 Score: 62\%
    \item Recall: 51\%
    \item Percision: 88\%
    \item Accuracy: 50.85\%
\end{itemize}

\begin{figure}[H]{Kết quả toàn bộ hệ thống sử dụng thuật toán sự kiện WAMMA}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image10.png}
\end{figure}

\subsection{Đánh giá hệ thống sử dụng thuật toán phát hiện sự kiện Hybrid của Mengqi Lu và Zuyi Li}
\begin{itemize}
    \item Số sự kiện được phát hiện chính xác: 81/116 (69.83\%)
    \item Số sự kiện bỏ lỡ: 36/116 (30.17\%)
    \item Số lượng sự kiện giả phát sinh: 9
\end{itemize}
\textbf{Kết quả đánh giả chỉ mô hình học máy:}
\begin{itemize}
    \item F1 Score: 99\%
    \item Recall: 99\%
    \item Percision: 99\%
    \item Accuracy: 98.75\%
\end{itemize}

\begin{figure}[H]{Kết quả phân loại sử dụng thuật toán Hybrid của Mengqi Lu và Zuyi Li chỉ xét đến mô hình}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image11.png}
\end{figure}

\textbf{Kết quả đánh giá toàn bộ hệ thống}
\begin{itemize}
    \item F1 Score: 73\%
    \item Recall: 68\%
    \item Percision: 97\%
    \item Accuracy: 67.52\%
\end{itemize}
\begin{figure}[H]{Kết quả toàn bộ hệ thống sử dụng thuật toán sự kiện Hybrid của Mengqi Lu và Zuyi Li}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image12.png}
\end{figure}

\subsection{Đánh giá hệ thống sử dụng thuật toán phát hiện sự kiện đề xuất}
\begin{itemize}
    \item Số sự kiện được phát hiện chính xác: 116/116 (100\%)
    \item Số sự kiện bỏ lỡ: 0/116 (0\%)
    \item Số lượng sự kiện giả phát sinh: 9
\end{itemize}
\textbf{Kết quả đánh giả chỉ mô hình học máy:}
\begin{itemize}
    \item F1 Score: 95\%
    \item Recall: 95\%
    \item Percision: 95\%
    \item Accuracy: 95.69\%
\end{itemize}

\begin{figure}[H]{Kết quả phân loại sử dụng thuật toán đề xuất chỉ xét đến mô hình}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image13.png}
\end{figure}

\textbf{Kết quả đánh giá toàn bộ hệ thống}
\begin{itemize}
    \item F1 Score: 84\%
    \item Recall: 89\%
    \item Percision: 86\%
    \item Accuracy: 88.8\%
\end{itemize}
\begin{figure}[H]{Kết quả toàn bộ hệ thống sử dụng thuật toán sự kiện đề xuất}
    \centering
    \includegraphics[width=0.8\linewidth]{IMAGE/ket_qua_he_thong/image14.png}
\end{figure}

\section{Nhận xét kết quả}
Kết quả thực nghiệm cho thấy hiệu suất tổng thể của hệ thống NILM hướng sự kiện phụ thuộc rất lớn vào chất lượng của thuật toán phát hiện sự kiện. Mặc dù mô hình học máy dùng để phân loại thiết bị hoạt động ổn định ở cả ba thuật toán, mức độ khác biệt về độ chính xác end-to-end chủ yếu xuất phát từ số lượng sự kiện bị bỏ sót và số lượng sự kiện giả được sinh ra trong giai đoạn phát hiện.

Trước hết, thuật toán WAMMA thể hiện nhiều hạn chế khi chỉ phát hiện được 56\% tổng số sự kiện. Mặc dù mô hình phân loại trên các sự kiện phát hiện được vẫn đạt F1-Score xấp xỉ 95\%, số lượng sự kiện bị bỏ sót lớn khiến hệ thống mất khả năng theo dõi chính xác trạng thái thiết bị theo thời gian. Kết quả này phản ánh đặc trưng của các thuật toán phát hiện dựa trên biên độ dòng điện, vốn dễ bị suy giảm độ nhạy trong điều kiện nhiễu cao hoặc khi thay đổi công suất nhỏ.

Thuật toán Hybrid của Mengqi Lu và Zuyi Li cho thấy sự cải thiện rõ rệt khi nâng tỷ lệ phát hiện lên gần 70\%. Tuy nhiên, việc vẫn bỏ lỡ hơn 30\% sự kiện cùng với 9 sự kiện giả khiến hiệu suất end-to-end chỉ đạt 67.52\%. Điều này cho thấy mặc dù Hybrid ổn định hơn WAMMA, nhưng vẫn chưa đạt độ tin cậy cần thiết để triển khai trong bối cảnh thực tế có nhiều thiết bị hoạt động đồng thời.

Thuật toán đề xuất trong đề tài đạt kết quả nổi bật nhất khi phát hiện đầy đủ 116/116 sự kiện (100\%), đảm bảo không bỏ sót bất cứ sự kiện nào -- yếu tố then chốt trong các hệ thống NILM hướng sự kiện. Nhờ đảm bảo tính đầy đủ của dữ liệu đầu vào, mô hình phân loại duy trì hiệu suất ổn định và hệ thống không bị đứt gãy dòng sự kiện. Tuy nhiên, thuật toán vẫn sinh ra 9 sự kiện giả, chủ yếu do nhiễu tín hiệu trong quá trình thiết bị CVD thay đổi công suất hoặc do ngưỡng phát hiện chưa được tối ưu cho các thiết bị có profile đặc thù.

Mặc dù tồn tại các sự kiện giả, hệ thống sử dụng thuật toán đề xuất đạt hiệu suất tổng thể cao nhất với Accuracy 88.8\%, Recall 89\% và F1-Score 84\%. Điều này chứng minh hiệu quả của cách tiếp cận ưu tiên không bỏ sót sự kiện (high-recall strategy), một yêu cầu quan trọng đối với các ứng dụng giám sát thiết bị theo thời gian thực, phân tích phụ tải, hay tối ưu hóa năng lượng.

Nhìn chung, các kết quả thu được khẳng định rằng thuật toán phát hiện sự kiện đóng vai trò quyết định trong hệ thống NILM hướng sự kiện. Mô hình học máy chỉ có thể đạt hiệu suất cao khi giai đoạn phát hiện đảm bảo tính đầy đủ và chính xác của dữ liệu đầu vào. Đồng thời, kết quả cũng cho thấy bộ dữ liệu thực nghiệm của đề tài -- phản ánh điều kiện điện áp và môi trường nhiễu thực tế -- là một thách thức cao hơn so với nhiều bộ dữ liệu công bố trước đây, và vì vậy giúp kiểm chứng mức độ ứng dụng thực tế của hệ thống.

Tổng hợp lại, hệ thống NILM hướng sự kiện được đề xuất đã chứng minh:
\begin{itemize}
    \item Tính khả thi trong môi trường thực nghiệm,
    \item Khả năng mở rộng cho các hệ thống giám sát năng lượng thông minh,
    \item Hiệu quả của việc kết hợp xử lý tín hiệu với mô hình học máy đơn giản nhưng ổn định.
\end{itemize}

Tuy nhiên, để hướng tới triển khai thực tế, các vấn đề như giảm số lượng sự kiện giả, tối ưu hóa ngưỡng phát hiện theo từng loại thiết bị, và mở rộng đánh giá sang dữ liệu dài hạn hoặc dữ liệu thời gian thực cần tiếp tục được nghiên cứu trong các hướng phát triển tiếp theo.


% ============================
% TÀI LIỆU THAM KHẢO
% ============================
\begin{thebibliography}{15}

\begin{bibsection}{Tiếng Việt}


\end{bibsection}

\begin{bibsection}{Tiếng Anh}

\bibitem{LuLi2019Hybrid}
M. Lu and Z. Li,
``A Hybrid Event Detection Approach for Non-Intrusive Load Monitoring,''
\textit{IEEE Transactions on Smart Grid},
vol. 11, no. 1, pp. 528--540, Jan. 2020,
doi: 10.1109/TSG.2019.2924862.

\bibitem{WAMMA}
L. Yan, W. Tian, X. Hao, Z. Li, and H. Wang,
``Robust Event Detection for Residential Load Disaggregation,''
\textit{IEEE Transactions on Smart Grid},
vol. 9, no. 5, pp. 5516--5524, Sept. 2018.

\bibitem{Liu2020NILM}
H. Liu,
\textit{Non-Intrusive Load Monitoring: Theory, Technologies and Applications}.
Singapore: Springer Nature, 2020,
doi: 10.1007/978-981-15-1860-7.

\bibitem{zheng2018supervised}
Z. Zheng, H. Chen, and X. Luo, ``A Supervised Event-Based Non-Intrusive Load Monitoring for Non-Linear Appliances,'' \textit{Sustainability}, vol. 10, no. 4, p. 950, Mar. 2018.

\bibitem{Lu2024Siamese}
L. Lu, J.-S. Kang, F. Meng, and M. Yu,
``Non-Intrusive Load Identification Based on Retrainable Siamese Network,''
\textit{Sensors}, vol. 24, no. 8, p. 2562, Apr. 2024,
doi: 10.3390/s24082562.


\end{bibsection}

\end{thebibliography}


\end{document}